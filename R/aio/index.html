






<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2021-11-03 16:01:40 -0500">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    
    <link rel="license" href="#license-info" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - R for Reproducible Scientific Analysis"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  R for Reproducible Scientific Analysis
  </title>  

  </head>
  <body>

    



    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://software-carpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/swc-icon-blue.svg" alt="Software Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href=".../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

  <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Lessons <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href=".../shell">Shell</a></li>
            <li><a href=".../git">Git</a></li>
            <li><a href=".../R">R for Reproducible Scientific Analysis</a></li>
          </ul>
  </li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../01-rstudio-intro/index.html">Introduction to R and RStudio</a></li>
            
            
            <li><a href="../02-project-intro/index.html">Project Management With RStudio</a></li>
            
            
            <li><a href="../03-seeking-help/index.html">Seeking Help</a></li>
            
            
            <li><a href="../04-data-structures-part1/index.html">Data Structures</a></li>
            
            
            <li><a href="../05-data-structures-part2/index.html">Exploring Data Frames</a></li>
            
            
            <li><a href="../06-data-subsetting/index.html">Subsetting Data</a></li>
            
            
            <li><a href="../07-control-flow/index.html">Control Flow</a></li>
            
            
            <li><a href="../08-plot-ggplot2/index.html">Creating Publication-Quality Graphics with ggplot2</a></li>
            
            
            <li><a href="../09-vectorization/index.html">Vectorization</a></li>
            
            
            <li><a href="../10-functions/index.html">Functions Explained</a></li>
            
            
            <li><a href="../11-writing-data/index.html">Writing Data</a></li>
            
            
            <li><a href="../12-plyr/index.html">Splitting and Combining Data Frames with plyr</a></li>
            
            
            <li><a href="../13-dplyr/index.html">Data frame Manipulation with dplyr</a></li>
            
            
            <li><a href="../14-tidyr/index.html">Data frame Manipulation with tidyr</a></li>
            
            
            <li><a href="../15-knitr-markdown/index.html">Producing Reports With knitr</a></li>
            
            
            <li><a href="../16-wrap-up/index.html">Writing Good Software</a></li>
            
          </ul>
        </li>
        
	

	
        <li><a href="../LICENSE.html">License</a></li>

      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>







<h1 class="maintitle"><a href="../">R for Reproducible Scientific Analysis</a></h1>



<article>

<h1 id="introduction-to-r-and-rstudio" class="maintitle">Introduction to R and RStudio</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 45 min
      <br />
      <strong>Exercises:</strong> 10 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How to find your way around RStudio?</p>
</li>
	
	<li><p>How to interact with R?</p>
</li>
	
	<li><p>How to manage your environment?</p>
</li>
	
	<li><p>How to install packages?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe the purpose and use of each pane in the RStudio IDE</p>
</li>
	
	<li><p>Locate buttons and options in the RStudio IDE</p>
</li>
	
	<li><p>Define a variable</p>
</li>
	
	<li><p>Assign data to a variable</p>
</li>
	
	<li><p>Manage a workspace in an interactive R session</p>
</li>
	
	<li><p>Use mathematical and comparison operators</p>
</li>
	
	<li><p>Call functions</p>
</li>
	
	<li><p>Manage packages</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="motivation">Motivation</h2>

<p>Science is a multi-step process: once you’ve designed an experiment and collected
data, the real fun begins! This lesson will teach you how to start this process using
R and RStudio. We will begin with raw data, perform exploratory analyses, and learn
how to plot results graphically. This example starts with a dataset from
<a href="https://www.gapminder.org">gapminder.org</a> containing population information for many
countries through time. Can you read the data into R? Can you plot the population for
Senegal? Can you calculate the average income for countries on the continent of Asia?
By the end of these lessons you will be able to do things like plot the populations
for all of these countries in under a minute!</p>

<h2 id="before-starting-the-workshop">Before Starting The Workshop</h2>

<p>Please ensure you have the latest version of R and RStudio installed on your machine. This is important, as some packages used in the workshop may not install correctly (or at all) if R is not up to date.</p>

<ul>
  <li><a href="https://www.r-project.org/">Download and install the latest version of R here</a></li>
  <li><a href="https://www.rstudio.com/">Download and install RStudio here</a></li>
</ul>

<h2 id="introduction-to-rstudio">Introduction to RStudio</h2>

<p>Welcome to the R portion of the Software Carpentry workshop.</p>

<p>Throughout this lesson, we’re going to teach you some of the fundamentals of
the R language as well as some best practices for organizing code for
scientific projects that will make your life easier.</p>

<p>We’ll be using RStudio: a free, open source R Integrated Development
Environment (IDE). It provides a built-in editor, works on all platforms (including
on servers) and provides many advantages such as integration with version
control and project management.</p>

<p><strong>Basic layout</strong></p>

<p>When you first open RStudio, you will be greeted by three panels:</p>

<ul>
  <li>The interactive R console/Terminal (entire left)</li>
  <li>Environment/History/Connections (tabbed in upper right)</li>
  <li>Files/Plots/Packages/Help/Viewer (tabbed in lower right)</li>
</ul>

<p><img src="../fig/01-rstudio.png" alt="RStudio layout" /></p>

<p>Once you open files, such as R scripts, an editor panel will also open
in the top left.</p>

<p><img src="../fig/01-rstudio-script.png" alt="RStudio layout with .R file open" /></p>

<h2 id="work-flow-within-rstudio">Work flow within RStudio</h2>
<p>There are two main ways one can work within RStudio:</p>

<ol>
  <li>Test and play within the interactive R console then copy code into
a .R file to run later.
    <ul>
      <li>This works well when doing small tests and initially starting off.</li>
      <li>It quickly becomes laborious</li>
    </ul>
  </li>
  <li>Start writing in a .R file and use RStudio’s short cut keys for the Run command
to push the current line, selected lines or modified lines to the
interactive R console.
    <ul>
      <li>This is a great way to start; all your code is saved for later</li>
      <li>You will be able to run the file you create from within RStudio
or using R’s <code class="language-plaintext highlighter-rouge">source()</code>  function.</li>
    </ul>
  </li>
</ol>

<blockquote class="callout">
  <h2 id="tip-running-segments-of-your-code">Tip: Running segments of your code</h2>

  <p>RStudio offers you great flexibility in running code from within the editor
window. There are buttons, menu choices, and keyboard shortcuts. To run the
current line, you can</p>
  <ol>
    <li>click on the <code class="language-plaintext highlighter-rouge">Run</code> button above the editor panel, or</li>
    <li>select “Run Lines” from the “Code” menu, or</li>
    <li>hit <kbd>Ctrl</kbd>+<kbd>Return</kbd> in Windows or Linux
or <kbd>&#8984;</kbd>+<kbd>Return</kbd> on OS X.
(This shortcut can also be seen by hovering
the mouse over the button). To run a block of code, select it and then <code class="language-plaintext highlighter-rouge">Run</code>.
If you have modified a line of code within a block of code you have just run,
there is no need to reselect the section and <code class="language-plaintext highlighter-rouge">Run</code>, you can use the next button
along, <code class="language-plaintext highlighter-rouge">Re-run the previous region</code>. This will run the previous code block
including the modifications you have made.</li>
  </ol>
</blockquote>

<h2 id="introduction-to-r">Introduction to R</h2>

<p>Much of your time in R will be spent in the R interactive
console. This is where you will run all of your code, and can be a
useful environment to try out ideas before adding them to an R script
file. This console in RStudio is the same as the one you would get if
you typed in <code class="language-plaintext highlighter-rouge">R</code> in your command-line environment.</p>

<p>The first thing you will see in the R interactive session is a bunch
of information, followed by a “&gt;” and a blinking cursor. In many ways
this is similar to the shell environment you learned about during the
shell lessons: it operates on the same idea of a “Read, evaluate,
print loop”: you type in commands, R tries to execute them, and then
returns a result.</p>

<h2 id="using-r-as-a-calculator">Using R as a calculator</h2>

<p>The simplest thing you could do with R is to do arithmetic:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">100</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 101
</code></pre></div></div>

<p>And R will print out the answer, with a preceding “[1]”. Don’t worry about this
for now, we’ll explain that later. For now think of it as indicating output.</p>

<p>Like bash, if you type in an incomplete command, R will wait for you to
complete it:</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; 1 +
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+
</code></pre></div></div>

<p>Any time you hit return and the R session shows a “+” instead of a “&gt;”, it
means it’s waiting for you to complete the command. If you want to cancel
a command you can hit <kbd>Esc</kbd> and RStudio will give you back the “&gt;” prompt.</p>

<blockquote class="callout">
  <h2 id="tip-canceling-commands">Tip: Canceling commands</h2>

  <p>If you’re using R from the command line instead of from within RStudio,
you need to use <kbd>Ctrl</kbd>+<kbd>C</kbd> instead of <kbd>Esc</kbd>
to cancel the command. This applies to Mac users as well!</p>

  <p>Canceling a command isn’t only useful for killing incomplete commands:
you can also use it to tell R to stop running code (for example if it’s
taking much longer than you expect), or to get rid of the code you’re
currently writing.</p>

</blockquote>

<p>When using R as a calculator, the order of operations is the same as you
would have learned back in school.</p>

<p>From highest to lowest precedence:</p>

<ul>
  <li>Parentheses: <code class="language-plaintext highlighter-rouge">(</code>, <code class="language-plaintext highlighter-rouge">)</code></li>
  <li>Exponents: <code class="language-plaintext highlighter-rouge">^</code> or <code class="language-plaintext highlighter-rouge">**</code></li>
  <li>Multiply: <code class="language-plaintext highlighter-rouge">*</code></li>
  <li>Divide: <code class="language-plaintext highlighter-rouge">/</code></li>
  <li>Add: <code class="language-plaintext highlighter-rouge">+</code></li>
  <li>Subtract: <code class="language-plaintext highlighter-rouge">-</code></li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 13
</code></pre></div></div>

<p>Use parentheses to group operations in order to force the order of
evaluation if it differs from the default, or to make clear what you
intend.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 16
</code></pre></div></div>

<p>This can get unwieldy when not needed, but clarifies your intentions.
Remember that others may later read your code.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="m">2</span><span class="p">)))</span><span class="w"> </span><span class="c1"># hard to read</span><span class="w">
</span><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="m">2</span><span class="w">       </span><span class="c1"># clear, if you remember the rules</span><span class="w">
</span><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">2</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">     </span><span class="c1"># if you forget some rules, this might help</span><span class="w">
</span></code></pre></div></div>

<p>The text after each line of code is called a
“comment”. Anything that follows after the hash (or octothorpe) symbol
<code class="language-plaintext highlighter-rouge">#</code> is ignored by R when it executes code.</p>

<p>Really small or large numbers get a scientific notation:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">2</span><span class="o">/</span><span class="m">10000</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2e-04
</code></pre></div></div>

<p>Which is shorthand for “multiplied by <code class="language-plaintext highlighter-rouge">10^XX</code>”. So <code class="language-plaintext highlighter-rouge">2e-4</code>
is shorthand for <code class="language-plaintext highlighter-rouge">2 * 10^(-4)</code>.</p>

<p>You can write numbers in scientific notation too:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">5e3</span><span class="w">  </span><span class="c1"># Note the lack of minus here</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 5000
</code></pre></div></div>

<h2 id="mathematical-functions">Mathematical functions</h2>

<p>R has many built in mathematical functions. To call a function,
we can type its name, followed by open and closing parentheses.
Anything we type inside the parentheses is called the function’s
arguments:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">sin</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">  </span><span class="c1"># trigonometry functions</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0.841471
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">  </span><span class="c1"># natural logarithm</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">log10</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="c1"># base-10 logarithm</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">exp</span><span class="p">(</span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="c1"># e^(1/2)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1.648721
</code></pre></div></div>

<p>Don’t worry about trying to remember every function in R. You
can look them up on Google, or if you can remember the
start of the function’s name, use the tab completion in RStudio.</p>

<p>This is one advantage that RStudio has over R on its own, it
has auto-completion abilities that allow you to more easily
look up functions, their arguments, and the values that they
take.</p>

<p>Typing a <code class="language-plaintext highlighter-rouge">?</code> before the name of a command will open the help page
for that command. When using RStudio, this will open the ‘Help’ pane;
if using R in the terminal, the help page will open in your browser.
The help page will include a detailed description of the command and
how it works. Scrolling to the bottom of the help page will usually
show a collection of code examples which illustrate command usage.
We’ll go through an example later.</p>

<h2 id="comparing-things">Comparing things</h2>

<p>We can also do comparisons in R:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># equality (note two equals signs, read as "is equal to")</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] TRUE
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">2</span><span class="w">  </span><span class="c1"># inequality (read as "is not equal to")</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] TRUE
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">2</span><span class="w">  </span><span class="c1"># less than</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] TRUE
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># less than or equal to</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] TRUE
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="c1"># greater than</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] TRUE
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">-9</span><span class="w"> </span><span class="c1"># greater than or equal to</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] TRUE
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-comparing-numbers">Tip: Comparing Numbers</h2>

  <p>A word of warning about comparing numbers: you should
never use <code class="language-plaintext highlighter-rouge">==</code> to compare two numbers unless they are
integers (a data type which can specifically represent
only whole numbers).</p>

  <p>Computers may only represent decimal numbers with a
certain degree of precision, so two numbers which look
the same when printed out by R, may actually have
different underlying representations and therefore be
different by a small margin of error (called Machine
numeric tolerance).</p>

  <p>Instead you should use the <code class="language-plaintext highlighter-rouge">all.equal</code> function.</p>

  <p>Further reading: <a href="http://floating-point-gui.de/">http://floating-point-gui.de/</a></p>

</blockquote>

<h2 id="variables-and-assignment">Variables and assignment</h2>

<p>We can store values in variables using the assignment operator <code class="language-plaintext highlighter-rouge">&lt;-</code>, like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">40</span><span class="w">
</span></code></pre></div></div>

<p>Notice that assignment does not print a value. Instead, we stored it for later
in something called a <strong>variable</strong>. <code class="language-plaintext highlighter-rouge">x</code> now contains the <strong>value</strong> <code class="language-plaintext highlighter-rouge">0.025</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0.025
</code></pre></div></div>

<p>More precisely, the stored value is a <em>decimal approximation</em> of
this fraction called a <a href="http://en.wikipedia.org/wiki/Floating_point">floating point number</a>.</p>

<p>Look for the <code class="language-plaintext highlighter-rouge">Environment</code> tab in the top right panel of RStudio, and you will see that <code class="language-plaintext highlighter-rouge">x</code> and its value
have appeared. Our variable <code class="language-plaintext highlighter-rouge">x</code> can be used in place of a number in any calculation that expects a number:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] -3.688879
</code></pre></div></div>

<p>Notice also that variables can be reassigned:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">x</code> used to contain the value 0.025 and now it has the value 100.</p>

<p>Assignment values can contain the variable being assigned to:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1">#notice how RStudio updates its description of x on the top right tab</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></code></pre></div></div>

<p>The right hand side of the assignment can be any valid R expression.
The right hand side is <em>fully evaluated</em> before the assignment occurs.</p>

<p>Variable names can contain letters, numbers, underscores and periods but no spaces. They
must start with a letter or a period followed by a letter (they cannot start with a number nor an underscore).
Variables beginning with a period are hidden variables.
Different people use different conventions for long variable names, these include</p>

<ul>
  <li>periods.between.words</li>
  <li>underscores_between_words</li>
  <li>camelCaseToSeparateWords</li>
</ul>

<p>What you use is up to you, but <strong>be consistent</strong>.</p>

<p>It is also possible to use the <code class="language-plaintext highlighter-rouge">=</code> operator for assignment:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">40</span><span class="w">
</span></code></pre></div></div>

<p>But this is much less common among R users.  The most important thing is to
<strong>be consistent</strong> with the operator you use. There are occasionally places
where it is less confusing to use <code class="language-plaintext highlighter-rouge">&lt;-</code> than <code class="language-plaintext highlighter-rouge">=</code>, and it is the most common
symbol used in the community. So the recommendation is to use <code class="language-plaintext highlighter-rouge">&lt;-</code>.</p>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Which of the following are valid R variable names?</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">min_height</span><span class="w">
</span><span class="n">max.height</span><span class="w">
</span><span class="err">_</span><span class="n">age</span><span class="w">
</span><span class="n">.mass</span><span class="w">
</span><span class="n">MaxLength</span><span class="w">
</span><span class="n">min</span><span class="o">-</span><span class="n">length</span><span class="w">
</span><span class="m">2</span><span class="n">widths</span><span class="w">
</span><span class="n">celsius2kelvin</span><span class="w">
</span></code></pre></div>  </div>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to challenge 1</h2>

    <p>The following can be used as R variables:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">min_height</span><span class="w">
</span><span class="n">max.height</span><span class="w">
</span><span class="n">MaxLength</span><span class="w">
</span><span class="n">celsius2kelvin</span><span class="w">
</span></code></pre></div>    </div>

    <p>The following creates a hidden variable:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">.mass</span><span class="w">
</span></code></pre></div>    </div>

    <p>The following will not be able to be used to create a variable</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">_</span><span class="n">age</span><span class="w">
</span><span class="n">min</span><span class="o">-</span><span class="n">length</span><span class="w">
</span><span class="m">2</span><span class="n">widths</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="vectorization">Vectorization</h2>

<p>One final thing to be aware of is that R is <em>vectorized</em>, meaning that
variables and functions can have vectors as values. In contrast to physics and
mathematics, a vector in R describes a set of values in a certain order of the
same data type. For example</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 2 3 4 5
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">2</span><span class="o">^</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  2  4  8 16 32
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="w">
</span><span class="m">2</span><span class="o">^</span><span class="n">x</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  2  4  8 16 32
</code></pre></div></div>

<p>This is incredibly powerful; we will discuss this further in an
upcoming lesson.</p>

<h2 id="managing-your-environment">Managing your environment</h2>

<p>There are a few useful commands you can use to interact with the R session.</p>

<p><code class="language-plaintext highlighter-rouge">ls</code> will list all of the variables and functions stored in the global environment
(your working R session):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ls</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "args"    "dest_md" "op"      "src_rmd" "x"       "y"      
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-hidden-objects">Tip: hidden objects</h2>

  <p>Like in the shell, <code class="language-plaintext highlighter-rouge">ls</code> will hide any variables or functions starting
with a “.” by default. To list all objects, type <code class="language-plaintext highlighter-rouge">ls(all.names=TRUE)</code>
instead</p>

</blockquote>

<p>Note here that we didn’t give any arguments to <code class="language-plaintext highlighter-rouge">ls</code>, but we still
needed to give the parentheses to tell R to call the function.</p>

<p>If we type <code class="language-plaintext highlighter-rouge">ls</code> by itself, R prints a bunch of code instead of a listing of objects.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ls</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function (name, pos = -1L, envir = as.environment(pos), all.names = FALSE, 
    pattern, sorted = TRUE) 
{
    if (!missing(name)) {
        pos &lt;- tryCatch(name, error = function(e) e)
        if (inherits(pos, "error")) {
            name &lt;- substitute(name)
            if (!is.character(name)) 
                name &lt;- deparse(name)
            warning(gettextf("%s converted to character string", 
                sQuote(name)), domain = NA)
            pos &lt;- name
        }
    }
    all.names &lt;- .Internal(ls(envir, all.names, sorted))
    if (!missing(pattern)) {
        if ((ll &lt;- length(grep("[", pattern, fixed = TRUE))) &amp;&amp; 
            ll != length(grep("]", pattern, fixed = TRUE))) {
            if (pattern == "[") {
                pattern &lt;- "\\["
                warning("replaced regular expression pattern '[' by  '\\\\['")
            }
            else if (length(grep("[^\\\\]\\[&lt;-", pattern))) {
                pattern &lt;- sub("\\[&lt;-", "\\\\\\[&lt;-", pattern)
                warning("replaced '[&lt;-' by '\\\\[&lt;-' in regular expression pattern")
            }
        }
        grep(pattern, all.names, value = TRUE)
    }
    else all.names
}
&lt;bytecode: 0x5645740b6c30&gt;
&lt;environment: namespace:base&gt;
</code></pre></div></div>

<p>What’s going on here?</p>

<p>Like everything in R, <code class="language-plaintext highlighter-rouge">ls</code> is the name of an object, and entering the name of
an object by itself prints the contents of the object. The object <code class="language-plaintext highlighter-rouge">x</code> that we
created earlier contains 1, 2, 3, 4, 5:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 2 3 4 5
</code></pre></div></div>

<p>The object <code class="language-plaintext highlighter-rouge">ls</code> contains the R code that makes the <code class="language-plaintext highlighter-rouge">ls</code> function work! We’ll talk
more about how functions work and start writing our own later.</p>

<p>You can use <code class="language-plaintext highlighter-rouge">rm</code> to delete objects you no longer need:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>If you have lots of things in your environment and want to delete all of them,
you can pass the results of <code class="language-plaintext highlighter-rouge">ls</code> to the <code class="language-plaintext highlighter-rouge">rm</code> function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rm</span><span class="p">(</span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ls</span><span class="p">())</span><span class="w">
</span></code></pre></div></div>

<p>In this case we’ve combined the two. Like the order of operations, anything
inside the innermost parentheses is evaluated first, and so on.</p>

<p>In this case we’ve specified that the results of <code class="language-plaintext highlighter-rouge">ls</code> should be used for the
<code class="language-plaintext highlighter-rouge">list</code> argument in <code class="language-plaintext highlighter-rouge">rm</code>. When assigning values to arguments by name, you <em>must</em>
use the <code class="language-plaintext highlighter-rouge">=</code> operator!!</p>

<p>If instead we use <code class="language-plaintext highlighter-rouge">&lt;-</code>, there will be unintended side effects, or you may get an error message:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rm</span><span class="p">(</span><span class="n">list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ls</span><span class="p">())</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in rm(list &lt;- ls()): ... must contain names or character strings
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-warnings-vs-errors">Tip: Warnings vs. Errors</h2>

  <p>Pay attention when R does something unexpected! Errors, like above,
are thrown when R cannot proceed with a calculation. Warnings on the
other hand usually mean that the function has run, but it probably
hasn’t worked as expected.</p>

  <p>In both cases, the message that R prints out usually give you clues
how to fix a problem.</p>

</blockquote>

<h2 id="r-packages">R Packages</h2>

<p>It is possible to add functions to R by writing a package, or by
obtaining a package written by someone else. As of this writing, there
are over 10,000 packages available on CRAN (the comprehensive R archive
network). R and RStudio have functionality for managing packages:</p>

<ul>
  <li>You can see what packages are installed by typing
<code class="language-plaintext highlighter-rouge">installed.packages()</code></li>
  <li>You can install packages by typing <code class="language-plaintext highlighter-rouge">install.packages("packagename")</code>,
where <code class="language-plaintext highlighter-rouge">packagename</code> is the package name, in quotes.</li>
  <li>You can update installed packages by typing <code class="language-plaintext highlighter-rouge">update.packages()</code></li>
  <li>You can remove a package with <code class="language-plaintext highlighter-rouge">remove.packages("packagename")</code></li>
  <li>You can make a package available for use with <code class="language-plaintext highlighter-rouge">library(packagename)</code></li>
</ul>

<p>Packages can also be viewed, loaded, and detached in the Packages tab of the lower right panel in RStudio. Clicking on this tab will display all of the installed packages with a checkbox next to them. If the box next to a package name is checked, the package is loaded and if it is empty, the package is not loaded. Click an empty box to load that package and click a checked box to detach that package.</p>

<p>Packages can be installed and updated from the Package tab with the Install and Update buttons at the top of the tab.</p>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>What will be the value of each variable  after each
statement in the following program?</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mass</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">47.5</span><span class="w">
</span><span class="n">age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">122</span><span class="w">
</span><span class="n">mass</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2.3</span><span class="w">
</span><span class="n">age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">20</span><span class="w">
</span></code></pre></div>  </div>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to challenge 2</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mass</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">47.5</span><span class="w">
</span></code></pre></div>    </div>
    <p>This will give a value of 47.5 for the variable mass</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">122</span><span class="w">
</span></code></pre></div>    </div>
    <p>This will give a value of 122 for the variable age</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mass</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2.3</span><span class="w">
</span></code></pre></div>    </div>
    <p>This will multiply the existing value of 47.5 by 2.3 to give a new value of
109.25 to the variable mass.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">20</span><span class="w">
</span></code></pre></div>    </div>
    <p>This will subtract 20 from the existing value of 122 to give a new value
of 102 to the variable age.</p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>

  <p>Run the code from the previous challenge, and write a command to
compare mass to age. Is mass larger than age?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to challenge 3</h2>

    <p>One way of answering this question in R is to use the <code class="language-plaintext highlighter-rouge">&gt;</code> to set up the following:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mass</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">age</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] TRUE
</code></pre></div>    </div>
    <p>This should yield a boolean value of TRUE since 109.25 is greater than 102.</p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-4">Challenge 4</h2>

  <p>Clean up your working environment by deleting the mass and age
variables.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-4">Solution to challenge 4</h2>

    <p>We can use the <code class="language-plaintext highlighter-rouge">rm</code> command to accomplish this task</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rm</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">mass</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-5">Challenge 5</h2>

  <p>Install the following packages: <code class="language-plaintext highlighter-rouge">ggplot2</code>, <code class="language-plaintext highlighter-rouge">plyr</code>, <code class="language-plaintext highlighter-rouge">gapminder</code></p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-5">Solution to challenge 5</h2>

    <p>We can use the <code class="language-plaintext highlighter-rouge">install.packages()</code> command to install the required packages.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">)</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"plyr"</span><span class="p">)</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"gapminder"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p>An alternate solution, to install multiple packages with a single <code class="language-plaintext highlighter-rouge">install.packages()</code> command is:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"plyr"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gapminder"</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use RStudio to write and run R programs.</p>
</li>
    
    <li><p>R has the usual arithmetic operators and mathematical functions.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">&lt;-</code> to assign values to variables.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">ls()</code> to list the variables in a program.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">rm()</code> to delete objects in a program.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">install.packages()</code> to install packages (libraries).</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="project-management-with-rstudio" class="maintitle">Project Management With RStudio</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 20 min
      <br />
      <strong>Exercises:</strong> 10 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I manage my projects in R?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Create self-contained projects in RStudio</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="introduction">Introduction</h2>

<p>The scientific process is naturally incremental, and many projects
start life as random notes, some code, then a manuscript, and
eventually everything is a bit mixed together.</p>

<blockquote class="twitter-tweet"><p>Managing your projects in a reproducible fashion doesn't just make your science reproducible, it makes your life easier.</p>— Vince Buffalo (@vsbuffalo) <a href="https://twitter.com/vsbuffalo/status/323638476153167872">April 15, 2013</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Most people tend to organize their projects like this:</p>

<p><img src="../fig/bad_layout.png" alt="Screenshot of file manager demonstrating bad project organisation" /></p>

<p>There are many reasons why we should <em>ALWAYS</em> avoid this:</p>

<ol>
  <li>It is really hard to tell which version of your data is
the original and which is the modified;</li>
  <li>It gets really messy because it mixes files with various
extensions together;</li>
  <li>It probably takes you a lot of time to actually find
things, and relate the correct figures to the exact code
that has been used to generate it;</li>
</ol>

<p>A good project layout will ultimately make your life easier:</p>

<ul>
  <li>It will help ensure the integrity of your data;</li>
  <li>It makes it simpler to share your code with someone else
(a lab-mate, collaborator, or supervisor);</li>
  <li>It allows you to easily upload your code with your manuscript submission;</li>
  <li>It makes it easier to pick the project back up after a break.</li>
</ul>

<h2 id="a-possible-solution">A possible solution</h2>

<p>Fortunately, there are tools and packages which can help you manage your work effectively.</p>

<p>One of the most powerful and useful aspects of RStudio is its project management
functionality. We’ll be using this today to create a self-contained, reproducible
project.</p>

<blockquote class="challenge">
  <h2 id="challenge-1-creating-a-self-contained-project">Challenge 1: Creating a self-contained project</h2>

  <p>We’re going to create a new project in RStudio:</p>

  <ol>
    <li>Click the “File” menu button, then “New Project”.</li>
    <li>Click “New Directory”.</li>
    <li>Click “New Project”.</li>
    <li>Type in the name of the directory to store your project, e.g. “my_project”.</li>
    <li>If available, select the checkbox for “Create a git repository.”</li>
    <li>Click the “Create Project” button.</li>
  </ol>
</blockquote>

<p>The simplest way to open an RStudio project once it has been created is to click
through your file system to get to the directory where it was saved and double
click on the <code class="language-plaintext highlighter-rouge">.Rproj</code> file. This will open RStudio and start your R session in the
same directory as the <code class="language-plaintext highlighter-rouge">.Rproj</code> file. All your data, plots and scripts will now be
relative to the project directory. RStudio projects have the added benefit of
allowing you to open multiple projects at the same time each open to its own
project directory. This allows you to keep multiple projects open without them
interfering with each other.</p>

<blockquote class="challenge">
  <h2 id="challenge-2-opening-an-rstudio-project-through-the-file-system">Challenge 2: Opening an RStudio project through the file system</h2>

  <ol>
    <li>Exit RStudio.</li>
    <li>Navigate to the directory where you created a project in Challenge 1.</li>
    <li>Double click on the <code class="language-plaintext highlighter-rouge">.Rproj</code> file in that directory.</li>
  </ol>
</blockquote>

<h2 id="best-practices-for-project-organization">Best practices for project organization</h2>

<p>Although there is no “best” way to lay out a project, there are some general
principles to adhere to that will make project management easier:</p>

<h3 id="treat-data-as-read-only">Treat data as read only</h3>

<p>This is probably the most important goal of setting up a project. Data is
typically time consuming and/or expensive to collect. Working with them
interactively (e.g., in Excel) where they can be modified means you are never
sure of where the data came from, or how it has been modified since collection.
It is therefore a good idea to treat your data as “read-only”.</p>

<h3 id="data-cleaning">Data Cleaning</h3>

<p>In many cases your data will be “dirty”: it will need significant preprocessing
to get into a format R (or any other programming language) will find useful.
This task is sometimes called “data munging”. Storing these scripts in a
separate folder, and creating a second “read-only” data folder to hold the
“cleaned” data sets can prevent confusion between the two sets.</p>

<h3 id="treat-generated-output-as-disposable">Treat generated output as disposable</h3>

<p>Anything generated by your scripts should be treated as disposable: it should
all be able to be regenerated from your scripts.</p>

<p>There are lots of different ways to manage this output. Having an output folder
with different sub-directories for each separate analysis makes it easier later.
Since many analyses are exploratory and don’t end up being used in the final
project, and some of the analyses get shared between projects.</p>

<blockquote class="callout">
  <h2 id="tip-good-enough-practices-for-scientific-computing">Tip: Good Enough Practices for Scientific Computing</h2>

  <p><a href="https://github.com/swcarpentry/good-enough-practices-in-scientific-computing/blob/gh-pages/good-enough-practices-for-scientific-computing.pdf">Good Enough Practices for Scientific Computing</a> gives the following recommendations for project organization:</p>

  <ol>
    <li>Put each project in its own directory, which is named after the project.</li>
    <li>Put text documents associated with the project in the <code class="language-plaintext highlighter-rouge">doc</code> directory.</li>
    <li>Put raw data and metadata in the <code class="language-plaintext highlighter-rouge">data</code> directory, and files generated during cleanup and analysis in a <code class="language-plaintext highlighter-rouge">results</code> directory.</li>
    <li>Put source for the project’s scripts and programs in the <code class="language-plaintext highlighter-rouge">src</code> directory, and programs brought in from elsewhere or compiled locally in the <code class="language-plaintext highlighter-rouge">bin</code> directory.</li>
    <li>Name all files to reflect their content or function.</li>
  </ol>

</blockquote>

<h3 id="separate-function-definition-and-application">Separate function definition and application</h3>

<p>One of the more effective ways to work with R is to start by writing the code you want to run directly in a .R script, and then running the selected lines (either using the keyboard shortcuts in RStudio or clicking the “Run” button) in the interactive R console.</p>

<p>When your project is in its early stages, the initial .R script file usually contains many lines
of directly executed code. As it matures, reusable chunks get pulled into their
own functions. It’s a good idea to separate these functions into two separate folders; one
to store useful functions that you’ll reuse across analyses and projects, and
one to store the analysis scripts.</p>

<blockquote class="callout">
  <h2 id="tip-avoiding-duplication">Tip: avoiding duplication</h2>

  <p>You may find yourself using data or analysis scripts across several projects.
Typically you want to avoid duplication to save space and avoid having to
make updates to code in multiple places.</p>

  <p>In this case, making “symbolic links”, which are essentially shortcuts to
files somewhere else on a filesystem, can let you use existing code without
having to move or copy it. Plus, any changes made to that code will only have
to be made once.</p>

  <p>On Linux and OS X you can use the <code class="language-plaintext highlighter-rouge">ln -s</code> command, and on Windows you can
either create a shortcut or use the <code class="language-plaintext highlighter-rouge">mklink</code> command from the windows terminal.</p>
</blockquote>

<h3 id="save-the-data-in-the-data-directory">Save the data in the data directory</h3>

<p>Now we have a good directory structure we will now place/save the data file in the <code class="language-plaintext highlighter-rouge">data/</code> directory.</p>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>
  <p>Download the gapminder data from <a href="https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/_episodes_rmd/data/gapminder_data.csv">here</a>.</p>

  <ol>
    <li>Download the file (right mouse click on the link above -&gt; “Save link as” / “Save file as”, or click on the link and after the page loads, press <kbd>Ctrl</kbd>+<kbd>S</kbd> or choose File -&gt; “Save page as”)</li>
    <li>Make sure it’s saved under the name <code class="language-plaintext highlighter-rouge">gapminder_data.csv</code></li>
    <li>Save the file in the <code class="language-plaintext highlighter-rouge">data/</code> folder within your project.</li>
  </ol>

  <p>We will load and inspect these data later.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-4">Challenge 4</h2>
  <p>It is useful to get some general idea about the dataset, directly from the
command line, before loading it into R. Understanding the dataset better
will come in handy when making decisions on how to load it in R. Use the command-line
shell to answer the following questions:</p>
  <ol>
    <li>What is the size of the file?</li>
    <li>How many rows of data does it contain?</li>
    <li>What kinds of values are stored in this file?</li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-4">Solution to Challenge 4</h2>

    <p>By running these commands in the shell:</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-lh</span> data/gapminder_data.csv
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-rw-rw-r-- 1 schuyler schuyler 80K Nov  2 13:54 data/gapminder_data.csv
</code></pre></div>    </div>
    <p>The file size is 80K.</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">wc</span> <span class="nt">-l</span> data/gapminder_data.csv
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1705 data/gapminder_data.csv
</code></pre></div>    </div>
    <p>There are 1705 lines. The data looks like:</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">head </span>data/gapminder_data.csv
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>country,year,pop,continent,lifeExp,gdpPercap
Afghanistan,1952,8425333,Asia,28.801,779.4453145
Afghanistan,1957,9240934,Asia,30.332,820.8530296
Afghanistan,1962,10267083,Asia,31.997,853.10071
Afghanistan,1967,11537966,Asia,34.02,836.1971382
Afghanistan,1972,13079460,Asia,36.088,739.9811058
Afghanistan,1977,14880372,Asia,38.438,786.11336
Afghanistan,1982,12881816,Asia,39.854,978.0114388
Afghanistan,1987,13867957,Asia,40.822,852.3959448
Afghanistan,1992,16317921,Asia,41.674,649.3413952
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="callout">
  <h2 id="tip-command-line-in-rstudio">Tip: command line in RStudio</h2>

  <p>The Terminal tab in the console pane provides a convenient place directly
within RStudio to interact directly with the command line.</p>
</blockquote>

<h3 id="version-control">Version Control</h3>

<p>It is important to use version control with projects.  Go <a href="https://swcarpentry.github.io/git-novice/14-supplemental-rstudio/">here for a good lesson which describes using Git with RStudio</a>.</p>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use RStudio to create and manage projects with consistent layout.</p>
</li>
    
    <li><p>Treat raw data as read-only.</p>
</li>
    
    <li><p>Treat generated output as disposable.</p>
</li>
    
    <li><p>Separate function definition and application.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="seeking-help" class="maintitle">Seeking Help</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 10 min
      <br />
      <strong>Exercises:</strong> 10 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I get help in R?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>To be able read R help files for functions and special operators.</p>
</li>
	
	<li><p>To be able to use CRAN task views to identify packages to solve a problem.</p>
</li>
	
	<li><p>To be able to seek help from your peers.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="reading-help-files">Reading Help files</h2>

<p>R, and every package, provide help files for functions. The general syntax to search for help on any
function, “function_name”, from a specific function that is in a package loaded into your
namespace (your interactive R session):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">function_name</span><span class="w">
</span><span class="n">help</span><span class="p">(</span><span class="n">function_name</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>This will load up a help page in RStudio (or as plain text in R by itself).</p>

<p>Each help page is broken down into sections:</p>

<ul>
  <li>Description: An extended description of what the function does.</li>
  <li>Usage: The arguments of the function and their default values.</li>
  <li>Arguments: An explanation of the data each argument is expecting.</li>
  <li>Details: Any important details to be aware of.</li>
  <li>Value: The data the function returns.</li>
  <li>See Also: Any related functions you might find useful.</li>
  <li>Examples: Some examples for how to use the function.</li>
</ul>

<p>Different functions might have different sections, but these are the main ones you should be aware of.</p>

<blockquote class="callout">
  <h2 id="tip-running-examples">Tip: Running Examples</h2>

  <p>From within the function help page, you can highlight code in the 
Examples and hit <kbd>Ctrl</kbd>+<kbd>Return</kbd> to run it in 
RStudio console. This is gives you a quick way to get a feel for
how a function works.</p>
</blockquote>

<blockquote class="callout">
  <h2 id="tip-reading-help-files">Tip: Reading help files</h2>

  <p>One of the most daunting aspects of R is the large number of functions
available. It would be prohibitive, if not impossible to remember the
correct usage for every function you use. Luckily, the help files
mean you don’t have to!</p>
</blockquote>

<h2 id="special-operators">Special Operators</h2>

<p>To seek help on special operators, use quotes or backticks:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="s2">"&lt;-"</span><span class="w">
</span><span class="o">?</span><span class="n">`&lt;-`</span><span class="w">
</span></code></pre></div></div>

<h2 id="getting-help-on-packages">Getting help on packages</h2>

<p>Many packages come with “vignettes”: tutorials and extended example documentation.
Without any arguments, <code class="language-plaintext highlighter-rouge">vignette()</code> will list all vignettes for all installed packages;
<code class="language-plaintext highlighter-rouge">vignette(package="package-name")</code> will list all available vignettes for
<code class="language-plaintext highlighter-rouge">package-name</code>, and <code class="language-plaintext highlighter-rouge">vignette("vignette-name")</code> will open the specified vignette.</p>

<p>If a package doesn’t have any vignettes, you can usually find help by typing
<code class="language-plaintext highlighter-rouge">help("package-name")</code>.</p>

<p>RStudio also has a set of excellent
<a href="https://rstudio.com/resources/cheatsheets/">cheatsheets</a> for many packages.</p>

<h2 id="when-you-kind-of-remember-the-function">When you kind of remember the function</h2>

<p>If you’re not sure what package a function is in, or how it’s specifically spelled you can do a fuzzy search:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">??</span><span class="n">function_name</span><span class="w">
</span></code></pre></div></div>

<p>A fuzzy search is when you search for an approximate string match. For example, you may remember that the function 
to set your working directory includes “set” in its name. You can do a fuzzy search to help you identify the function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">??</span><span class="n">set</span><span class="w">
</span></code></pre></div></div>

<h2 id="when-you-have-no-idea-where-to-begin">When you have no idea where to begin</h2>

<p>If you don’t know what function or package you need to use
<a href="http://cran.at.r-project.org/web/views">CRAN Task Views</a>
is a specially maintained list of packages grouped into
fields. This can be a good starting point.</p>

<h2 id="when-your-code-doesnt-work-seeking-help-from-your-peers">When your code doesn’t work: seeking help from your peers</h2>

<p>If you’re having trouble using a function, 9 times out of 10,
the answers you are seeking have already been answered on
<a href="http://stackoverflow.com/">Stack Overflow</a>. You can search using
the <code class="language-plaintext highlighter-rouge">[r]</code> tag. Please make sure to see their page on 
<a href="https://stackoverflow.com/help/how-to-ask">how to ask a good question.</a></p>

<p>If you can’t find the answer, there are a few useful functions to
help you ask a question from your peers:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">dput</span><span class="w">
</span></code></pre></div></div>

<p>Will dump the data you’re working with into a format so that it can
be copy and pasted by anyone else into their R session.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sessionInfo</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>R version 4.0.3 (2020-10-10)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.3 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] knitr_1.36

loaded via a namespace (and not attached):
[1] compiler_4.0.3 magrittr_2.0.1 tools_4.0.3    stringi_1.7.5  stringr_1.4.0 
[6] xfun_0.27      evaluate_0.14 
</code></pre></div></div>

<p>Will print out your current version of R, as well as any packages you
have loaded. This can be useful for others to help reproduce and debug
your issue.</p>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Look at the help for the <code class="language-plaintext highlighter-rouge">c</code> function. What kind of vector do you
expect you will create if you evaluate the following:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="nf">c</span><span class="p">(</span><span class="s1">'d'</span><span class="p">,</span><span class="w"> </span><span class="s1">'e'</span><span class="p">,</span><span class="w"> </span><span class="s1">'f'</span><span class="p">)</span><span class="w">
</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s1">'f'</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>
  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to Challenge 1</h2>

    <p>The <code class="language-plaintext highlighter-rouge">c()</code> function creates a vector, in which all elements are the
same type. In the first case, the elements are numeric, in the
second, they are characters, and in the third they are characters:
the numeric values are “coerced” to be characters.</p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>Look at the help for the <code class="language-plaintext highlighter-rouge">paste</code> function. You’ll need to use this later.
What is the difference between the <code class="language-plaintext highlighter-rouge">sep</code> and <code class="language-plaintext highlighter-rouge">collapse</code> arguments?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to Challenge 2</h2>

    <p>To look at the help for the <code class="language-plaintext highlighter-rouge">paste()</code> function, use:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">help</span><span class="p">(</span><span class="s2">"paste"</span><span class="p">)</span><span class="w">
</span><span class="o">?</span><span class="n">paste</span><span class="w">
</span></code></pre></div>    </div>
    <p>The difference between <code class="language-plaintext highlighter-rouge">sep</code> and <code class="language-plaintext highlighter-rouge">collapse</code> is a little
tricky. The <code class="language-plaintext highlighter-rouge">paste</code> function accepts any number of arguments, each of which
can be a vector of any length. The <code class="language-plaintext highlighter-rouge">sep</code> argument specifies the string
used between concatenated terms — by default, a space. The result is a
vector as long as the longest argument supplied to <code class="language-plaintext highlighter-rouge">paste</code>. In contrast,
<code class="language-plaintext highlighter-rouge">collapse</code> specifies that after concatenation the elements are <em>collapsed</em>
together using the given separator, the result being a single string.
e.g.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">paste</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">),</span><span class="w"> </span><span class="s2">"c"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a c" "b c"
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">paste</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">),</span><span class="w"> </span><span class="s2">"c"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">","</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a,c" "b,c"
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">paste</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">),</span><span class="w"> </span><span class="s2">"c"</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"|"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a c|b c"
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">paste</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">),</span><span class="w"> </span><span class="s2">"c"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">","</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"|"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a,c|b,c"
</code></pre></div>    </div>
    <p>(For more information,
scroll to the bottom of the <code class="language-plaintext highlighter-rouge">?paste</code> help page and look at the
examples, or try <code class="language-plaintext highlighter-rouge">example('paste')</code>.)</p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>
  <p>Use help to find a function (and its associated parameters) that you could
use to load data from a tabular file in which columns are delimited with “\t”
(tab) and the decimal point is a “.” (period). This check for decimal
separator is important, especially if you are working with international
colleagues, because different countries have different conventions for the
decimal point (i.e. comma vs period).
hint: use <code class="language-plaintext highlighter-rouge">??"read table"</code> to look up functions related to reading in tabular data.</p>
  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to Challenge 3</h2>

    <p>The standard R function for reading tab-delimited files with a period
decimal separator is read.delim(). You can also do this with
<code class="language-plaintext highlighter-rouge">read.table(file, sep="\t")</code> (the period is the <em>default</em> decimal
separator for <code class="language-plaintext highlighter-rouge">read.table()</code>, although you may have to change
the <code class="language-plaintext highlighter-rouge">comment.char</code> argument as well if your data file contains
hash (#) characters</p>
  </blockquote>
</blockquote>

<h2 id="other-ports-of-call">Other ports of call</h2>

<ul>
  <li><a href="http://www.statmethods.net/">Quick R</a></li>
  <li><a href="http://www.rstudio.com/resources/cheatsheets/">RStudio cheat sheets</a></li>
  <li><a href="http://www.cookbook-r.com/">Cookbook for R</a></li>
</ul>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">help()</code> to get online help in R.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="data-structures" class="maintitle">Data Structures</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 40 min
      <br />
      <strong>Exercises:</strong> 15 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I read data in R?</p>
</li>
	
	<li><p>What are the basic data types in R?</p>
</li>
	
	<li><p>How do I represent categorical information in R?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>To be able to identify the 5 main data types.</p>
</li>
	
	<li><p>To begin exploring data frames, and understand how they are related to vectors, factors and lists.</p>
</li>
	
	<li><p>To be able to ask questions from R about the type, class, and structure of an object.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>One of R’s most powerful features is its ability to deal with tabular data -
such as you may already have in a spreadsheet or a CSV file. Let’s start by
making a toy dataset in your <code class="language-plaintext highlighter-rouge">data/</code> directory, called <code class="language-plaintext highlighter-rouge">feline-data.csv</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">coat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"calico"</span><span class="p">,</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"tabby"</span><span class="p">),</span><span class="w">
                    </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2.1</span><span class="p">,</span><span class="w"> </span><span class="m">5.0</span><span class="p">,</span><span class="w"> </span><span class="m">3.2</span><span class="p">),</span><span class="w">
                    </span><span class="n">likes_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">write.csv</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cats</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data/feline-data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>The contents of the new file, <code class="language-plaintext highlighter-rouge">feline-data.csv</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">coat</span><span class="p">,</span><span class="n">weight</span><span class="p">,</span><span class="n">likes_string</span><span class="w">
</span><span class="n">calico</span><span class="p">,</span><span class="m">2.1</span><span class="p">,</span><span class="m">1</span><span class="w">
</span><span class="n">black</span><span class="p">,</span><span class="m">5.0</span><span class="p">,</span><span class="m">0</span><span class="w">
</span><span class="n">tabby</span><span class="p">,</span><span class="m">3.2</span><span class="p">,</span><span class="m">1</span><span class="w">
</span></code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-editing-text-files-in-r">Tip: Editing Text files in R</h2>

  <p>Alternatively, you can create <code class="language-plaintext highlighter-rouge">data/feline-data.csv</code> using a text editor (Nano),
or within RStudio with the <strong>File -&gt; New File -&gt; Text File</strong> menu item.</p>
</blockquote>

<p>We can load this into R via the following:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data/feline-data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">cats</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    coat weight likes_string
1 calico    2.1            1
2  black    5.0            0
3  tabby    3.2            1
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">read.table</code> function is used for reading in tabular data stored in a text
file where the columns of data are separated by punctuation characters such as
CSV files (csv = comma-separated values). Tabs and commas are the most common
punctuation characters used to separate or delimit data points in csv files.
For convenience R provides 2 other versions of <code class="language-plaintext highlighter-rouge">read.table</code>. These are: <code class="language-plaintext highlighter-rouge">read.csv</code>
for files where the data are separated with commas and <code class="language-plaintext highlighter-rouge">read.delim</code> for files
where the data are separated with tabs. Of these three functions <code class="language-plaintext highlighter-rouge">read.csv</code> is
the most commonly used.  If needed it is possible to override the default
delimiting punctuation marks for both <code class="language-plaintext highlighter-rouge">read.csv</code> and <code class="language-plaintext highlighter-rouge">read.delim</code>.</p>

<p>We can begin exploring our dataset right away, pulling out columns by specifying
them using the <code class="language-plaintext highlighter-rouge">$</code> operator:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="o">$</span><span class="n">weight</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2.1 5.0 3.2
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] calico black  tabby 
Levels: black calico tabby
</code></pre></div></div>

<p>We can do other operations on the columns:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Say we discovered that the scale weighs two Kg light:</span><span class="w">
</span><span class="n">cats</span><span class="o">$</span><span class="n">weight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 4.1 7.0 5.2
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">paste</span><span class="p">(</span><span class="s2">"My cat is"</span><span class="p">,</span><span class="w"> </span><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "My cat is calico" "My cat is black"  "My cat is tabby" 
</code></pre></div></div>

<p>But what about</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="o">$</span><span class="n">weight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext warning highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning in Ops.factor(cats$weight, cats$coat): '+' not meaningful for factors
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] NA NA NA
</code></pre></div></div>

<p>Understanding what happened here is key to successfully analyzing data in R.</p>

<h2 id="data-types">Data Types</h2>

<p>If you guessed that the last command will return an error because <code class="language-plaintext highlighter-rouge">2.1</code> plus
<code class="language-plaintext highlighter-rouge">"black"</code> is nonsense, you’re right - and you already have some intuition for an
important concept in programming called <em>data types</em>. We can ask what type of
data something is:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">weight</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "double"
</code></pre></div></div>

<p>There are 5 main types: <code class="language-plaintext highlighter-rouge">double</code>, <code class="language-plaintext highlighter-rouge">integer</code>, <code class="language-plaintext highlighter-rouge">complex</code>, <code class="language-plaintext highlighter-rouge">logical</code> and <code class="language-plaintext highlighter-rouge">character</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="m">3.14</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "double"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span><span class="w"> </span><span class="c1"># The L suffix forces the number to be an integer, since by default R uses float numbers</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "integer"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="m">1+1i</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "complex"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "logical"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="s1">'banana'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "character"
</code></pre></div></div>

<p>No matter how
complicated our analyses become, all data in R is interpreted as one of these
basic data types. This strictness has some really important consequences.</p>

<p>A user has added details of another cat. This information is in the file
<code class="language-plaintext highlighter-rouge">data/feline-data_v2.csv</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">file.show</span><span class="p">(</span><span class="s2">"data/feline-data_v2.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">coat</span><span class="p">,</span><span class="n">weight</span><span class="p">,</span><span class="n">likes_string</span><span class="w">
</span><span class="n">calico</span><span class="p">,</span><span class="m">2.1</span><span class="p">,</span><span class="m">1</span><span class="w">
</span><span class="n">black</span><span class="p">,</span><span class="m">5.0</span><span class="p">,</span><span class="m">0</span><span class="w">
</span><span class="n">tabby</span><span class="p">,</span><span class="m">3.2</span><span class="p">,</span><span class="m">1</span><span class="w">
</span><span class="n">tabby</span><span class="p">,</span><span class="m">2.3</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="m">2.4</span><span class="p">,</span><span class="m">1</span><span class="w">
</span></code></pre></div></div>

<p>Load the new cats data like before, and check what type of data we find in the
<code class="language-plaintext highlighter-rouge">weight</code> column:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"data/feline-data_v2.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">typeof</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">weight</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "integer"
</code></pre></div></div>

<p>Oh no, our weights aren’t the double type anymore! If we try to do the same math
we did on them before, we run into trouble:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="o">$</span><span class="n">weight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext warning highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning in Ops.factor(cats$weight, 2): '+' not meaningful for factors
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] NA NA NA NA
</code></pre></div></div>

<p>What happened? 
The <code class="language-plaintext highlighter-rouge">cats</code> data we are working with is something called a <em>data frame</em>. Data frames
are one of the most common and versatile types of <em>data structures</em> we will work with in R.
In this example, the columns that make up the data frame cannot be composed of different data types.
In this case, R does not read everything in the data frame as a <em>double</em>, therefore the entire 
column data type changes to something that is suitable for everything in the column.</p>

<p>When R reads a csv file, it reads it in as a <em>data frame</em>. Thus, when we loaded the <code class="language-plaintext highlighter-rouge">cats</code>
csv file, it is stored as a data frame. We can check this by using the function <code class="language-plaintext highlighter-rouge">class()</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">class</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "data.frame"
</code></pre></div></div>
<p><em>Data frames</em> are composed of rows and columns, where each column has the 
same number of rows. Different columns in a data frame can be made up of different 
data types (this is what makes them so versatile), but everything in a given
column needs to be the same type (e.g., vector, factor, or list).</p>

<p>Let’s explore more about different data structures and how they behave. 
For now, let’s remove that extra line from our cats data and reload it, 
while we investigate this behavior further:</p>

<p>feline-data.csv:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>coat,weight,likes_string
calico,2.1,1
black,5.0,0
tabby,3.2,1
</code></pre></div></div>

<p>And back in RStudio:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"data/feline-data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="vectors-and-type-coercion">Vectors and Type Coercion</h2>

<p>To better understand this behavior, let’s meet another of the data structures:
the <em>vector</em>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">my_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">my_vector</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] FALSE FALSE FALSE
</code></pre></div></div>

<p>A vector in R is essentially an ordered list of things, with the special
condition that <em>everything in the vector must be the same basic data type</em>. If
you don’t choose the datatype, it’ll default to <code class="language-plaintext highlighter-rouge">logical</code>; or, you can declare
an empty vector of whatever type you like.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">another_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">'character'</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">another_vector</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "" "" ""
</code></pre></div></div>

<p>You can check if something is a vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">another_vector</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> chr [1:3] "" "" ""
</code></pre></div></div>

<p>The somewhat cryptic output from this command indicates the basic data type
found in this vector - in this case <code class="language-plaintext highlighter-rouge">chr</code>, character; an indication of the
number of things in the vector - actually, the indexes of the vector, in this
case <code class="language-plaintext highlighter-rouge">[1:3]</code>; and a few examples of what’s actually in the vector - in this case
empty character strings. If we similarly do</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">weight</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> num [1:3] 2.1 5 3.2
</code></pre></div></div>

<p>we see that <code class="language-plaintext highlighter-rouge">cats$weight</code> is a vector, too - <em>the columns of data we load into R
data.frames are all vectors</em>, and that’s the root of why R forces everything in
a column to be the same basic data type.</p>

<blockquote class="discussion">
  <h2 id="discussion-1">Discussion 1</h2>

  <p>Why is R so opinionated about what we put in our columns of data?
How does this help us?</p>

  <blockquote class="solution">
    <h2 id="discussion-1-1">Discussion 1</h2>

    <p>By keeping everything in a column the same, we allow ourselves to make simple
assumptions about our data; if you can interpret one entry in the column as a
number, then you can interpret <em>all</em> of them as numbers, so we don’t have to
check every time. This consistency is what people mean when they talk about
<em>clean data</em>; in the long run, strict consistency goes a long way to making
our lives easier in R.</p>
  </blockquote>
</blockquote>

<p>You can also make vectors with explicit contents with the combine function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">combine_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">combine_vector</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2 6 3
</code></pre></div></div>

<p>Given what we’ve learned so far, what do you think the following will produce?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">quiz_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="s1">'3'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>This is something called <em>type coercion</em>, and it is the source of many surprises
and the reason why we need to be aware of the basic data types and how R will
interpret them. When R encounters a mix of types (here numeric and character) to
be combined into a single vector, it will force them all to be the same
type. Consider:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">coercion_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">coercion_vector</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a"    "TRUE"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">another_coercion_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">another_coercion_vector</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0 1
</code></pre></div></div>

<p>The coercion rules go: <code class="language-plaintext highlighter-rouge">logical</code> -&gt; <code class="language-plaintext highlighter-rouge">integer</code> -&gt; <code class="language-plaintext highlighter-rouge">numeric</code> -&gt; <code class="language-plaintext highlighter-rouge">complex</code> -&gt;
<code class="language-plaintext highlighter-rouge">character</code>, where -&gt; can be read as <em>are transformed into</em>. You can try to
force coercion against this flow using the <code class="language-plaintext highlighter-rouge">as.</code> functions:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">character_vector_example</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'0'</span><span class="p">,</span><span class="s1">'2'</span><span class="p">,</span><span class="s1">'4'</span><span class="p">)</span><span class="w">
</span><span class="n">character_vector_example</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "0" "2" "4"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">character_coerced_to_numeric</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">character_vector_example</span><span class="p">)</span><span class="w">
</span><span class="n">character_coerced_to_numeric</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0 2 4
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">numeric_coerced_to_logical</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.logical</span><span class="p">(</span><span class="n">character_coerced_to_numeric</span><span class="p">)</span><span class="w">
</span><span class="n">numeric_coerced_to_logical</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] FALSE  TRUE  TRUE
</code></pre></div></div>

<p>As you can see, some surprising things can happen when R forces one basic data
type into another! Nitty-gritty of type coercion aside, the point is: if your
data doesn’t look like what you thought it was going to look like, type coercion
may well be to blame; make sure everything is the same type in your vectors and
your columns of data.frames, or you will get nasty surprises!</p>

<p>But coercion can also be very useful! For example, in our <code class="language-plaintext highlighter-rouge">cats</code> data
<code class="language-plaintext highlighter-rouge">likes_string</code> is numeric, but we know that the 1s and 0s actually represent
<code class="language-plaintext highlighter-rouge">TRUE</code> and <code class="language-plaintext highlighter-rouge">FALSE</code> (a common way of representing them). We should use the
<code class="language-plaintext highlighter-rouge">logical</code> datatype here, which has two states: <code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code>, which is
exactly what our data represents. We can ‘coerce’ this column to be <code class="language-plaintext highlighter-rouge">logical</code> by
using the <code class="language-plaintext highlighter-rouge">as.logical</code> function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="o">$</span><span class="n">likes_string</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 0 1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="o">$</span><span class="n">likes_string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.logical</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">likes_string</span><span class="p">)</span><span class="w">
</span><span class="n">cats</span><span class="o">$</span><span class="n">likes_string</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  TRUE FALSE  TRUE
</code></pre></div></div>

<p>The combine function, <code class="language-plaintext highlighter-rouge">c()</code>, will also append things to an existing vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ab_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span><span class="w"> </span><span class="s1">'b'</span><span class="p">)</span><span class="w">
</span><span class="n">ab_vector</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a" "b"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">combine_example</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">ab_vector</span><span class="p">,</span><span class="w"> </span><span class="s1">'SWC'</span><span class="p">)</span><span class="w">
</span><span class="n">combine_example</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a"   "b"   "SWC"
</code></pre></div></div>

<p>You can also make series of numbers:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mySeries</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="w">
</span><span class="n">mySeries</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1]  1  2  3  4  5  6  7  8  9 10
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">seq</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1]  1  2  3  4  5  6  7  8  9 10
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">0.1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1]  1.0  1.1  1.2  1.3  1.4  1.5  1.6  1.7  1.8  1.9  2.0  2.1  2.2  2.3  2.4
[16]  2.5  2.6  2.7  2.8  2.9  3.0  3.1  3.2  3.3  3.4  3.5  3.6  3.7  3.8  3.9
[31]  4.0  4.1  4.2  4.3  4.4  4.5  4.6  4.7  4.8  4.9  5.0  5.1  5.2  5.3  5.4
[46]  5.5  5.6  5.7  5.8  5.9  6.0  6.1  6.2  6.3  6.4  6.5  6.6  6.7  6.8  6.9
[61]  7.0  7.1  7.2  7.3  7.4  7.5  7.6  7.7  7.8  7.9  8.0  8.1  8.2  8.3  8.4
[76]  8.5  8.6  8.7  8.8  8.9  9.0  9.1  9.2  9.3  9.4  9.5  9.6  9.7  9.8  9.9
[91] 10.0
</code></pre></div></div>

<p>We can ask a few questions about vectors:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sequence_example</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">sequence_example</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 2
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tail</span><span class="p">(</span><span class="n">sequence_example</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  7  8  9 10
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">sequence_example</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 10
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">class</span><span class="p">(</span><span class="n">sequence_example</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "integer"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">sequence_example</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "integer"
</code></pre></div></div>

<p>Finally, you can give names to elements in your vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">my_example</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">5</span><span class="o">:</span><span class="m">8</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">my_example</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"d"</span><span class="p">)</span><span class="w">
</span><span class="n">my_example</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a b c d 
5 6 7 8 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">my_example</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "a" "b" "c" "d"
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Start by making a vector with the numbers 1 through 26.
Multiply the vector by 2, and give the resulting vector
names A through Z (hint: there is a built in vector called <code class="language-plaintext highlighter-rouge">LETTERS</code>)</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to Challenge 1</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">26</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nb">LETTERS</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="data-frames">Data Frames</h2>

<p>We said that columns in data.frames were vectors:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">weight</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> num [1:3] 2.1 5 3.2
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">likes_string</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> logi [1:3] TRUE FALSE TRUE
</code></pre></div></div>

<p>These make sense. But what about</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Factor w/ 3 levels "black","calico",..: 2 1 3
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-renaming-data-frame-columns">Tip: Renaming data frame columns</h2>

  <p>Data frames have column names, which can be accessed with the <code class="language-plaintext highlighter-rouge">names()</code> function.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "coat"         "weight"       "likes_string"
</code></pre></div>  </div>

  <p>If you want to rename the second column of <code class="language-plaintext highlighter-rouge">cats</code>, you can assign a new name to the second element of <code class="language-plaintext highlighter-rouge">names(cats)</code>.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">cats</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"weight_kg"</span><span class="w">
</span><span class="n">cats</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    coat weight_kg likes_string
1 calico       2.1         TRUE
2  black       5.0        FALSE
3  tabby       3.2         TRUE
</code></pre></div>  </div>
</blockquote>

<h2 id="factors">Factors</h2>

<p>Another important data structure is called a <em>factor</em>. Factors usually look like
character data, but are typically used to represent categorical information. For
example, let’s make a vector of strings labelling cat colorations for all the
cats in our study:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">coats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'tabby'</span><span class="p">,</span><span class="w"> </span><span class="s1">'tortoiseshell'</span><span class="p">,</span><span class="w"> </span><span class="s1">'tortoiseshell'</span><span class="p">,</span><span class="w"> </span><span class="s1">'black'</span><span class="p">,</span><span class="w"> </span><span class="s1">'tabby'</span><span class="p">)</span><span class="w">
</span><span class="n">coats</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "tabby"         "tortoiseshell" "tortoiseshell" "black"        
[5] "tabby"        
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">coats</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> chr [1:5] "tabby" "tortoiseshell" "tortoiseshell" "black" "tabby"
</code></pre></div></div>

<p>We can turn a vector into a factor like so:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CATegories</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">coats</span><span class="p">)</span><span class="w">
</span><span class="nf">class</span><span class="p">(</span><span class="n">CATegories</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "factor"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">CATegories</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Factor w/ 3 levels "black","tabby",..: 2 3 3 1 2
</code></pre></div></div>

<p>Now R has noticed that there are three possible categories in our data - but it
also did something surprising; instead of printing out the strings we gave it,
we got a bunch of numbers instead. R has replaced our human-readable categories
with numbered indices under the hood, this is necessary as many statistical
calculations utilise such numerical representations for categorical data:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">coats</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "character"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">CATegories</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "integer"
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>Is there a factor in our <code class="language-plaintext highlighter-rouge">cats</code> data.frame? what is its name?
Try using <code class="language-plaintext highlighter-rouge">?read.csv</code> to figure out how to keep text columns as character
vectors instead of factors; then write a command or two to show that the factor
in <code class="language-plaintext highlighter-rouge">cats</code> is actually a character vector when loaded in this way.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to Challenge 2</h2>

    <p>One solution is use the argument <code class="language-plaintext highlighter-rouge">stringAsFactors</code>:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"data/feline-data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p>Another solution is use the argument <code class="language-plaintext highlighter-rouge">colClasses</code>
that allow finer control.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"data/feline-data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">colClasses</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="s2">"character"</span><span class="p">))</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p>Note: new students find the help files difficult to understand; make sure to let them know
that this is typical, and encourage them to take their best guess based on semantic meaning,
even if they aren’t sure.</p>
  </blockquote>
</blockquote>

<p>In modelling functions, it’s important to know what the baseline levels are. This
is assumed to be the first factor, but by default factors are labelled in
alphabetical order. You can change this by specifying the levels:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mydata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"case"</span><span class="p">,</span><span class="w"> </span><span class="s2">"control"</span><span class="p">,</span><span class="w"> </span><span class="s2">"control"</span><span class="p">,</span><span class="w"> </span><span class="s2">"case"</span><span class="p">)</span><span class="w">
</span><span class="n">factor_ordering_example</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">mydata</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"control"</span><span class="p">,</span><span class="w"> </span><span class="s2">"case"</span><span class="p">))</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">factor_ordering_example</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Factor w/ 2 levels "control","case": 2 1 1 2
</code></pre></div></div>

<p>In this case, we’ve explicitly told R that “control” should be represented by 1, and
“case” by 2. This designation can be very important for interpreting the
results of statistical models!</p>

<h2 id="lists">Lists</h2>

<p>Another data structure you’ll want in your bag of tricks is the <code class="language-plaintext highlighter-rouge">list</code>. A list
is simpler in some ways than the other types, because you can put anything you
want in it. Remember <em>everything in the vector must be the same basic data type</em>,
but a list can have different data types:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">list_example</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="m">1+4i</span><span class="p">)</span><span class="w">
</span><span class="n">list_example</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[[1]]
[1] 1

[[2]]
[1] "a"

[[3]]
[1] TRUE

[[4]]
[1] 1+4i
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">another_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Numbers"</span><span class="p">,</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">another_list</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$title
[1] "Numbers"

$numbers
 [1]  1  2  3  4  5  6  7  8  9 10

$data
[1] TRUE
</code></pre></div></div>

<p>We can now understand something a bit surprising in our data.frame; what happens if we run:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "list"
</code></pre></div></div>

<p>We see that data.frames look like lists ‘under the hood’ - this is because a
data.frame is really a list of vectors and factors, as they have to be - in
order to hold those columns that are a mix of vectors and factors, the
data.frame needs something a bit more flexible than a vector to put all the
columns together into a familiar table.  In other words, a <code class="language-plaintext highlighter-rouge">data.frame</code> is a
special list in which all the vectors must have the same length.</p>

<p>In our <code class="language-plaintext highlighter-rouge">cats</code> example, we have an integer, a double and a logical variable. As
we have seen already, each column of data.frame is a vector.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] calico black  tabby 
Levels: black calico tabby
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] calico black  tabby 
Levels: black calico tabby
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">cats</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "integer"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">cats</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Factor w/ 3 levels "black","calico",..: 2 1 3
</code></pre></div></div>

<p>Each row is an <em>observation</em> of different variables, itself a data.frame, and
thus can be composed of elements of different types.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="p">[</span><span class="m">1</span><span class="p">,]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    coat weight likes_string
1 calico    2.1            1
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">cats</span><span class="p">[</span><span class="m">1</span><span class="p">,])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "list"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">cats</span><span class="p">[</span><span class="m">1</span><span class="p">,])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	1 obs. of  3 variables:
 $ coat        : Factor w/ 3 levels "black","calico",..: 2
 $ weight      : num 2.1
 $ likes_string: num 1
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>

  <p>There are several subtly different ways to call variables, observations and
elements from data.frames:</p>

  <ul>
    <li><code class="language-plaintext highlighter-rouge">cats[1]</code></li>
    <li><code class="language-plaintext highlighter-rouge">cats[[1]]</code></li>
    <li><code class="language-plaintext highlighter-rouge">cats$coat</code></li>
    <li><code class="language-plaintext highlighter-rouge">cats["coat"]</code></li>
    <li><code class="language-plaintext highlighter-rouge">cats[1, 1]</code></li>
    <li><code class="language-plaintext highlighter-rouge">cats[, 1]</code></li>
    <li><code class="language-plaintext highlighter-rouge">cats[1, ]</code></li>
  </ul>

  <p>Try out these examples and explain what is returned by each one.</p>

  <p><em>Hint:</em> Use the function <code class="language-plaintext highlighter-rouge">typeof()</code> to examine what is returned in each case.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to Challenge 3</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    coat
1 calico
2  black
3  tabby
</code></pre></div>    </div>
    <p>We can think of a data frame as a list of vectors. The single brace <code class="language-plaintext highlighter-rouge">[1]</code>
returns the first slice of the list, as another list. In this case it is the
first column of the data frame.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] calico black  tabby 
Levels: black calico tabby
</code></pre></div>    </div>
    <p>The double brace <code class="language-plaintext highlighter-rouge">[[1]]</code> returns the contents of the list item. In this case
it is the contents of the first column, a <em>vector</em> of type <em>factor</em>.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] calico black  tabby 
Levels: black calico tabby
</code></pre></div>    </div>
    <p>This example uses the <code class="language-plaintext highlighter-rouge">$</code> character to address items by name. <em>coat</em> is the
first column of the data frame, again a <em>vector</em> of type <em>factor</em>.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="p">[</span><span class="s2">"coat"</span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    coat
1 calico
2  black
3  tabby
</code></pre></div>    </div>
    <p>Here we are using a single brace <code class="language-plaintext highlighter-rouge">["coat"]</code> replacing the index number with
the column name. Like example 1, the returned object is a <em>list</em>.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] calico
Levels: black calico tabby
</code></pre></div>    </div>
    <p>This example uses a single brace, but this time we provide row and column
coordinates. The returned object is the value in row 1, column 1. The object
is an <em>integer</em> but because it is part of a <em>vector</em> of type <em>factor</em>, R
displays the label “calico” associated with the integer value.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] calico black  tabby 
Levels: black calico tabby
</code></pre></div>    </div>
    <p>Like the previous example we use single braces and provide row and column
coordinates. The row coordinate is not specified, R interprets this missing
value as all the elements in this <em>column</em> <em>vector</em>.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    coat weight likes_string
1 calico    2.1            1
</code></pre></div>    </div>
    <p>Again we use the single brace with row and column coordinates. The column
coordinate is not specified. The return value is a <em>list</em> containing all the
values in the first row.</p>
  </blockquote>
</blockquote>

<h2 id="matrices">Matrices</h2>

<p>Last but not least is the matrix. We can declare a matrix full of zeros:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">matrix_example</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">matrix_example</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    0    0    0    0    0    0
[2,]    0    0    0    0    0    0
[3,]    0    0    0    0    0    0
</code></pre></div></div>

<p>And similar to other data structures, we can ask things about our matrix:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">class</span><span class="p">(</span><span class="n">matrix_example</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "matrix" "array" 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">matrix_example</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "double"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">matrix_example</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> num [1:3, 1:6] 0 0 0 0 0 0 0 0 0 0 ...
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">dim</span><span class="p">(</span><span class="n">matrix_example</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 3 6
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nrow</span><span class="p">(</span><span class="n">matrix_example</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 3
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ncol</span><span class="p">(</span><span class="n">matrix_example</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 6
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-4">Challenge 4</h2>

  <p>What do you think will be the result of
<code class="language-plaintext highlighter-rouge">length(matrix_example)</code>?
Try it.
Were you right? Why / why not?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-4">Solution to Challenge 4</h2>

    <p>What do you think will be the result of
<code class="language-plaintext highlighter-rouge">length(matrix_example)</code>?</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">matrix_example</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="nf">length</span><span class="p">(</span><span class="n">matrix_example</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 18
</code></pre></div>    </div>

    <p>Because a matrix is a vector with added dimension attributes, <code class="language-plaintext highlighter-rouge">length</code>
gives you the total number of elements in the matrix.</p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-5">Challenge 5</h2>

  <p>Make another matrix, this time containing the numbers 1:50,
with 5 columns and 10 rows.
Did the <code class="language-plaintext highlighter-rouge">matrix</code> function fill your matrix by column, or by
row, as its default behaviour?
See if you can figure out how to change this.
(hint: read the documentation for <code class="language-plaintext highlighter-rouge">matrix</code>!)</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-5">Solution to Challenge 5</h2>

    <p>Make another matrix, this time containing the numbers 1:50,
with 5 columns and 10 rows.
Did the <code class="language-plaintext highlighter-rouge">matrix</code> function fill your matrix by column, or by
row, as its default behaviour?
See if you can figure out how to change this.
(hint: read the documentation for <code class="language-plaintext highlighter-rouge">matrix</code>!)</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">byrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="c1"># to fill by row</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-6">Challenge 6</h2>
  <p>Create a list of length two containing a character vector for each of the sections in this part of the workshop:</p>

  <ul>
    <li>Data types</li>
    <li>Data structures</li>
  </ul>

  <p>Populate each character vector with the names of the data types and data
 structures we’ve seen so far.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-6">Solution to Challenge 6</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataTypes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'double'</span><span class="p">,</span><span class="w"> </span><span class="s1">'complex'</span><span class="p">,</span><span class="w"> </span><span class="s1">'integer'</span><span class="p">,</span><span class="w"> </span><span class="s1">'character'</span><span class="p">,</span><span class="w"> </span><span class="s1">'logical'</span><span class="p">)</span><span class="w">
</span><span class="n">dataStructures</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'data.frame'</span><span class="p">,</span><span class="w"> </span><span class="s1">'vector'</span><span class="p">,</span><span class="w"> </span><span class="s1">'factor'</span><span class="p">,</span><span class="w"> </span><span class="s1">'list'</span><span class="p">,</span><span class="w"> </span><span class="s1">'matrix'</span><span class="p">)</span><span class="w">
</span><span class="n">answer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">dataTypes</span><span class="p">,</span><span class="w"> </span><span class="n">dataStructures</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Note: it’s nice to make a list in big writing on the board or taped to the wall
listing all of these types and structures - leave it up for the rest of the workshop
to remind people of the importance of these basics.</p>

  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-7">Challenge 7</h2>

  <p>Consider the R output of the matrix below:</p>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1] [,2]
[1,]    4    1
[2,]    9    5
[3,]   10    7
</code></pre></div>  </div>
  <p>What was the correct command used to write this matrix? Examine
each command and try to figure out the correct one before typing them.
Think about what matrices the other commands will produce.</p>

  <ol>
    <li><code class="language-plaintext highlighter-rouge">matrix(c(4, 1, 9, 5, 10, 7), nrow = 3)</code></li>
    <li><code class="language-plaintext highlighter-rouge">matrix(c(4, 9, 10, 1, 5, 7), ncol = 2, byrow = TRUE)</code></li>
    <li><code class="language-plaintext highlighter-rouge">matrix(c(4, 9, 10, 1, 5, 7), nrow = 2)</code></li>
    <li><code class="language-plaintext highlighter-rouge">matrix(c(4, 1, 9, 5, 10, 7), ncol = 2, byrow = TRUE)</code></li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-7">Solution to Challenge 7</h2>

    <p>Consider the R output of the matrix below:</p>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1] [,2]
[1,]    4    1
[2,]    9    5
[3,]   10    7
</code></pre></div>    </div>
    <p>What was the correct command used to write this matrix? Examine
each command and try to figure out the correct one before typing them.
Think about what matrices the other commands will produce.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">byrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">read.csv</code> to read tabular data in R.</p>
</li>
    
    <li><p>The basic data types in R are double, integer, complex, logical, and character.</p>
</li>
    
    <li><p>Use factors to represent categories in R.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="exploring-data-frames" class="maintitle">Exploring Data Frames</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 20 min
      <br />
      <strong>Exercises:</strong> 10 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I manipulate a data frame?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Add and remove rows or columns.</p>
</li>
	
	<li><p>Remove rows with <code class="language-plaintext highlighter-rouge">NA</code> values.</p>
</li>
	
	<li><p>Append two data frames.</p>
</li>
	
	<li><p>Understand what a <code class="language-plaintext highlighter-rouge">factor</code> is.</p>
</li>
	
	<li><p>Convert a <code class="language-plaintext highlighter-rouge">factor</code> to a <code class="language-plaintext highlighter-rouge">character</code> vector and vice versa.</p>
</li>
	
	<li><p>Display basic properties of data frames including size and class of the columns, names, and first few rows.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>At this point, you’ve seen it all: in the last lesson, we toured all the basic
data types and data structures in R. Everything you do will be a manipulation of
those tools. But most of the time, the star of the show is the data frame—the table that we created by loading information from a csv file. In this lesson, we’ll learn a few more things
about working with data frames.</p>

<h2 id="adding-columns-and-rows-in-data-frames">Adding columns and rows in data frames</h2>

<p>We already learned that the columns of a data frame are vectors, so that our
data are consistent in type throughout the columns. As such, if we want to add a
new column, we can start by making a new vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">cats</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    coat weight likes_string
1 calico    2.1            1
2  black    5.0            0
3  tabby    3.2            1
</code></pre></div></div>

<p>We can then add this as a column via:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cbind</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    coat weight likes_string age
1 calico    2.1            1   2
2  black    5.0            0   3
3  tabby    3.2            1   5
</code></pre></div></div>

<p>Note that if we tried to add a vector of ages with a different number of entries than the number of rows in the data frame, it would fail:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w">
</span><span class="n">cbind</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in data.frame(..., check.names = FALSE): arguments imply differing number of rows: 3, 4
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">cbind</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in data.frame(..., check.names = FALSE): arguments imply differing number of rows: 3, 2
</code></pre></div></div>

<p>Why didn’t this work? Of course, R wants to see one element in our new column
for every row in the table:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nrow</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 3
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">age</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2
</code></pre></div></div>

<p>So for it to work we need to have <code class="language-plaintext highlighter-rouge">nrow(cats)</code> = <code class="language-plaintext highlighter-rouge">length(age)</code>. Let’s overwrite the content of cats with our new data frame.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">cats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now how about adding rows? We already know that the rows of a
data frame are lists:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">newRow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s2">"tortoiseshell"</span><span class="p">,</span><span class="w"> </span><span class="m">3.3</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w">
</span><span class="n">cats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span><span class="w"> </span><span class="n">newRow</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext warning highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning in `[&lt;-.factor`(`*tmp*`, ri, value = "tortoiseshell"): invalid factor
level, NA generated
</code></pre></div></div>

<p>Looks like our attempt to use the <code class="language-plaintext highlighter-rouge">rbind()</code> function returns a warning.  Recall that, unlike errors, warnings do not necessarily stop a function from performing its intended action.  You can confirm this by taking a look at the <code class="language-plaintext highlighter-rouge">cats</code> data frame.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    coat weight likes_string age
1 calico    2.1            1   2
2  black    5.0            0   3
3  tabby    3.2            1   5
4   &lt;NA&gt;    3.3            1   9
</code></pre></div></div>

<p>Notice that not only did we successfully add a new row, but there is <code class="language-plaintext highlighter-rouge">NA</code> in the column <em>coats</em> where we expected “tortoiseshell” to be.  Why did this happen?</p>

<h2 id="factors">Factors</h2>

<p>For an object containing the data type <code class="language-plaintext highlighter-rouge">factor</code>, each different value represents what is called a <code class="language-plaintext highlighter-rouge">level</code>. In our case, the <code class="language-plaintext highlighter-rouge">factor</code> “coat” has 3 levels: “black”, “calico”, and “tabby”. R will only accept values that match one of the levels. If you add a new value, it will become <code class="language-plaintext highlighter-rouge">NA</code>.</p>

<p>The warning is telling us that we unsuccessfully added “tortoiseshell” to our
<em>coat</em> factor, but 3.3 (a numeric), TRUE (a logical), and 9 (a numeric) were
successfully added to <em>weight</em>, <em>likes_string</em>, and <em>age</em>, respectively, since
those variables are not factors. To successfully add a cat with a
“tortoiseshell” <em>coat</em>, add “tortoiseshell” as a possible <em>level</em> of the factor:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">levels</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "black"  "calico" "tabby" 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">levels</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="p">),</span><span class="w"> </span><span class="s2">"tortoiseshell"</span><span class="p">)</span><span class="w">
</span><span class="n">cats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s2">"tortoiseshell"</span><span class="p">,</span><span class="w"> </span><span class="m">3.3</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Alternatively, we can change a factor into a character vector; we lose the
handy categories of the factor, but we can subsequently add any word we want to the
column without babysitting the factor levels:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	5 obs. of  4 variables:
 $ coat        : Factor w/ 4 levels "black","calico",..: 2 1 3 NA 4
 $ weight      : num  2.1 5 3.2 3.3 3.3
 $ likes_string: int  1 0 1 1 1
 $ age         : num  2 3 5 9 9
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">cats</span><span class="o">$</span><span class="n">coat</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	5 obs. of  4 variables:
 $ coat        : chr  "calico" "black" "tabby" NA ...
 $ weight      : num  2.1 5 3.2 3.3 3.3
 $ likes_string: int  1 0 1 1 1
 $ age         : num  2 3 5 9 9
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>
  <p>Let’s imagine that 1 cat year is equivalent to 7 human years.</p>
  <ol>
    <li>Create a vector called <code class="language-plaintext highlighter-rouge">human_age</code> by multiplying <code class="language-plaintext highlighter-rouge">cats$age</code> by 7.</li>
    <li>Convert <code class="language-plaintext highlighter-rouge">human_age</code> to a factor.</li>
    <li>Convert <code class="language-plaintext highlighter-rouge">human_age</code> back to a numeric vector using the <code class="language-plaintext highlighter-rouge">as.numeric()</code> function. Now divide it by 7 to get the original ages back. Explain what happened.</li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to Challenge 1</h2>
    <ol>
      <li><code class="language-plaintext highlighter-rouge">human_age &lt;- cats$age * 7</code></li>
      <li><code class="language-plaintext highlighter-rouge">human_age &lt;- factor(human_age)</code>. <code class="language-plaintext highlighter-rouge">as.factor(human_age)</code> works just as well.</li>
      <li><code class="language-plaintext highlighter-rouge">as.numeric(human_age)</code> yields <code class="language-plaintext highlighter-rouge">1 2 3 4 4</code> because factors are stored as integers (here, 1:4), each of which is associated with a label (here, 28, 35, 56, and 63). Converting the factor to a numeric vector gives us the underlying integers, not the labels. If we want the original numbers, we need to convert <code class="language-plaintext highlighter-rouge">human_age</code> to a character vector (using <code class="language-plaintext highlighter-rouge">as.character(human_age)</code>) and then to a numeric vector (why does this work?). This comes up in real life when we accidentally include a character somewhere in a column of a .csv file supposed to only contain numbers, and forget to set <code class="language-plaintext highlighter-rouge">stringsAsFactors=FALSE</code> when we read in the data.</li>
    </ol>
  </blockquote>
</blockquote>

<h2 id="removing-rows">Removing rows</h2>

<p>We now know how to add rows and columns to our data frame in R—but in our
first attempt to add a “tortoiseshell” cat to the data frame we have accidentally
added a garbage row:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           coat weight likes_string age
1        calico    2.1            1   2
2         black    5.0            0   3
3         tabby    3.2            1   5
4          &lt;NA&gt;    3.3            1   9
5 tortoiseshell    3.3            1   9
</code></pre></div></div>

<p>We can ask for a data frame minus this offending row:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="p">[</span><span class="m">-4</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           coat weight likes_string age
1        calico    2.1            1   2
2         black    5.0            0   3
3         tabby    3.2            1   5
5 tortoiseshell    3.3            1   9
</code></pre></div></div>

<p>Notice the comma with nothing after it to indicate that we want to drop the entire fourth row.</p>

<p>Note: we could also remove both new rows at once by putting the row numbers
inside of a vector: <code class="language-plaintext highlighter-rouge">cats[c(-4,-5), ]</code></p>

<p>Alternatively, we can drop all rows with <code class="language-plaintext highlighter-rouge">NA</code> values:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">na.omit</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           coat weight likes_string age
1        calico    2.1            1   2
2         black    5.0            0   3
3         tabby    3.2            1   5
5 tortoiseshell    3.3            1   9
</code></pre></div></div>

<p>Let’s reassign the output to <code class="language-plaintext highlighter-rouge">cats</code>, so that our changes will be permanent:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">na.omit</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="removing-columns">Removing columns</h2>

<p>We can also remove columns in our data frame. What if we want to remove the column “age”. We can remove it in two ways, by variable number or by index.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="p">[,</span><span class="m">-4</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           coat weight likes_string
1        calico    2.1            1
2         black    5.0            0
3         tabby    3.2            1
5 tortoiseshell    3.3            1
</code></pre></div></div>

<p>Notice the comma with nothing before it, indicating we want to keep all of the rows.</p>

<p>Alternatively, we can drop the column by using the index name and the <code class="language-plaintext highlighter-rouge">%in%</code> operator. The <code class="language-plaintext highlighter-rouge">%in%</code> operator goes through each element of its left argument, in this case the names of <code class="language-plaintext highlighter-rouge">cats</code>, and asks, “Does this element occur in the second argument?”</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"age"</span><span class="p">)</span><span class="w">
</span><span class="n">cats</span><span class="p">[,</span><span class="o">!</span><span class="n">drop</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           coat weight likes_string
1        calico    2.1            1
2         black    5.0            0
3         tabby    3.2            1
5 tortoiseshell    3.3            1
</code></pre></div></div>

<p>We will cover subsetting with logical operators like <code class="language-plaintext highlighter-rouge">%in%</code> in more detail in the next episode. See the section <a href="../06-data-subsetting/#logical-operations">Subsetting through other logical operations</a></p>

<h2 id="appending-to-a-data-frame">Appending to a data frame</h2>

<p>The key to remember when adding data to a data frame is that <em>columns are
vectors and rows are lists.</em> We can also glue two data frames
together with <code class="language-plaintext highlighter-rouge">rbind</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span><span class="w"> </span><span class="n">cats</span><span class="p">)</span><span class="w">
</span><span class="n">cats</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            coat weight likes_string age
1         calico    2.1            1   2
2          black    5.0            0   3
3          tabby    3.2            1   5
5  tortoiseshell    3.3            1   9
11        calico    2.1            1   2
21         black    5.0            0   3
31         tabby    3.2            1   5
51 tortoiseshell    3.3            1   9
</code></pre></div></div>
<p>But now the row names are unnecessarily complicated. We can remove the rownames,
and R will automatically re-name them sequentially:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rownames</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="n">cats</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           coat weight likes_string age
1        calico    2.1            1   2
2         black    5.0            0   3
3         tabby    3.2            1   5
4 tortoiseshell    3.3            1   9
5        calico    2.1            1   2
6         black    5.0            0   3
7         tabby    3.2            1   5
8 tortoiseshell    3.3            1   9
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>You can create a new data frame right from within R with the following syntax:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c"</span><span class="p">),</span><span class="w">
                 </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w">
                 </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">),</span><span class="w">
                 </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>
  <p>Make a data frame that holds the following information for yourself:</p>

  <ul>
    <li>first name</li>
    <li>last name</li>
    <li>lucky number</li>
  </ul>

  <p>Then use <code class="language-plaintext highlighter-rouge">rbind</code> to add an entry for the people sitting beside you.
Finally, use <code class="language-plaintext highlighter-rouge">cbind</code> to add a column with each person’s answer to the question, “Is it time for coffee break?”</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to Challenge 2</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Grace"</span><span class="p">),</span><span class="w">
                 </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Hopper"</span><span class="p">),</span><span class="w">
                 </span><span class="n">lucky_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="w">
                 </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s2">"Marie"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Curie"</span><span class="p">,</span><span class="w"> </span><span class="m">238</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">coffeetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="realistic-example">Realistic example</h2>
<p>So far, you have seen the basics of manipulating data frames with our cat data;
now let’s use those skills to digest a more realistic dataset. Let’s read in the
<code class="language-plaintext highlighter-rouge">gapminder</code> dataset that we downloaded previously:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/gapminder_data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote class="callout">
  <h2 id="miscellaneous-tips">Miscellaneous Tips</h2>

  <ul>
    <li>
      <p>Another type of file you might encounter are tab-separated value files (.tsv). To specify a tab as a separator, use <code class="language-plaintext highlighter-rouge">"\\t"</code> or <code class="language-plaintext highlighter-rouge">read.delim()</code>.</p>
    </li>
    <li>
      <p>Files can also be downloaded directly from the Internet into a local
folder of your choice onto your computer using the <code class="language-plaintext highlighter-rouge">download.file</code> function.
The <code class="language-plaintext highlighter-rouge">read.csv</code> function can then be executed to read the downloaded file from the download location, for example,</p>
    </li>
  </ul>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">download.file</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/_episodes_rmd/data/gapminder_data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">destfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data/gapminder_data.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">gapminder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/gapminder_data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <ul>
    <li>Alternatively, you can also read in files directly into R from the Internet by replacing the file paths with a web address in <code class="language-plaintext highlighter-rouge">read.csv</code>. One should note that in doing this no local copy of the csv file is first saved onto your computer. For example,</li>
  </ul>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/_episodes_rmd/data/gapminder_data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <ul>
    <li>You can read directly from excel spreadsheets without
converting them to plain text first by using the <a href="https://cran.r-project.org/package=readxl">readxl</a> package.</li>
  </ul>
</blockquote>

<p>Let’s investigate gapminder a bit; the first thing we should always do is check
out what the data looks like with <code class="language-plaintext highlighter-rouge">str</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : Factor w/ 142 levels "Afghanistan",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: Factor w/ 5 levels "Africa","Americas",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...
</code></pre></div></div>

<p>An additional method for examining the structure of gapminder is to use the <code class="language-plaintext highlighter-rouge">summary</code> function. This function can be used on various objects in R. For data frames, <code class="language-plaintext highlighter-rouge">summary</code> yields a numeric, tabular, or descriptive summary of each column. Factor columns are summarized by the number of items in each level, numeric or integer columns by the descriptive statistics (quartiles and mean), and character columns by its length, class, and mode.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>             Afghanistan                  Albania                  Algeria 
                      12                       12                       12 
                  Angola                Argentina                Australia 
                      12                       12                       12 
                 Austria                  Bahrain               Bangladesh 
                      12                       12                       12 
                 Belgium                    Benin                  Bolivia 
                      12                       12                       12 
  Bosnia and Herzegovina                 Botswana                   Brazil 
                      12                       12                       12 
                Bulgaria             Burkina Faso                  Burundi 
                      12                       12                       12 
                Cambodia                 Cameroon                   Canada 
                      12                       12                       12 
Central African Republic                     Chad                    Chile 
                      12                       12                       12 
                   China                 Colombia                  Comoros 
                      12                       12                       12 
         Congo Dem. Rep.               Congo Rep.               Costa Rica 
                      12                       12                       12 
           Cote d'Ivoire                  Croatia                     Cuba 
                      12                       12                       12 
          Czech Republic                  Denmark                 Djibouti 
                      12                       12                       12 
      Dominican Republic                  Ecuador                    Egypt 
                      12                       12                       12 
             El Salvador        Equatorial Guinea                  Eritrea 
                      12                       12                       12 
                Ethiopia                  Finland                   France 
                      12                       12                       12 
                   Gabon                   Gambia                  Germany 
                      12                       12                       12 
                   Ghana                   Greece                Guatemala 
                      12                       12                       12 
                  Guinea            Guinea-Bissau                    Haiti 
                      12                       12                       12 
                Honduras          Hong Kong China                  Hungary 
                      12                       12                       12 
                 Iceland                    India                Indonesia 
                      12                       12                       12 
                    Iran                     Iraq                  Ireland 
                      12                       12                       12 
                  Israel                    Italy                  Jamaica 
                      12                       12                       12 
                   Japan                   Jordan                    Kenya 
                      12                       12                       12 
         Korea Dem. Rep.               Korea Rep.                   Kuwait 
                      12                       12                       12 
                 Lebanon                  Lesotho                  Liberia 
                      12                       12                       12 
                   Libya               Madagascar                   Malawi 
                      12                       12                       12 
                Malaysia                     Mali               Mauritania 
                      12                       12                       12 
               Mauritius                   Mexico                 Mongolia 
                      12                       12                       12 
              Montenegro                  Morocco               Mozambique 
                      12                       12                       12 
                 Myanmar                  Namibia                    Nepal 
                      12                       12                       12 
             Netherlands              New Zealand                Nicaragua 
                      12                       12                       12 
                   Niger                  Nigeria                   Norway 
                      12                       12                       12 
                    Oman                 Pakistan                   Panama 
                      12                       12                       12 
                 (Other) 
                     516 
</code></pre></div></div>

<p>Along with the <code class="language-plaintext highlighter-rouge">str</code> and <code class="language-plaintext highlighter-rouge">summary</code> functions, we can examine individual columns of the data frame with our <code class="language-plaintext highlighter-rouge">typeof</code> function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "integer"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "integer"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Factor w/ 142 levels "Afghanistan",..: 1 1 1 1 1 1 1 1 1 1 ...
</code></pre></div></div>

<p>We can also interrogate the data frame for information about its dimensions;
remembering that <code class="language-plaintext highlighter-rouge">str(gapminder)</code> said there were 1704 observations of 6
variables in gapminder, what do you think the following will produce, and why?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 6
</code></pre></div></div>

<p>A fair guess would have been to say that the length of a data frame would be the
number of rows it has (1704), but this is not the case; remember, a data frame
is a <em>list of vectors and factors</em>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "list"
</code></pre></div></div>

<p>When <code class="language-plaintext highlighter-rouge">length</code> gave us 6, it’s because gapminder is built out of a list of 6
columns. To get the number of rows and columns in our dataset, try:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nrow</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1704
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ncol</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 6
</code></pre></div></div>

<p>Or, both at once:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">dim</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1704    6
</code></pre></div></div>

<p>We’ll also likely want to know what the titles of all the columns are, so we can
ask for them later:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colnames</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "country"   "year"      "pop"       "continent" "lifeExp"   "gdpPercap"
</code></pre></div></div>

<p>At this stage, it’s important to ask ourselves if the structure R is reporting
matches our intuition or expectations; do the basic data types reported for each
column make sense? If not, we need to sort any problems out now before they turn
into bad surprises down the road, using what we’ve learned about how R
interprets data, and the importance of <em>strict consistency</em> in how we record our
data.</p>

<p>Once we’re happy that the data types and structures seem reasonable, it’s time
to start digging into our data proper. Check out the first few lines:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
4 Afghanistan 1967 11537966      Asia  34.020  836.1971
5 Afghanistan 1972 13079460      Asia  36.088  739.9811
6 Afghanistan 1977 14880372      Asia  38.438  786.1134
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>

  <p>It’s good practice to also check the last few lines of your data and some in the middle. How would you do this?</p>

  <p>Searching for ones specifically in the middle isn’t too hard, but we could ask for a few lines at random. How would you code this?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to Challenge 3</h2>
    <p>To check the last few lines it’s relatively simple as R already has a function for this:</p>

    <div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tail(gapminder)
tail(gapminder, n = 15)
</code></pre></div>    </div>

    <p>What about a few arbitrary rows just in case something is odd in the middle?</p>
    <h2 id="tip-there-are-several-ways-to-achieve-this">Tip: There are several ways to achieve this.</h2>
    <p>The solution here presents one form of using nested functions, i.e. a function passed as an argument to another function. This might sound like a new concept, but you are already using it!
Remember my_dataframe[rows, cols] will print to screen your data frame with the number of rows and columns you asked for (although you might have asked for a range or named columns for example). How would you get the last row if you don’t know how many rows your data frame has? R has a function for this. What about getting a (pseudorandom) sample? R also has a function for this.</p>
    <div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gapminder[sample(nrow(gapminder), 5), ]
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<p>To make sure our analysis is reproducible, we should put the code
into a script file so we can come back to it later.</p>

<blockquote class="challenge">
  <h2 id="challenge-4">Challenge 4</h2>

  <p>Go to file -&gt; new file -&gt; R script, and write an R script
to load in the gapminder dataset. Put it in the <code class="language-plaintext highlighter-rouge">scripts/</code>
directory and add it to version control.</p>

  <p>Run the script using the <code class="language-plaintext highlighter-rouge">source</code> function, using the file path
as its argument (or by pressing the “source” button in RStudio).</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-4">Solution to Challenge 4</h2>

    <p>The <code class="language-plaintext highlighter-rouge">source</code> function can be used to use a script within a script.
Assume you would like to load the same type of file over and over
again and therefore you need to specify the arguments to fit the
needs of your file. Instead of writing the necessary argument again
and again you could just write it once and save it as a script. Then,
you can use <code class="language-plaintext highlighter-rouge">source("Your_Script_containing_the_load_function")</code> in a new
script to use the function of that script without writing everything again.
Check out <code class="language-plaintext highlighter-rouge">?source</code> to find out more.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">download.file</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/_episodes_rmd/data/gapminder_data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">destfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data/gapminder_data.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">gapminder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data/gapminder_data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>To run the script and load the data into the <code class="language-plaintext highlighter-rouge">gapminder</code> variable:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"scripts/load-gapminder.R"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-5">Challenge 5</h2>

  <p>Read the output of <code class="language-plaintext highlighter-rouge">str(gapminder)</code> again;
this time, use what you’ve learned about factors, lists and vectors,
as well as the output of functions like <code class="language-plaintext highlighter-rouge">colnames</code> and <code class="language-plaintext highlighter-rouge">dim</code>
to explain what everything that <code class="language-plaintext highlighter-rouge">str</code> prints out for gapminder means.
If there are any parts you can’t interpret, discuss with your neighbors!</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-5">Solution to Challenge 5</h2>

    <p>The object <code class="language-plaintext highlighter-rouge">gapminder</code> is a data frame with columns</p>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">country</code> and <code class="language-plaintext highlighter-rouge">continent</code> are factors.</li>
      <li><code class="language-plaintext highlighter-rouge">year</code> is an integer vector.</li>
      <li><code class="language-plaintext highlighter-rouge">pop</code>, <code class="language-plaintext highlighter-rouge">lifeExp</code>, and <code class="language-plaintext highlighter-rouge">gdpPercap</code> are numeric vectors.</li>
    </ul>

  </blockquote>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">cbind()</code> to add a new column to a data frame.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">rbind()</code> to add a new row to a data frame.</p>
</li>
    
    <li><p>Remove rows from a data frame.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">na.omit()</code> to remove rows from a data frame with <code class="language-plaintext highlighter-rouge">NA</code> values.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">levels()</code> and <code class="language-plaintext highlighter-rouge">as.character()</code> to explore and manipulate factors.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">str()</code>, <code class="language-plaintext highlighter-rouge">summary()</code>, <code class="language-plaintext highlighter-rouge">nrow()</code>, <code class="language-plaintext highlighter-rouge">ncol()</code>, <code class="language-plaintext highlighter-rouge">dim()</code>, <code class="language-plaintext highlighter-rouge">colnames()</code>, <code class="language-plaintext highlighter-rouge">rownames()</code>, <code class="language-plaintext highlighter-rouge">head()</code>, and <code class="language-plaintext highlighter-rouge">typeof()</code> to understand the structure of a data frame.</p>
</li>
    
    <li><p>Read in a csv file using <code class="language-plaintext highlighter-rouge">read.csv()</code>.</p>
</li>
    
    <li><p>Understand what <code class="language-plaintext highlighter-rouge">length()</code> of a data frame represents.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="subsetting-data" class="maintitle">Subsetting Data</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 35 min
      <br />
      <strong>Exercises:</strong> 15 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I work with subsets of data in R?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>To be able to subset vectors, factors, matrices, lists, and data frames</p>
</li>
	
	<li><p>To be able to extract individual and multiple elements: by index, by name, using comparison operations</p>
</li>
	
	<li><p>To be able to skip and remove elements from various data structures.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>R has many powerful subset operators. Mastering them will allow you to
easily perform complex operations on any kind of dataset.</p>

<p>There are six different ways we can subset any kind of object, and three
different subsetting operators for the different data structures.</p>

<p>Let’s start with the workhorse of R: a simple numeric vector.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5.4</span><span class="p">,</span><span class="w"> </span><span class="m">6.2</span><span class="p">,</span><span class="w"> </span><span class="m">7.1</span><span class="p">,</span><span class="w"> </span><span class="m">4.8</span><span class="p">,</span><span class="w"> </span><span class="m">7.5</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span><span class="w"> </span><span class="s1">'b'</span><span class="p">,</span><span class="w"> </span><span class="s1">'c'</span><span class="p">,</span><span class="w"> </span><span class="s1">'d'</span><span class="p">,</span><span class="w"> </span><span class="s1">'e'</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a   b   c   d   e 
5.4 6.2 7.1 4.8 7.5 
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="atomic-vectors">Atomic vectors</h2>

  <p>In R, simple vectors containing character strings, numbers, or logical values are called <em>atomic</em> vectors because they can’t be further simplified.</p>
</blockquote>

<p>So now that we’ve created a dummy vector to play with, how do we get at its
contents?</p>

<h2 id="accessing-elements-using-their-indices">Accessing elements using their indices</h2>

<p>To extract elements of a vector we can give their corresponding index, starting
from one:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a 
5.4 
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="m">4</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  d 
4.8 
</code></pre></div></div>

<p>It may look different, but the square brackets operator is a function. For vectors
(and matrices), it means “get me the nth element”.</p>

<p>We can ask for multiple elements at once:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a   c 
5.4 7.1 
</code></pre></div></div>

<p>Or slices of the vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a   b   c   d 
5.4 6.2 7.1 4.8 
</code></pre></div></div>

<p>the <code class="language-plaintext highlighter-rouge">:</code> operator creates a sequence of numbers from the left element to the right.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 2 3 4
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 2 3 4
</code></pre></div></div>

<p>We can ask for the same element multiple times:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a   a   c 
5.4 5.4 7.1 
</code></pre></div></div>

<p>If we ask for an index beyond the length of the vector, R will return a missing value:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="m">6</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;NA&gt; 
  NA 
</code></pre></div></div>

<p>This is a vector of length one containing an <code class="language-plaintext highlighter-rouge">NA</code>, whose name is also <code class="language-plaintext highlighter-rouge">NA</code>.</p>

<p>If we ask for the 0th element, we get an empty vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>named numeric(0)
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="vector-numbering-in-r-starts-at-1">Vector numbering in R starts at 1</h2>

  <p>In many programming languages (C and Python, for example), the first
element of a vector has an index of 0. In R, the first element is 1.</p>
</blockquote>

<h2 id="skipping-and-removing-elements">Skipping and removing elements</h2>

<p>If we use a negative number as the index of a vector, R will return
every element <em>except</em> for the one specified:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="m">-2</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a   c   d   e 
5.4 7.1 4.8 7.5 
</code></pre></div></div>

<p>We can skip multiple elements:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">-5</span><span class="p">)]</span><span class="w">  </span><span class="c1"># or x[-c(1,5)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  b   c   d 
6.2 7.1 4.8 
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-order-of-operations">Tip: Order of operations</h2>

  <p>A common trip up for novices occurs when trying to skip
slices of a vector. It’s natural to try to negate a
sequence like so:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="m">-1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span><span class="w">
</span></code></pre></div>  </div>

  <p>This gives a somewhat cryptic error:</p>

  <div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in x[-1:3]: only 0's may be mixed with negative subscripts
</code></pre></div>  </div>

  <p>But remember the order of operations. <code class="language-plaintext highlighter-rouge">:</code> is really a function.
It takes its first argument as -1, and its second as 3,
so generates the sequence of numbers: <code class="language-plaintext highlighter-rouge">c(-1, 0, 1, 2, 3)</code>.</p>

  <p>The correct solution is to wrap that function call in brackets, so
that the <code class="language-plaintext highlighter-rouge">-</code> operator applies to the result:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)]</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  d   e 
4.8 7.5 
</code></pre></div>  </div>
</blockquote>

<p>To remove elements from a vector, we need to assign the result back
into the variable:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="m">-4</span><span class="p">]</span><span class="w">
</span><span class="n">x</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a   b   c   e 
5.4 6.2 7.1 7.5 
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Given the following code:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5.4</span><span class="p">,</span><span class="w"> </span><span class="m">6.2</span><span class="p">,</span><span class="w"> </span><span class="m">7.1</span><span class="p">,</span><span class="w"> </span><span class="m">4.8</span><span class="p">,</span><span class="w"> </span><span class="m">7.5</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span><span class="w"> </span><span class="s1">'b'</span><span class="p">,</span><span class="w"> </span><span class="s1">'c'</span><span class="p">,</span><span class="w"> </span><span class="s1">'d'</span><span class="p">,</span><span class="w"> </span><span class="s1">'e'</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a   b   c   d   e 
5.4 6.2 7.1 4.8 7.5 
</code></pre></div>  </div>

  <p>Come up with at least 2 different commands that will produce the following output:</p>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  b   c   d 
6.2 7.1 4.8 
</code></pre></div>  </div>

  <p>After you find 2 different commands, compare notes with your neighbour. Did you have different strategies?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to challenge 1</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  b   c   d 
6.2 7.1 4.8 
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="p">)]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  b   c   d 
6.2 7.1 4.8 
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  b   c   d 
6.2 7.1 4.8 
</code></pre></div>    </div>

  </blockquote>
</blockquote>

<h2 id="subsetting-by-name">Subsetting by name</h2>

<p>We can extract elements by using their name, instead of extracting by index:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">5.4</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="m">6.2</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="m">7.1</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="m">4.8</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="o">=</span><span class="m">7.5</span><span class="p">)</span><span class="w"> </span><span class="c1"># we can name a vector 'on the fly'</span><span class="w">
</span><span class="n">x</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c"</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a   c 
5.4 7.1 
</code></pre></div></div>

<p>This is usually a much more reliable way to subset objects: the
position of various elements can often change when chaining together
subsetting operations, but the names will always remain the same!</p>

<h2 id="subsetting-through-other-logical-operations-">Subsetting through other logical operations <a name="logical-operations"></a></h2>

<p>We can also use any logical vector to subset:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  c   e 
7.1 7.5 
</code></pre></div></div>

<p>Since comparison operators (e.g. <code class="language-plaintext highlighter-rouge">&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;</code>, <code class="language-plaintext highlighter-rouge">==</code>) evaluate to logical vectors, we can also
use them to succinctly subset vectors: the following statement gives
the same result as the previous one.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">7</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  c   e 
7.1 7.5 
</code></pre></div></div>

<p>Breaking it down, this statement first evaluates <code class="language-plaintext highlighter-rouge">x&gt;7</code>, generating
a logical vector <code class="language-plaintext highlighter-rouge">c(FALSE, FALSE, TRUE, FALSE, TRUE)</code>, and then
selects the elements of <code class="language-plaintext highlighter-rouge">x</code> corresponding to the <code class="language-plaintext highlighter-rouge">TRUE</code> values.</p>

<p>We can use <code class="language-plaintext highlighter-rouge">==</code> to mimic the previous method of indexing by name
(remember you have to use <code class="language-plaintext highlighter-rouge">==</code> rather than <code class="language-plaintext highlighter-rouge">=</code> for comparisons):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"a"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a 
5.4 
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-combining-logical-conditions">Tip: Combining logical conditions</h2>

  <p>We often want to combine multiple logical
criteria. For example, we might want to find all the countries that are
located in Asia <strong>or</strong> Europe <strong>and</strong> have life expectancies within a certain
range. Several operations for combining logical vectors exist in R:</p>

  <ul>
    <li><code class="language-plaintext highlighter-rouge">&amp;</code>, the “logical AND” operator: returns <code class="language-plaintext highlighter-rouge">TRUE</code> if both the left and right
are <code class="language-plaintext highlighter-rouge">TRUE</code>.</li>
    <li><code class="language-plaintext highlighter-rouge">|</code>, the “logical OR” operator: returns <code class="language-plaintext highlighter-rouge">TRUE</code>, if either the left or right
(or both) are <code class="language-plaintext highlighter-rouge">TRUE</code>.</li>
  </ul>

  <p>You may sometimes see <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> and <code class="language-plaintext highlighter-rouge">||</code> instead of <code class="language-plaintext highlighter-rouge">&amp;</code> and <code class="language-plaintext highlighter-rouge">|</code>. These two-character operators
only look at the first element of each vector and ignore the
remaining elements. In general you should not use the two-character
operators in data analysis; save them
for programming, i.e. deciding whether to execute a statement.</p>

  <ul>
    <li><code class="language-plaintext highlighter-rouge">!</code>, the “logical NOT” operator: converts <code class="language-plaintext highlighter-rouge">TRUE</code> to <code class="language-plaintext highlighter-rouge">FALSE</code> and <code class="language-plaintext highlighter-rouge">FALSE</code> to
<code class="language-plaintext highlighter-rouge">TRUE</code>. It can negate a single logical condition (eg <code class="language-plaintext highlighter-rouge">!TRUE</code> becomes
<code class="language-plaintext highlighter-rouge">FALSE</code>), or a whole vector of conditions(eg <code class="language-plaintext highlighter-rouge">!c(TRUE, FALSE)</code> becomes
<code class="language-plaintext highlighter-rouge">c(FALSE, TRUE)</code>).</li>
  </ul>

  <p>Additionally, you can compare the elements within a single vector using the
<code class="language-plaintext highlighter-rouge">all</code> function (which returns <code class="language-plaintext highlighter-rouge">TRUE</code> if every element of the vector is <code class="language-plaintext highlighter-rouge">TRUE</code>)
and the <code class="language-plaintext highlighter-rouge">any</code> function (which returns <code class="language-plaintext highlighter-rouge">TRUE</code> if one or more elements of the
vector are <code class="language-plaintext highlighter-rouge">TRUE</code>).</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>Given the following code:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5.4</span><span class="p">,</span><span class="w"> </span><span class="m">6.2</span><span class="p">,</span><span class="w"> </span><span class="m">7.1</span><span class="p">,</span><span class="w"> </span><span class="m">4.8</span><span class="p">,</span><span class="w"> </span><span class="m">7.5</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span><span class="w"> </span><span class="s1">'b'</span><span class="p">,</span><span class="w"> </span><span class="s1">'c'</span><span class="p">,</span><span class="w"> </span><span class="s1">'d'</span><span class="p">,</span><span class="w"> </span><span class="s1">'e'</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a   b   c   d   e 
5.4 6.2 7.1 4.8 7.5 
</code></pre></div>  </div>

  <p>Write a subsetting command to return the values in x that are greater than 4 and less than 7.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to challenge 2</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">&lt;</span><span class="m">7</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="o">&gt;</span><span class="m">4</span><span class="p">]</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">x_subset</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  a   b   d 
5.4 6.2 4.8 
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="callout">
  <h2 id="tip-non-unique-names">Tip: Non-unique names</h2>

  <p>You should be aware that it is possible for multiple elements in a
vector to have the same name. (For a data frame, columns can have
the same name — although R tries to avoid this — but row names
must be unique.) Consider these examples:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="w">
</span><span class="n">x</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1 2 3
</code></pre></div>  </div>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span><span class="w"> </span><span class="s1">'a'</span><span class="p">,</span><span class="w"> </span><span class="s1">'a'</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a a a 
1 2 3 
</code></pre></div>  </div>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="s1">'a'</span><span class="p">]</span><span class="w">  </span><span class="c1"># only returns first value</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a 
1 
</code></pre></div>  </div>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'a'</span><span class="p">]</span><span class="w">  </span><span class="c1"># returns all three values</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a a a 
1 2 3 
</code></pre></div>  </div>
</blockquote>

<blockquote class="callout">
  <h2 id="tip-getting-help-for-operators">Tip: Getting help for operators</h2>

  <p>Remember you can search for help on operators by wrapping them in quotes:
<code class="language-plaintext highlighter-rouge">help("%in%")</code> or <code class="language-plaintext highlighter-rouge">?"%in%"</code>.</p>

</blockquote>

<h2 id="skipping-named-elements">Skipping named elements</h2>

<p>Skipping or removing named elements is a little harder. If we try to skip one named element by negating the string, R complains (slightly obscurely) that it doesn’t know how to take the negative of a string:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="m">5.4</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="m">6.2</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="m">7.1</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="m">4.8</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="o">=</span><span class="m">7.5</span><span class="p">)</span><span class="w"> </span><span class="c1"># we start again by naming a vector 'on the fly'</span><span class="w">
</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="s2">"a"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in -"a": invalid argument to unary operator
</code></pre></div></div>

<p>However, we can use the <code class="language-plaintext highlighter-rouge">!=</code> (not-equals) operator to construct a logical vector that will do what we want:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"a"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  b   c   d   e 
6.2 7.1 4.8 7.5 
</code></pre></div></div>

<p>Skipping multiple named indices is a little bit harder still. Suppose we want to drop the <code class="language-plaintext highlighter-rouge">"a"</code> and <code class="language-plaintext highlighter-rouge">"c"</code> elements, so we try this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">!=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext warning highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning in names(x) != c("a", "c"): longer object length is not a multiple of
shorter object length
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  b   c   d   e 
6.2 7.1 4.8 7.5 
</code></pre></div></div>

<p>R did <em>something</em>, but it gave us a warning that we ought to pay attention to - and it apparently <em>gave us the wrong answer</em> (the <code class="language-plaintext highlighter-rouge">"c"</code> element is still included in the vector)!</p>

<p>So what does <code class="language-plaintext highlighter-rouge">!=</code> actually do in this case? That’s an excellent question.</p>

<h3 id="recycling">Recycling</h3>

<p>Let’s take a look at the comparison component of this code:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext warning highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning in names(x) != c("a", "c"): longer object length is not a multiple of
shorter object length
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] FALSE  TRUE  TRUE  TRUE  TRUE
</code></pre></div></div>

<p>Why does R give <code class="language-plaintext highlighter-rouge">TRUE</code> as the third element of this vector, when <code class="language-plaintext highlighter-rouge">names(x)[3] != "c"</code> is obviously false?
When you use <code class="language-plaintext highlighter-rouge">!=</code>, R tries to compare each element
of the left argument with the corresponding element of its right
argument. What happens when you compare vectors of different lengths?</p>

<p><img src="../fig/06-rmd-inequality.1.png" alt="Inequality testing" /></p>

<p>When one vector is shorter than the other, it gets <em>recycled</em>:</p>

<p><img src="../fig/06-rmd-inequality.2.png" alt="Inequality testing: results of recycling" /></p>

<p>In this case R <strong>repeats</strong> <code class="language-plaintext highlighter-rouge">c("a", "c")</code> as many times as necessary to match <code class="language-plaintext highlighter-rouge">names(x)</code>, i.e. we get <code class="language-plaintext highlighter-rouge">c("a","c","a","c","a")</code>. Since the recycled <code class="language-plaintext highlighter-rouge">"a"</code>
doesn’t match the third element of <code class="language-plaintext highlighter-rouge">names(x)</code>, the value of <code class="language-plaintext highlighter-rouge">!=</code> is <code class="language-plaintext highlighter-rouge">TRUE</code>.
Because in this case the longer vector length (5) isn’t a multiple of the shorter vector length (2), R printed a warning message. If we had been unlucky and <code class="language-plaintext highlighter-rouge">names(x)</code> had contained six elements, R would <em>silently</em> have done the wrong thing (i.e., not what we intended it to do). This recycling rule can can introduce hard-to-find and subtle bugs!</p>

<p>The way to get R to do what we really want (match <em>each</em> element of the left argument with <em>all</em> of the elements of the right argument) it to use the <code class="language-plaintext highlighter-rouge">%in%</code> operator. The <code class="language-plaintext highlighter-rouge">%in%</code> operator goes through each element of its left argument, in this case the names of <code class="language-plaintext highlighter-rouge">x</code>, and asks, “Does this element occur in the second argument?”. Here, since we want to <em>exclude</em> values, we also need a <code class="language-plaintext highlighter-rouge">!</code> operator to change “in” to “not in”:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="p">[</span><span class="o">!</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  b   d   e 
6.2 4.8 7.5 
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>

  <p>Selecting elements of a vector that match any of a list of components
is a very common data analysis task. For example, the gapminder data set
contains <code class="language-plaintext highlighter-rouge">country</code> and <code class="language-plaintext highlighter-rouge">continent</code> variables, but no information between
these two scales. Suppose we want to pull out information from southeast
Asia: how do we set up an operation to produce a logical vector that
is <code class="language-plaintext highlighter-rouge">TRUE</code> for all of the countries in southeast Asia and <code class="language-plaintext highlighter-rouge">FALSE</code> otherwise?</p>

  <p>Suppose you have these data:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">seAsia</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Myanmar"</span><span class="p">,</span><span class="s2">"Thailand"</span><span class="p">,</span><span class="s2">"Cambodia"</span><span class="p">,</span><span class="s2">"Vietnam"</span><span class="p">,</span><span class="s2">"Laos"</span><span class="p">)</span><span class="w">
</span><span class="c1">## read in the gapminder data that we downloaded in episode 2</span><span class="w">
</span><span class="n">gapminder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/gapminder_data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">## extract the `country` column from a data frame (we'll see this later);</span><span class="w">
</span><span class="c1">## convert from a factor to a character;</span><span class="w">
</span><span class="c1">## and get just the non-repeated elements</span><span class="w">
</span><span class="n">countries</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="p">))</span><span class="w">
</span></code></pre></div>  </div>

  <p>There’s a wrong way (using only <code class="language-plaintext highlighter-rouge">==</code>), which will give you a warning;
a clunky way (using the logical operators <code class="language-plaintext highlighter-rouge">==</code> and <code class="language-plaintext highlighter-rouge">|</code>); and
an elegant way (using <code class="language-plaintext highlighter-rouge">%in%</code>). See whether you can come up with all three
and explain how they (don’t) work.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to challenge 3</h2>

    <ul>
      <li>The <strong>wrong</strong> way to do this problem is <code class="language-plaintext highlighter-rouge">countries==seAsia</code>. This
gives a warning (<code class="language-plaintext highlighter-rouge">"In countries == seAsia : longer object length is not a multiple of shorter object length"</code>) and the wrong answer (a vector of all
<code class="language-plaintext highlighter-rouge">FALSE</code> values), because none of the recycled values of <code class="language-plaintext highlighter-rouge">seAsia</code> happen
to line up correctly with matching values in <code class="language-plaintext highlighter-rouge">country</code>.</li>
      <li>The <strong>clunky</strong> (but technically correct) way to do this problem is</li>
    </ul>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="p">(</span><span class="n">countries</span><span class="o">==</span><span class="s2">"Myanmar"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">countries</span><span class="o">==</span><span class="s2">"Thailand"</span><span class="w"> </span><span class="o">|</span><span class="w">
 </span><span class="n">countries</span><span class="o">==</span><span class="s2">"Cambodia"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">countries</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Vietnam"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">countries</span><span class="o">==</span><span class="s2">"Laos"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>(or <code class="language-plaintext highlighter-rouge">countries==seAsia[1] | countries==seAsia[2] | ...</code>). This
gives the correct values, but hopefully you can see how awkward it
is (what if we wanted to select countries from a much longer list?).</p>
    <ul>
      <li>The best way to do this problem is <code class="language-plaintext highlighter-rouge">countries %in% seAsia</code>, which
is both correct and easy to type (and read).</li>
    </ul>
  </blockquote>
</blockquote>

<h2 id="handling-special-values">Handling special values</h2>

<p>At some point you will encounter functions in R that cannot handle missing, infinite,
or undefined data.</p>

<p>There are a number of special functions you can use to filter out this data:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">is.na</code> will return all positions in a vector, matrix, or data.frame
containing <code class="language-plaintext highlighter-rouge">NA</code> (or <code class="language-plaintext highlighter-rouge">NaN</code>)</li>
  <li>likewise, <code class="language-plaintext highlighter-rouge">is.nan</code>, and <code class="language-plaintext highlighter-rouge">is.infinite</code> will do the same for <code class="language-plaintext highlighter-rouge">NaN</code> and <code class="language-plaintext highlighter-rouge">Inf</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">is.finite</code> will return all positions in a vector, matrix, or data.frame
that do not contain <code class="language-plaintext highlighter-rouge">NA</code>, <code class="language-plaintext highlighter-rouge">NaN</code> or <code class="language-plaintext highlighter-rouge">Inf</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">na.omit</code> will filter out all missing values from a vector</li>
</ul>

<h2 id="factor-subsetting">Factor subsetting</h2>

<p>Now that we’ve explored the different ways to subset vectors, how
do we subset the other data structures?</p>

<p>Factor subsetting works the same way as vector subsetting.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"a"</span><span class="p">,</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c"</span><span class="p">,</span><span class="w"> </span><span class="s2">"d"</span><span class="p">))</span><span class="w">
</span><span class="n">f</span><span class="p">[</span><span class="n">f</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"a"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] a a
Levels: a b c d
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span><span class="p">[</span><span class="n">f</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c"</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] b c c
Levels: a b c d
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] a a b
Levels: a b c d
</code></pre></div></div>

<p>Skipping elements will not remove the level
even if no more of that category exists in the factor:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span><span class="p">[</span><span class="m">-3</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] a a c c d
Levels: a b c d
</code></pre></div></div>

<h2 id="matrix-subsetting">Matrix subsetting</h2>

<p>Matrices are also subsetted using the <code class="language-plaintext highlighter-rouge">[</code> function. In this case
it takes two arguments: the first applying to the rows, the second
to its columns:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">6</span><span class="o">*</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">6</span><span class="p">)</span><span class="w">
</span><span class="n">m</span><span class="p">[</span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            [,1]       [,2]
[1,]  1.12493092 -0.8356286
[2,] -0.04493361  1.5952808
</code></pre></div></div>

<p>You can leave the first or second arguments blank to retrieve all the
rows or columns respectively:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            [,1]        [,2]
[1,] -0.62124058  0.82122120
[2,] -2.21469989  0.59390132
[3,]  1.12493092  0.91897737
[4,] -0.04493361  0.78213630
[5,] -0.01619026  0.07456498
[6,]  0.94383621 -1.98935170
</code></pre></div></div>

<p>If we only access one row or column, R will automatically convert the result
to a vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">[</span><span class="m">3</span><span class="p">,]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] -0.8356286  0.5757814  1.1249309  0.9189774
</code></pre></div></div>

<p>If you want to keep the output as a matrix, you need to specify a <em>third</em> argument;
<code class="language-plaintext highlighter-rouge">drop = FALSE</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">drop</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           [,1]      [,2]     [,3]      [,4]
[1,] -0.8356286 0.5757814 1.124931 0.9189774
</code></pre></div></div>

<p>Unlike vectors, if we try to access a row or column outside of the matrix,
R will throw an error:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">6</span><span class="p">)]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in m[, c(3, 6)]: subscript out of bounds
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-higher-dimensional-arrays">Tip: Higher dimensional arrays</h2>

  <p>when dealing with multi-dimensional arrays, each argument to <code class="language-plaintext highlighter-rouge">[</code>
corresponds to a dimension. For example, a 3D array, the first three
arguments correspond to the rows, columns, and depth dimension.</p>

</blockquote>

<p>Because matrices are vectors, we can
also subset using only one argument:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="p">[</span><span class="m">5</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0.3295078
</code></pre></div></div>

<p>This usually isn’t useful, and often confusing to read. However it is useful to note that matrices
are laid out in <em>column-major format</em> by default. That is the elements of the
vector are arranged column-wise:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1] [,2] [,3]
[1,]    1    3    5
[2,]    2    4    6
</code></pre></div></div>

<p>If you wish to populate the matrix by row, use <code class="language-plaintext highlighter-rouge">byrow=TRUE</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">byrow</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    4    5    6
</code></pre></div></div>

<p>Matrices can also be subsetted using their rownames and column names
instead of their row and column indices.</p>

<blockquote class="challenge">
  <h2 id="challenge-4">Challenge 4</h2>

  <p>Given the following code:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">18</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">6</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    4    7   10   13   16
[2,]    2    5    8   11   14   17
[3,]    3    6    9   12   15   18
</code></pre></div>  </div>

  <ol>
    <li>Which of the following commands will extract the values 11 and 14?</li>
  </ol>

  <p>A. <code class="language-plaintext highlighter-rouge">m[2,4,2,5]</code></p>

  <p>B. <code class="language-plaintext highlighter-rouge">m[2:5]</code></p>

  <p>C. <code class="language-plaintext highlighter-rouge">m[4:5,2]</code></p>

  <p>D. <code class="language-plaintext highlighter-rouge">m[2,c(4,5)]</code></p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-4">Solution to challenge 4</h2>

    <p>D</p>
  </blockquote>
</blockquote>

<h2 id="list-subsetting">List subsetting</h2>

<p>Now we’ll introduce some new subsetting operators. There are three functions
used to subset lists. We’ve already seen these when learning about atomic vectors and matrices:  <code class="language-plaintext highlighter-rouge">[</code>, <code class="language-plaintext highlighter-rouge">[[</code>, and <code class="language-plaintext highlighter-rouge">$</code>.</p>

<p>Using <code class="language-plaintext highlighter-rouge">[</code> will always return a list. If you want to <em>subset</em> a list, but not
<em>extract</em> an element, then you will likely use <code class="language-plaintext highlighter-rouge">[</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xlist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Software Carpentry"</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">mtcars</span><span class="p">))</span><span class="w">
</span><span class="n">xlist</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$a
[1] "Software Carpentry"
</code></pre></div></div>

<p>This returns a <em>list with one element</em>.</p>

<p>We can subset elements of a list exactly the same way as atomic
vectors using <code class="language-plaintext highlighter-rouge">[</code>. Comparison operations however won’t work as
they’re not recursive, they will try to condition on the data structures
in each element of the list, not the individual elements within those
data structures.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xlist</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$a
[1] "Software Carpentry"

$b
 [1]  1  2  3  4  5  6  7  8  9 10
</code></pre></div></div>

<p>To extract individual elements of a list, you need to use the double-square
bracket function: <code class="language-plaintext highlighter-rouge">[[</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xlist</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Software Carpentry"
</code></pre></div></div>

<p>Notice that now the result is a vector, not a list.</p>

<p>You can’t extract more than one element at once:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xlist</span><span class="p">[[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in xlist[[1:2]]: subscript out of bounds
</code></pre></div></div>

<p>Nor use it to skip elements:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xlist</span><span class="p">[[</span><span class="m">-1</span><span class="p">]]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in xlist[[-1]]: invalid negative subscript in get1index &lt;real&gt;
</code></pre></div></div>

<p>But you can use names to both subset and extract elements:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xlist</span><span class="p">[[</span><span class="s2">"a"</span><span class="p">]]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Software Carpentry"
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">$</code> function is a shorthand way for extracting elements by name:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xlist</span><span class="o">$</span><span class="n">data</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-5">Challenge 5</h2>
  <p>Given the following list:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xlist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Software Carpentry"</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">mtcars</span><span class="p">))</span><span class="w">
</span></code></pre></div>  </div>

  <p>Using your knowledge of both list and vector subsetting, extract the number 2 from xlist.
Hint: the number 2 is contained within the “b” item in the list.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-5">Solution to challenge 5</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xlist</span><span class="o">$</span><span class="n">b</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xlist</span><span class="p">[[</span><span class="m">2</span><span class="p">]][</span><span class="m">2</span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xlist</span><span class="p">[[</span><span class="s2">"b"</span><span class="p">]][</span><span class="m">2</span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-6">Challenge 6</h2>
  <p>Given a linear model:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aov</span><span class="p">(</span><span class="n">pop</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <p>Extract the residual degrees of freedom (hint: <code class="language-plaintext highlighter-rouge">attributes()</code> will help you)</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-6">Solution to challenge 6</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">attributes</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="w"> </span><span class="c1">## `df.residual` is one of the names of `mod`</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mod</span><span class="o">$</span><span class="n">df.residual</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="data-frames">Data frames</h2>

<p>Remember the data frames are lists underneath the hood, so similar rules
apply. However they are also two dimensional objects:</p>

<p><code class="language-plaintext highlighter-rouge">[</code> with one argument will act the same way as for lists, where each list
element corresponds to a column. The resulting object will be a data frame:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">gapminder</span><span class="p">[</span><span class="m">3</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       pop
1  8425333
2  9240934
3 10267083
4 11537966
5 13079460
6 14880372
</code></pre></div></div>

<p>Similarly, <code class="language-plaintext highlighter-rouge">[[</code> will act to extract <em>a single column</em>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">gapminder</span><span class="p">[[</span><span class="s2">"lifeExp"</span><span class="p">]])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 28.801 30.332 31.997 34.020 36.088 38.438
</code></pre></div></div>

<p>And <code class="language-plaintext highlighter-rouge">$</code> provides a convenient shorthand to extract columns by name:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1952 1957 1962 1967 1972 1977
</code></pre></div></div>

<p>With two arguments, <code class="language-plaintext highlighter-rouge">[</code> behaves the same way as for matrices:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
</code></pre></div></div>

<p>If we subset a single row, the result will be a data frame (because
the elements are mixed types):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="p">[</span><span class="m">3</span><span class="p">,]</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      country year      pop continent lifeExp gdpPercap
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
</code></pre></div></div>

<p>But for a single column the result will be a vector (this can
be changed with the third argument, <code class="language-plaintext highlighter-rouge">drop = FALSE</code>).</p>

<blockquote class="challenge">
  <h2 id="challenge-7">Challenge 7</h2>

  <p>Fix each of the following common data frame subsetting errors:</p>

  <ol>
    <li>
      <p>Extract observations collected for the year 1957</p>

      <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1957</span><span class="p">,]</span><span class="w">
</span></code></pre></div>      </div>
    </li>
    <li>
      <p>Extract all columns except 1 through to 4</p>

      <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="p">[,</span><span class="m">-1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span><span class="w">
</span></code></pre></div>      </div>
    </li>
    <li>
      <p>Extract the rows where the life expectancy is longer the 80 years</p>

      <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">lifeExp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">80</span><span class="p">]</span><span class="w">
</span></code></pre></div>      </div>
    </li>
    <li>
      <p>Extract the first row, and the fourth and fifth columns
  (<code class="language-plaintext highlighter-rouge">continent</code> and <code class="language-plaintext highlighter-rouge">lifeExp</code>).</p>

      <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">]</span><span class="w">
</span></code></pre></div>      </div>
    </li>
    <li>
      <p>Advanced: extract rows that contain information for the years 2002
and 2007</p>

      <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">2007</span><span class="p">,]</span><span class="w">
</span></code></pre></div>      </div>
    </li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-7">Solution to challenge 7</h2>

    <p>Fix each of the following common data frame subsetting errors:</p>

    <ol>
      <li>
        <p>Extract observations collected for the year 1957</p>

        <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># gapminder[gapminder$year = 1957,]</span><span class="w">
</span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1957</span><span class="p">,]</span><span class="w">
</span></code></pre></div>        </div>
      </li>
      <li>
        <p>Extract all columns except 1 through to 4</p>

        <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># gapminder[,-1:4]</span><span class="w">
</span><span class="n">gapminder</span><span class="p">[,</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)]</span><span class="w">
</span></code></pre></div>        </div>
      </li>
      <li>
        <p>Extract the rows where the life expectancy is longer than 80 years</p>

        <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># gapminder[gapminder$lifeExp &gt; 80]</span><span class="w">
</span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">lifeExp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">80</span><span class="p">,]</span><span class="w">
</span></code></pre></div>        </div>
      </li>
      <li>
        <p>Extract the first row, and the fourth and fifth columns
  (<code class="language-plaintext highlighter-rouge">continent</code> and <code class="language-plaintext highlighter-rouge">lifeExp</code>).</p>

        <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># gapminder[1, 4, 5]</span><span class="w">
</span><span class="n">gapminder</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)]</span><span class="w">
</span></code></pre></div>        </div>
      </li>
      <li>
        <p>Advanced: extract rows that contain information for the years 2002
and 2007</p>

        <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="c1"># gapminder[gapminder$year == 2002 | 2007,]</span><span class="w">
 </span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2007</span><span class="p">,]</span><span class="w">
 </span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2002</span><span class="p">,</span><span class="w"> </span><span class="m">2007</span><span class="p">),]</span><span class="w">
</span></code></pre></div>        </div>
      </li>
    </ol>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-8">Challenge 8</h2>

  <ol>
    <li>
      <p>Why does <code class="language-plaintext highlighter-rouge">gapminder[1:20]</code> return an error? How does it differ from <code class="language-plaintext highlighter-rouge">gapminder[1:20, ]</code>?</p>
    </li>
    <li>
      <p>Create a new <code class="language-plaintext highlighter-rouge">data.frame</code> called <code class="language-plaintext highlighter-rouge">gapminder_small</code> that only contains rows 1 through 9
and 19 through 23. You can do this in one or two steps.</p>
    </li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-8">Solution to challenge 8</h2>

    <ol>
      <li><code class="language-plaintext highlighter-rouge">gapminder</code> is a data.frame so needs to be subsetted on two dimensions. <code class="language-plaintext highlighter-rouge">gapminder[1:20, ]</code> subsets the data to give the first 20 rows and all columns.</li>
    </ol>

    <p>2.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder_small</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">19</span><span class="o">:</span><span class="m">23</span><span class="p">),]</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Indexing in R starts at 1, not 0.</p>
</li>
    
    <li><p>Access individual values by location using <code class="language-plaintext highlighter-rouge">[]</code>.</p>
</li>
    
    <li><p>Access slices of data using <code class="language-plaintext highlighter-rouge">[low:high]</code>.</p>
</li>
    
    <li><p>Access arbitrary sets of data using <code class="language-plaintext highlighter-rouge">[c(...)]</code>.</p>
</li>
    
    <li><p>Use logical operations and logical vectors to access subsets of data.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="control-flow" class="maintitle">Control Flow</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 45 min
      <br />
      <strong>Exercises:</strong> 20 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I make data-dependent choices in R?</p>
</li>
	
	<li><p>How can I repeat operations in R?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Write conditional statements with <code class="language-plaintext highlighter-rouge">if...else</code> statements and <code class="language-plaintext highlighter-rouge">ifelse()</code>.</p>
</li>
	
	<li><p>Write and understand <code class="language-plaintext highlighter-rouge">for()</code> loops.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>Often when we’re coding we want to control the flow of our actions. This can be done
by setting actions to occur only if a condition or a set of conditions are met.
Alternatively, we can also set an action to occur a particular number of times.</p>

<p>There are several ways you can control flow in R.
For conditional statements, the most commonly used approaches are the constructs:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># if</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">condition</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">perform</span><span class="w"> </span><span class="n">action</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># if ... else</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">condition</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">perform</span><span class="w"> </span><span class="n">action</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1"># that is, if the condition is false,</span><span class="w">
  </span><span class="n">perform</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="n">action</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Say, for example, that we want R to print a message if a variable <code class="language-plaintext highlighter-rouge">x</code> has a particular value:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">8</span><span class="w">

</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"x is greater than or equal to 10"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">x</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 8
</code></pre></div></div>

<p>The print statement does not appear in the console because x is not greater than 10. To print a different message for numbers less than 10, we can add an <code class="language-plaintext highlighter-rouge">else</code> statement.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">8</span><span class="w">

</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"x is greater than or equal to 10"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"x is less than 10"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "x is less than 10"
</code></pre></div></div>

<p>You can also test multiple conditions by using <code class="language-plaintext highlighter-rouge">else if</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">8</span><span class="w">

</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"x is greater than or equal to 10"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"x is greater than 5, but less than 10"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="s2">"x is less than 5"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "x is greater than 5, but less than 10"
</code></pre></div></div>

<p><strong>Important:</strong> when R evaluates the condition inside <code class="language-plaintext highlighter-rouge">if()</code> statements, it is
looking for a logical element, i.e., <code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code>. This can cause some
headaches for beginners. For example:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w">  </span><span class="o">&lt;-</span><span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="s2">"4 equals 3"</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="s2">"4 does not equal 3"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "4 does not equal 3"
</code></pre></div></div>

<p>As we can see, the not equal message was printed because the vector x is <code class="language-plaintext highlighter-rouge">FALSE</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="n">x</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] FALSE
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Use an <code class="language-plaintext highlighter-rouge">if()</code> statement to print a suitable message
reporting whether there are any records from 2002 in
the <code class="language-plaintext highlighter-rouge">gapminder</code> dataset.
Now do the same for 2012.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to Challenge 1</h2>
    <p>We will first see a solution to Challenge 1 which does not use the <code class="language-plaintext highlighter-rouge">any()</code> function.
We first obtain a logical vector describing which element of <code class="language-plaintext highlighter-rouge">gapminder$year</code> is equal to <code class="language-plaintext highlighter-rouge">2002</code>:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="p">[(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2002</span><span class="p">),]</span><span class="w">
</span></code></pre></div>    </div>
    <p>Then, we count the number of rows of the data.frame <code class="language-plaintext highlighter-rouge">gapminder</code> that correspond to the 2002:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rows2002_number</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">gapminder</span><span class="p">[(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2002</span><span class="p">),])</span><span class="w">
</span></code></pre></div>    </div>
    <p>The presence of any record for the year 2002 is equivalent to the request that <code class="language-plaintext highlighter-rouge">rows2002_number</code> is one or more:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rows2002_number</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></code></pre></div>    </div>
    <p>Putting all together, we obtain:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">gapminder</span><span class="p">[(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2002</span><span class="p">),])</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">1</span><span class="p">){</span><span class="w">
   </span><span class="n">print</span><span class="p">(</span><span class="s2">"Record(s) for the year 2002 found."</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <p>All this can be done more quickly with <code class="language-plaintext highlighter-rouge">any()</code>. The logical condition can be expressed as:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="nf">any</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2002</span><span class="p">)){</span><span class="w">
   </span><span class="n">print</span><span class="p">(</span><span class="s2">"Record(s) for the year 2002 found."</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

  </blockquote>
</blockquote>

<p>Did anyone get a warning message like this?</p>

<div class="language-plaintext warning highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning in if (gapminder$year == 2012) {: the condition has length &gt; 1 and only
the first element will be used
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">if()</code> function only accepts singular (of length 1) inputs, and therefore
returns an error when you use it with a vector. The <code class="language-plaintext highlighter-rouge">if()</code> function will still
run, but will only evaluate the condition in the first element of the vector.
Therefore, to use the <code class="language-plaintext highlighter-rouge">if()</code> function, you need to make sure your input is
singular (of length 1).</p>

<blockquote class="callout">
  <h2 id="tip-built-in-ifelse-function">Tip: Built in <code class="language-plaintext highlighter-rouge">ifelse()</code> function</h2>

  <p><code class="language-plaintext highlighter-rouge">R</code> accepts both <code class="language-plaintext highlighter-rouge">if()</code> and <code class="language-plaintext highlighter-rouge">else if()</code> statements structured as outlined above,
but also statements using <code class="language-plaintext highlighter-rouge">R</code>’s built-in <code class="language-plaintext highlighter-rouge">ifelse()</code> function. This
function accepts both singular and vector inputs and is structured as
follows:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ifelse function</span><span class="w">
</span><span class="n">ifelse</span><span class="p">(</span><span class="n">condition</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">true</span><span class="p">,</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">alternative</span><span class="w"> </span><span class="n">action</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <p>where the first argument is the condition or a set of conditions to be met, the
second argument is the statement that is evaluated when the condition is <code class="language-plaintext highlighter-rouge">TRUE</code>,
and the third statement  is the statement that is evaluated when the condition
is <code class="language-plaintext highlighter-rouge">FALSE</code>.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-3</span><span class="w">
</span><span class="n">ifelse</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="s2">"y is a negative number"</span><span class="p">,</span><span class="w"> </span><span class="s2">"y is either positive or zero"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "y is a negative number"
</code></pre></div>  </div>
</blockquote>

<blockquote class="callout">
  <h2 id="tip-any-and-all">Tip: <code class="language-plaintext highlighter-rouge">any()</code> and <code class="language-plaintext highlighter-rouge">all()</code></h2>

  <p>The <code class="language-plaintext highlighter-rouge">any()</code> function will return <code class="language-plaintext highlighter-rouge">TRUE</code> if at least one
<code class="language-plaintext highlighter-rouge">TRUE</code> value is found within a vector, otherwise it will return <code class="language-plaintext highlighter-rouge">FALSE</code>.
This can be used in a similar way to the <code class="language-plaintext highlighter-rouge">%in%</code> operator.
The function <code class="language-plaintext highlighter-rouge">all()</code>, as the name suggests, will only return <code class="language-plaintext highlighter-rouge">TRUE</code> if all values in
the vector are <code class="language-plaintext highlighter-rouge">TRUE</code>.</p>
</blockquote>

<h2 id="repeating-operations">Repeating operations</h2>

<p>If you want to iterate over
a set of values, when the order of iteration is important, and perform the
same operation on each, a <code class="language-plaintext highlighter-rouge">for()</code> loop will do the job.
We saw <code class="language-plaintext highlighter-rouge">for()</code> loops in the shell lessons earlier. This is the most
flexible of looping operations, but therefore also the hardest to use
correctly. In general, the advice of many <code class="language-plaintext highlighter-rouge">R</code> users would be to learn about
<code class="language-plaintext highlighter-rouge">for()</code> loops, but to avoid using <code class="language-plaintext highlighter-rouge">for()</code> loops unless the order of iteration is
important: i.e. the calculation at each iteration depends on the results of
previous iterations. If the order of iteration is not important, then you
should learn about vectorized alternatives, such as the <code class="language-plaintext highlighter-rouge">purrr</code> package, as they
pay off in computational efficiency.</p>

<p>The basic structure of a <code class="language-plaintext highlighter-rouge">for()</code> loop is:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">iterator</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">values</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">do</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">thing</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>For example:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1
[1] 2
[1] 3
[1] 4
[1] 5
[1] 6
[1] 7
[1] 8
[1] 9
[1] 10
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">1:10</code> bit creates a vector on the fly; you can iterate
over any other vector as well.</p>

<p>We can use a <code class="language-plaintext highlighter-rouge">for()</code> loop nested within another <code class="language-plaintext highlighter-rouge">for()</code> loop to iterate over two things at
once.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span><span class="w"> </span><span class="s1">'b'</span><span class="p">,</span><span class="w"> </span><span class="s1">'c'</span><span class="p">,</span><span class="w"> </span><span class="s1">'d'</span><span class="p">,</span><span class="w"> </span><span class="s1">'e'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "1 a"
[1] "1 b"
[1] "1 c"
[1] "1 d"
[1] "1 e"
[1] "2 a"
[1] "2 b"
[1] "2 c"
[1] "2 d"
[1] "2 e"
[1] "3 a"
[1] "3 b"
[1] "3 c"
[1] "3 d"
[1] "3 e"
[1] "4 a"
[1] "4 b"
[1] "4 c"
[1] "4 d"
[1] "4 e"
[1] "5 a"
[1] "5 b"
[1] "5 c"
[1] "5 d"
[1] "5 e"
</code></pre></div></div>

<p>We notice in the output that when the first index (<code class="language-plaintext highlighter-rouge">i</code>) is set to 1, the second
index (<code class="language-plaintext highlighter-rouge">j</code>) iterates through its full set of indices. Once the indices of <code class="language-plaintext highlighter-rouge">j</code>
have been iterated through, then <code class="language-plaintext highlighter-rouge">i</code> is incremented. This process continues
until the last index has been used for each <code class="language-plaintext highlighter-rouge">for()</code> loop.</p>

<p>Rather than printing the results, we could write the loop output to a new object.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span><span class="w"> </span><span class="s1">'b'</span><span class="p">,</span><span class="w"> </span><span class="s1">'c'</span><span class="p">,</span><span class="w"> </span><span class="s1">'d'</span><span class="p">,</span><span class="w"> </span><span class="s1">'e'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">temp_output</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w">
    </span><span class="n">output_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">output_vector</span><span class="p">,</span><span class="w"> </span><span class="n">temp_output</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">output_vector</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] "1 a" "1 b" "1 c" "1 d" "1 e" "2 a" "2 b" "2 c" "2 d" "2 e" "3 a" "3 b"
[13] "3 c" "3 d" "3 e" "4 a" "4 b" "4 c" "4 d" "4 e" "5 a" "5 b" "5 c" "5 d"
[25] "5 e"
</code></pre></div></div>

<p>This approach can be useful, but ‘growing your results’ (building
the result object incrementally) is computationally inefficient, so avoid
it when you are iterating through a lot of values.</p>

<blockquote class="callout">
  <h2 id="tip-dont-grow-your-results">Tip: don’t grow your results</h2>

  <p>One of the biggest things that trips up novices and
experienced R users alike, is building a results object
(vector, list, matrix, data frame) as your for loop progresses.
Computers are very bad at handling this, so your calculations
can very quickly slow to a crawl. It’s much better to define
an empty results object before hand of appropriate dimensions, rather
than initializing an empty object without dimensions.
So if you know the end result will be stored in a matrix like above,
create an empty matrix with 5 row and 5 columns, then at each iteration
store the results in the appropriate location.</p>
</blockquote>

<p>A better way is to define your (empty) output object before filling in the values.
For this example, it looks more involved, but is still more efficient.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">j_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span><span class="w"> </span><span class="s1">'b'</span><span class="p">,</span><span class="w"> </span><span class="s1">'c'</span><span class="p">,</span><span class="w"> </span><span class="s1">'d'</span><span class="p">,</span><span class="w"> </span><span class="s1">'e'</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">temp_j_value</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">j_vector</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w">
    </span><span class="n">temp_output</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">temp_j_value</span><span class="p">)</span><span class="w">
    </span><span class="n">output_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp_output</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">output_vector2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.vector</span><span class="p">(</span><span class="n">output_matrix</span><span class="p">)</span><span class="w">
</span><span class="n">output_vector2</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] "1 a" "2 a" "3 a" "4 a" "5 a" "1 b" "2 b" "3 b" "4 b" "5 b" "1 c" "2 c"
[13] "3 c" "4 c" "5 c" "1 d" "2 d" "3 d" "4 d" "5 d" "1 e" "2 e" "3 e" "4 e"
[25] "5 e"
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-while-loops">Tip: While loops</h2>

  <p>Sometimes you will find yourself needing to repeat an operation as long as a certain
condition is met. You can do this with a <code class="language-plaintext highlighter-rouge">while()</code> loop.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span><span class="p">(</span><span class="n">this</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">true</span><span class="p">){</span><span class="w">
  </span><span class="n">do</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">thing</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>  </div>
  <p>R will interpret a condition being met as “TRUE”.</p>

  <p>As an example, here’s a while loop
that generates random numbers from a uniform distribution (the <code class="language-plaintext highlighter-rouge">runif()</code> function)
between 0 and 1 until it gets one that’s less than 0.1.</p>

  <div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>z &lt;- 1
while(z &gt; 0.1){
  z &lt;- runif(1)
  cat(z, "\n")
}
</code></pre></div>  </div>

  <p><code class="language-plaintext highlighter-rouge">while()</code> loops will not always be appropriate. You have to be particularly careful
that you don’t end up stuck in an infinite loop because your condition is always met and hence the while statement never terminates.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>Compare the objects <code class="language-plaintext highlighter-rouge">output_vector</code> and
<code class="language-plaintext highlighter-rouge">output_vector2</code>. Are they the same? If not, why not?
How would you change the last block of code to make <code class="language-plaintext highlighter-rouge">output_vector2</code>
the same as <code class="language-plaintext highlighter-rouge">output_vector</code>?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to Challenge 2</h2>
    <p>We can check whether the two vectors are identical using the <code class="language-plaintext highlighter-rouge">all()</code> function:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">all</span><span class="p">(</span><span class="n">output_vector</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">output_vector2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>However, all the elements of <code class="language-plaintext highlighter-rouge">output_vector</code> can be found in <code class="language-plaintext highlighter-rouge">output_vector2</code>:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">all</span><span class="p">(</span><span class="n">output_vector</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">output_vector2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>and vice versa:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">all</span><span class="p">(</span><span class="n">output_vector2</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">output_vector</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>therefore, the element in <code class="language-plaintext highlighter-rouge">output_vector</code> and <code class="language-plaintext highlighter-rouge">output_vector2</code> are just sorted in a different order.
This is because <code class="language-plaintext highlighter-rouge">as.vector()</code> outputs the elements of an input matrix going over its column.
Taking a look at <code class="language-plaintext highlighter-rouge">output_matrix</code>, we can notice that we want its elements by rows.
The solution is to transpose the <code class="language-plaintext highlighter-rouge">output_matrix</code>. We can do it either by calling the transpose function
<code class="language-plaintext highlighter-rouge">t()</code> or by inputting the elements in the right order.
The first solution requires to change the original</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output_vector2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.vector</span><span class="p">(</span><span class="n">output_matrix</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>into</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output_vector2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.vector</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">output_matrix</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
    <p>The second solution requires to change</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp_output</span><span class="w">
</span></code></pre></div>    </div>
    <p>into</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp_output</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>

  <p>Write a script that loops through the <code class="language-plaintext highlighter-rouge">gapminder</code> data by continent and prints out
whether the mean life expectancy is smaller or larger than 50
years.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to Challenge 3</h2>

    <p><strong>Step 1</strong>:  We want to make sure we can extract all the unique values of the continent vector</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/gapminder_data.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">unique</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">continent</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><strong>Step 2</strong>: We also need to loop over each of these continents and calculate the average life expectancy for each <code class="language-plaintext highlighter-rouge">subset</code> of data.
We can do that as follows:</p>

    <ol>
      <li>Loop over each of the unique values of ‘continent’</li>
      <li>For each value of continent, create a temporary variable storing that subset</li>
      <li>Return the calculated life expectancy to the user by printing the output:</li>
    </ol>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">iContinent</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">iContinent</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="n">cat</span><span class="p">(</span><span class="n">iContinent</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">tmp</span><span class="o">$</span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
  </span><span class="n">rm</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <p><strong>Step 3</strong>: The exercise only wants the output printed if the average life expectancy is less than 50 or greater than 50.
So we need to add an <code class="language-plaintext highlighter-rouge">if()</code> condition before printing, which evaluates whether the calculated average life expectancy is above or below a threshold, and prints an output conditional on the result.
We need to amend (3) from above:</p>

    <p>3a. If the calculated life expectancy is less than some threshold (50 years), return the continent and a statement that life expectancy is less than threshold, otherwise return the continent and a statement that life expectancy is greater than threshold:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">thresholdValue</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">50</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">iContinent</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">iContinent</span><span class="p">,</span><span class="w"> </span><span class="s2">"lifeExp"</span><span class="p">])</span><span class="w">

   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">thresholdValue</span><span class="p">){</span><span class="w">
       </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Average Life Expectancy in"</span><span class="p">,</span><span class="w"> </span><span class="n">iContinent</span><span class="p">,</span><span class="w"> </span><span class="s2">"is less than"</span><span class="p">,</span><span class="w"> </span><span class="n">thresholdValue</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Average Life Expectancy in"</span><span class="p">,</span><span class="w"> </span><span class="n">iContinent</span><span class="p">,</span><span class="w"> </span><span class="s2">"is greater than"</span><span class="p">,</span><span class="w"> </span><span class="n">thresholdValue</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
   </span><span class="p">}</span><span class="w"> </span><span class="c1"># end if else condition</span><span class="w">
   </span><span class="n">rm</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="c1"># end for loop</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-4">Challenge 4</h2>

  <p>Modify the script from Challenge 3 to loop over each
country. This time print out whether the life expectancy is
smaller than 50, between 50 and 70, or greater than 70.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-4">Solution to Challenge 4</h2>
    <p>We modify our solution to Challenge 3 by now adding two thresholds, <code class="language-plaintext highlighter-rouge">lowerThreshold</code> and <code class="language-plaintext highlighter-rouge">upperThreshold</code> and extending our if-else statements:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="n">lowerThreshold</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">50</span><span class="w">
 </span><span class="n">upperThreshold</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">70</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">iCountry</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">iCountry</span><span class="p">,</span><span class="w"> </span><span class="s2">"lifeExp"</span><span class="p">])</span><span class="w">

    </span><span class="k">if</span><span class="p">(</span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lowerThreshold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Average Life Expectancy in"</span><span class="p">,</span><span class="w"> </span><span class="n">iCountry</span><span class="p">,</span><span class="w"> </span><span class="s2">"is less than"</span><span class="p">,</span><span class="w"> </span><span class="n">lowerThreshold</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">tmp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">lowerThreshold</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">upperThreshold</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Average Life Expectancy in"</span><span class="p">,</span><span class="w"> </span><span class="n">iCountry</span><span class="p">,</span><span class="w"> </span><span class="s2">"is between"</span><span class="p">,</span><span class="w"> </span><span class="n">lowerThreshold</span><span class="p">,</span><span class="w"> </span><span class="s2">"and"</span><span class="p">,</span><span class="w"> </span><span class="n">upperThreshold</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Average Life Expectancy in"</span><span class="p">,</span><span class="w"> </span><span class="n">iCountry</span><span class="p">,</span><span class="w"> </span><span class="s2">"is greater than"</span><span class="p">,</span><span class="w"> </span><span class="n">upperThreshold</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="n">rm</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-5---advanced">Challenge 5 - Advanced</h2>

  <p>Write a script that loops over each country in the <code class="language-plaintext highlighter-rouge">gapminder</code> dataset,
tests whether the country starts with a ‘B’, and graphs life expectancy
against time as a line graph if the mean life expectancy is under 50 years.</p>

  <blockquote class="solution">
    <h2 id="solution-for-challenge-5">Solution for Challenge 5</h2>

    <p>We will use the <code class="language-plaintext highlighter-rouge">grep()</code> command that was introduced in the Unix Shell lesson to find countries that start with “B.”
Lets understand how to do this first.
Following from the Unix shell section we may be tempted to try the following</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grep</span><span class="p">(</span><span class="s2">"^B"</span><span class="p">,</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <p>But when we evaluate this command it returns the indices of the factor variable <code class="language-plaintext highlighter-rouge">country</code> that start with “B.”
To get the values, we must add the <code class="language-plaintext highlighter-rouge">value=TRUE</code> option to the <code class="language-plaintext highlighter-rouge">grep()</code> command:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grep</span><span class="p">(</span><span class="s2">"^B"</span><span class="p">,</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="p">),</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p>We will now store these countries in a variable called candidateCountries, and then loop over each entry in the variable.
Inside the loop, we evaluate the average life expectancy for each country, and if the average life expectancy is less than 50 we use base-plot to plot the evolution of average life expectancy using <code class="language-plaintext highlighter-rouge">with()</code> and <code class="language-plaintext highlighter-rouge">subset()</code>:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">thresholdValue</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">50</span><span class="w">
</span><span class="n">candidateCountries</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grep</span><span class="p">(</span><span class="s2">"^B"</span><span class="p">,</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="p">),</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">iCountry</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">candidateCountries</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">iCountry</span><span class="p">,</span><span class="w"> </span><span class="s2">"lifeExp"</span><span class="p">])</span><span class="w">

    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tmp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">thresholdValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Average Life Expectancy in"</span><span class="p">,</span><span class="w"> </span><span class="n">iCountry</span><span class="p">,</span><span class="w"> </span><span class="s2">"is less than"</span><span class="p">,</span><span class="w"> </span><span class="n">thresholdValue</span><span class="p">,</span><span class="w"> </span><span class="s2">"plotting life expectancy graph... \n"</span><span class="p">)</span><span class="w">

        </span><span class="n">with</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">iCountry</span><span class="p">),</span><span class="w">
                </span><span class="n">plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w">
                     </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"o"</span><span class="p">,</span><span class="w">
                     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"Life Expectancy in"</span><span class="p">,</span><span class="w"> </span><span class="n">iCountry</span><span class="p">,</span><span class="w"> </span><span class="s2">"over time"</span><span class="p">),</span><span class="w">
                     </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Life Expectancy"</span><span class="p">,</span><span class="w">
                     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year"</span><span class="w">
                     </span><span class="p">)</span><span class="w"> </span><span class="c1"># end plot</span><span class="w">
             </span><span class="p">)</span><span class="w"> </span><span class="c1"># end with</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="c1"># end if</span><span class="w">
    </span><span class="n">rm</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="c1"># end for loop</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">if</code> and <code class="language-plaintext highlighter-rouge">else</code> to make choices.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">for</code> to repeat operations.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="creating-publication-quality-graphics-with-ggplot2" class="maintitle">Creating Publication-Quality Graphics with ggplot2</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 60 min
      <br />
      <strong>Exercises:</strong> 20 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I create publication-quality graphics in R?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>To be able to use ggplot2 to generate publication quality graphics.</p>
</li>
	
	<li><p>To apply geometry, aesthetic, and statistics layers to a ggplot plot.</p>
</li>
	
	<li><p>To manipulate the aesthetics of a plot using different colors, shapes, and lines.</p>
</li>
	
	<li><p>To improve data visualization through transforming scales and paneling by group.</p>
</li>
	
	<li><p>To save a plot created with ggplot to disk.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>Plotting our data is one of the best ways to
quickly explore it and the various relationships
between variables.</p>

<p>There are three main plotting systems in R,
the <a href="http://www.statmethods.net/graphs/index.html">base plotting system</a>, the <a href="http://www.statmethods.net/advgraphs/trellis.html">lattice</a>
package, and the <a href="http://www.statmethods.net/advgraphs/ggplot2.html">ggplot2</a> package.</p>

<p>Today we’ll be learning about the ggplot2 package, because
it is the most effective for creating publication quality
graphics.</p>

<p>ggplot2 is built on the grammar of graphics, the idea that any plot can be
expressed from the same set of components: a <strong>data</strong> set, a
<strong>coordinate system</strong>, and a set of <strong>geoms</strong> – the visual representation of data
points.</p>

<p>The key to understanding ggplot2 is thinking about a figure in layers.
This idea may be familiar to you if you have used image editing programs like Photoshop, Illustrator, or
Inkscape.</p>

<p>Let’s start off with an example:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-lifeExp-vs-gdpPercap-scatter-1.png" title="plot of chunk lifeExp-vs-gdpPercap-scatter" alt="plot of chunk lifeExp-vs-gdpPercap-scatter" width="612" style="display: block; margin: auto;" /></p>

<p>So the first thing we do is call the <code class="language-plaintext highlighter-rouge">ggplot</code> function. This function lets R
know that we’re creating a new plot, and any of the arguments we give the
<code class="language-plaintext highlighter-rouge">ggplot</code> function are the <em>global</em> options for the plot: they apply to all
layers on the plot.</p>

<p>We’ve passed in two arguments to <code class="language-plaintext highlighter-rouge">ggplot</code>. First, we tell <code class="language-plaintext highlighter-rouge">ggplot</code> what data we
want to show on our figure, in this example the gapminder data we read in
earlier. For the second argument,  we passed in the <code class="language-plaintext highlighter-rouge">aes</code> function, which
tells <code class="language-plaintext highlighter-rouge">ggplot</code> how variables in the <strong>data</strong> map to <em>aesthetic</em> properties of
the figure, in this case the <strong>x</strong> and <strong>y</strong> locations. Here we told <code class="language-plaintext highlighter-rouge">ggplot</code> we
want to plot the “gdpPercap” column of the gapminder data frame on the x-axis, and
the “lifeExp” column on the y-axis. Notice that we didn’t need to explicitly
pass <code class="language-plaintext highlighter-rouge">aes</code> these columns (e.g. <code class="language-plaintext highlighter-rouge">x = gapminder[, "gdpPercap"]</code>), this is because
<code class="language-plaintext highlighter-rouge">ggplot</code> is smart enough to know to look in the <strong>data</strong> for that column!</p>

<p>By itself, the call to <code class="language-plaintext highlighter-rouge">ggplot</code> isn’t enough to draw a figure:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-unnamed-chunk-2-1.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" width="612" style="display: block; margin: auto;" /></p>

<p>We need to tell <code class="language-plaintext highlighter-rouge">ggplot</code> how we want to visually represent the data, which we
do by adding a new <strong>geom</strong> layer. In our example, we used <code class="language-plaintext highlighter-rouge">geom_point</code>, which
tells <code class="language-plaintext highlighter-rouge">ggplot</code> we want to visually represent the relationship between <strong>x</strong> and
<strong>y</strong> as a scatterplot of points:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-lifeExp-vs-gdpPercap-scatter2-1.png" title="plot of chunk lifeExp-vs-gdpPercap-scatter2" alt="plot of chunk lifeExp-vs-gdpPercap-scatter2" width="612" style="display: block; margin: auto;" /></p>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Modify the example so that the figure shows how life expectancy has
changed over time:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div>  </div>

  <p>Hint: the gapminder dataset has a column called “year”, which should appear
on the x-axis.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to challenge 1</h2>

    <p>Here is one possible solution:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-08-ch1-sol-1.png" title="Binned scatterplot of life expectancy versus year showing how life expectancy has increased over time" alt="Binned scatterplot of life expectancy versus year showing how life expectancy has increased over time" width="612" style="display: block; margin: auto;" /></p>

  </blockquote>
</blockquote>

<blockquote class="challenge">

  <h2 id="challenge-2">Challenge 2</h2>

  <p>In the previous examples and challenge we’ve used the <code class="language-plaintext highlighter-rouge">aes</code> function to tell
the scatterplot <strong>geom</strong> about the <strong>x</strong> and <strong>y</strong> locations of each point.
Another <em>aesthetic</em> property we can modify is the point <em>color</em>. Modify the
code from the previous challenge to <strong>color</strong> the points by the “continent”
column. What trends do you see in the data? Are they what you expected?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to challenge 2</h2>

    <p>The solution presented below adds <code class="language-plaintext highlighter-rouge">color=continent</code> to the call of the <code class="language-plaintext highlighter-rouge">aes</code>
function. The general trend seems to indicate an increased life expectancy
over the years. On continents with stronger economies we find a longer life
expectancy.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-08-ch2-sol-1.png" title="Binned scatterplot of life expectancy vs year with color-coded continents showing value of 'aes' function" alt="Binned scatterplot of life expectancy vs year with color-coded continents showing value of 'aes' function" width="612" style="display: block; margin: auto;" /></p>

  </blockquote>
</blockquote>

<h2 id="layers">Layers</h2>

<p>Using a scatterplot probably isn’t the best for visualizing change over time.
Instead, let’s tell <code class="language-plaintext highlighter-rouge">ggplot</code> to visualize the data as a line plot:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-lifeExp-line-1.png" title="plot of chunk lifeExp-line" alt="plot of chunk lifeExp-line" width="612" style="display: block; margin: auto;" /></p>

<p>Instead of adding a <code class="language-plaintext highlighter-rouge">geom_point</code> layer, we’ve added a <code class="language-plaintext highlighter-rouge">geom_line</code> layer.</p>

<p>However, the result doesn’t look quite as we might have expected: it seems to be jumping around a lot in each continent. Let’s try to separate the data by country, plotting one line for each country:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-lifeExp-line-by-1.png" title="plot of chunk lifeExp-line-by" alt="plot of chunk lifeExp-line-by" width="612" style="display: block; margin: auto;" /></p>

<p>We’ve added the <strong>by</strong> <em>aesthetic</em>, which tells <code class="language-plaintext highlighter-rouge">ggplot</code> to draw a line for each
country.</p>

<p>But what if we want to visualize both lines and points on the plot? We can
add another layer to the plot:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-lifeExp-line-point-1.png" title="plot of chunk lifeExp-line-point" alt="plot of chunk lifeExp-line-point" width="612" style="display: block; margin: auto;" /></p>

<p>It’s important to note that each layer is drawn on top of the previous layer. In
this example, the points have been drawn <em>on top of</em> the lines. Here’s a
demonstration:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-lifeExp-layer-example-1-1.png" title="plot of chunk lifeExp-layer-example-1" alt="plot of chunk lifeExp-layer-example-1" width="612" style="display: block; margin: auto;" /></p>

<p>In this example, the <em>aesthetic</em> mapping of <strong>color</strong> has been moved from the
global plot options in <code class="language-plaintext highlighter-rouge">ggplot</code> to the <code class="language-plaintext highlighter-rouge">geom_line</code> layer so it no longer applies
to the points. Now we can clearly see that the points are drawn on top of the
lines.</p>

<blockquote class="callout">
  <h2 id="tip-setting-an-aesthetic-to-a-value-instead-of-a-mapping">Tip: Setting an aesthetic to a value instead of a mapping</h2>

  <p>So far, we’ve seen how to use an aesthetic (such as <strong>color</strong>) as a <em>mapping</em> to a variable in the data. For example, when we use <code class="language-plaintext highlighter-rouge">geom_line(mapping = aes(color=continent))</code>, ggplot will give a different color to each continent. But what if we want to change the colour of all lines to blue? You may think that <code class="language-plaintext highlighter-rouge">geom_line(mapping = aes(color="blue"))</code> should work, but it doesn’t. Since we don’t want to create a mapping to a specific variable, we can move the color specification outside of the <code class="language-plaintext highlighter-rouge">aes()</code> function, like this: <code class="language-plaintext highlighter-rouge">geom_line(color="blue")</code>.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>

  <p>Switch the order of the point and line layers from the previous example. What
happened?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to challenge 3</h2>

    <p>The lines now get drawn over the points!</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_line</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">continent</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-08-ch3-sol-1.png" title="plot of chunk ch3-sol" alt="plot of chunk ch3-sol" width="612" style="display: block; margin: auto;" /></p>

  </blockquote>
</blockquote>

<h2 id="transformations-and-statistics">Transformations and statistics</h2>

<p>ggplot2 also makes it easy to overlay statistical models over the data. To
demonstrate we’ll go back to our first example:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-lifeExp-vs-gdpPercap-scatter3-1.png" title="plot of chunk lifeExp-vs-gdpPercap-scatter3" alt="plot of chunk lifeExp-vs-gdpPercap-scatter3" width="612" style="display: block; margin: auto;" /></p>

<p>Currently it’s hard to see the relationship between the points due to some strong
outliers in GDP per capita. We can change the scale of units on the x axis using
the <em>scale</em> functions. These control the mapping between the data values and
visual values of an aesthetic. We can also modify the transparency of the
points, using the <em>alpha</em> function, which is especially helpful when you have
a large amount of data which is very clustered.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_log10</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-axis-scale-1.png" title="Scatterplot of GDP vs life expectancy showing logarithmic x-axis data spread" alt="Scatterplot of GDP vs life expectancy showing logarithmic x-axis data spread" width="612" style="display: block; margin: auto;" /></p>

<p>The <code class="language-plaintext highlighter-rouge">scale_x_log10</code> function applied a transformation to the coordinate system of the plot, so that each multiple of 10 is evenly spaced from left to right. For example, a GDP per capita of 1,000 is the same horizontal distance away from a value of 10,000 as the 10,000 value is from 100,000. This helps to visualize the spread of the data along the x-axis.</p>

<blockquote class="callout">
  <h2 id="tip-reminder-setting-an-aesthetic-to-a-value-instead-of-a-mapping">Tip Reminder: Setting an aesthetic to a value instead of a mapping</h2>

  <p>Notice that we used <code class="language-plaintext highlighter-rouge">geom_point(alpha = 0.5)</code>. As the previous tip mentioned, using a setting outside of the <code class="language-plaintext highlighter-rouge">aes()</code> function will cause this value to be used for all points, which is what we want in this case. But just like any other aesthetic setting, <em>alpha</em> can also be mapped to a variable in the data. For example, we can give a different transparency to each continent with <code class="language-plaintext highlighter-rouge">geom_point(mapping = aes(alpha = continent))</code>.</p>
</blockquote>

<p>We can fit a simple relationship to the data by adding another layer,
<code class="language-plaintext highlighter-rouge">geom_smooth</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_log10</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`geom_smooth()` using formula 'y ~ x'
</code></pre></div></div>

<p><img src="../fig/rmd-08-lm-fit-1.png" title="plot of chunk lm-fit" alt="plot of chunk lm-fit" width="612" style="display: block; margin: auto;" /></p>

<p>We can make the line thicker by <em>setting</em> the <strong>size</strong> aesthetic in the
<code class="language-plaintext highlighter-rouge">geom_smooth</code> layer:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_log10</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`geom_smooth()` using formula 'y ~ x'
</code></pre></div></div>

<p><img src="../fig/rmd-08-lm-fit2-1.png" title="plot of chunk lm-fit2" alt="plot of chunk lm-fit2" width="612" style="display: block; margin: auto;" /></p>

<p>There are two ways an <em>aesthetic</em> can be specified. Here we <em>set</em> the <strong>size</strong>
aesthetic by passing it as an argument to <code class="language-plaintext highlighter-rouge">geom_smooth</code>. Previously in the
lesson we’ve used the <code class="language-plaintext highlighter-rouge">aes</code> function to define a <em>mapping</em> between data
variables and their visual representation.</p>

<blockquote class="challenge">
  <h2 id="challenge-4a">Challenge 4a</h2>

  <p>Modify the color and size of the points on the point layer in the previous
example.</p>

  <p>Hint: do not use the <code class="language-plaintext highlighter-rouge">aes</code> function.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-4a">Solution to challenge 4a</h2>

    <p>Here a possible solution:
Notice that the <code class="language-plaintext highlighter-rouge">color</code> argument is supplied outside of the <code class="language-plaintext highlighter-rouge">aes()</code> function.
This means that it applies to all data points on the graph and is not related to
a specific variable.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_log10</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`geom_smooth()` using formula 'y ~ x'
</code></pre></div>    </div>

    <p><img src="../fig/rmd-08-ch4a-sol-1.png" title="plot of chunk ch4a-sol" alt="plot of chunk ch4a-sol" width="612" style="display: block; margin: auto;" /></p>

  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-4b">Challenge 4b</h2>

  <p>Modify your solution to Challenge 4a so that the
points are now a different shape and are colored by continent with new
trendlines.  Hint: The color argument can be used inside the aesthetic.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-4b">Solution to challenge 4b</h2>

    <p>Here is a possible solution:
Notice that supplying the <code class="language-plaintext highlighter-rouge">color</code> argument inside the <code class="language-plaintext highlighter-rouge">aes()</code> functions enables you to
connect it to a certain variable. The <code class="language-plaintext highlighter-rouge">shape</code> argument, as you can see, modifies all
data points the same way (it is outside the <code class="language-plaintext highlighter-rouge">aes()</code> call) while the <code class="language-plaintext highlighter-rouge">color</code> argument which
is placed inside the <code class="language-plaintext highlighter-rouge">aes()</code> call modifies a point’s color based on its continent value.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="m">17</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_log10</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`geom_smooth()` using formula 'y ~ x'
</code></pre></div>    </div>

    <p><img src="../fig/rmd-08-ch4b-sol-1.png" title="plot of chunk ch4b-sol" alt="plot of chunk ch4b-sol" width="612" style="display: block; margin: auto;" /></p>

  </blockquote>
</blockquote>

<h2 id="multi-panel-figures">Multi-panel figures</h2>

<p>Earlier we visualized the change in life expectancy over time across all
countries in one plot. Alternatively, we can split this out over multiple panels
by adding a layer of <strong>facet</strong> panels.</p>

<blockquote class="callout">
  <h2 id="tip">Tip</h2>

  <p>We start by making a subset of data including only countries located
in the Americas.  This includes 25 countries, which will begin to
clutter the figure.  Note that we apply a “theme” definition to rotate
the x-axis labels to maintain readability.  Nearly everything in
ggplot2 is customizable.</p>
</blockquote>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">americas</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Americas"</span><span class="p">,]</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">americas</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-facet-1.png" title="plot of chunk facet" alt="plot of chunk facet" width="612" style="display: block; margin: auto;" /></p>

<p>The <code class="language-plaintext highlighter-rouge">facet_wrap</code> layer took a “formula” as its argument, denoted by the tilde
(~). This tells R to draw a panel for each unique value in the country column
of the gapminder dataset.</p>

<h2 id="modifying-text">Modifying text</h2>

<p>To clean this figure up for a publication we need to change some of the text
elements. The x-axis is too cluttered, and the y axis should read
“Life expectancy”, rather than the column name in the data frame.</p>

<p>We can do this by adding a couple of different layers. The <strong>theme</strong> layer
controls the axis text, and overall text size. Labels for the axes, plot
title and any legend can be set using the <code class="language-plaintext highlighter-rouge">labs</code> function. Legend titles
are set using the same names we used in the <code class="language-plaintext highlighter-rouge">aes</code> specification. Thus below
the color legend title is set using <code class="language-plaintext highlighter-rouge">color = "Continent"</code>, while the title
of a fill legend would be set using <code class="language-plaintext highlighter-rouge">fill = "MyTitle"</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">americas</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_wrap</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year"</span><span class="p">,</span><span class="w">              </span><span class="c1"># x axis title</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Life expectancy"</span><span class="p">,</span><span class="w">   </span><span class="c1"># y axis title</span><span class="w">
    </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Figure 1"</span><span class="p">,</span><span class="w">      </span><span class="c1"># main title of figure</span><span class="w">
    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Continent"</span><span class="w">      </span><span class="c1"># title of legend</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-theme-1.png" title="plot of chunk theme" alt="plot of chunk theme" width="612" style="display: block; margin: auto;" /></p>

<h2 id="exporting-the-plot">Exporting the plot</h2>

<p>The <code class="language-plaintext highlighter-rouge">ggsave()</code> function allows you to export a plot created with ggplot. You can specify the dimension and resolution of your plot by adjusting the appropriate arguments (<code class="language-plaintext highlighter-rouge">width</code>, <code class="language-plaintext highlighter-rouge">height</code> and <code class="language-plaintext highlighter-rouge">dpi</code>) to create high quality graphics for publication. In order to save the plot from above, we first assign it to a variable <code class="language-plaintext highlighter-rouge">lifeExp_plot</code>, then tell <code class="language-plaintext highlighter-rouge">ggsave</code> to save that plot in <code class="language-plaintext highlighter-rouge">png</code> format to a directory called <code class="language-plaintext highlighter-rouge">results</code>. (Make sure you have a <code class="language-plaintext highlighter-rouge">results/</code> folder in your working directory.)</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lifeExp_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">americas</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_wrap</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Year"</span><span class="p">,</span><span class="w">              </span><span class="c1"># x axis title</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Life expectancy"</span><span class="p">,</span><span class="w">   </span><span class="c1"># y axis title</span><span class="w">
    </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Figure 1"</span><span class="p">,</span><span class="w">      </span><span class="c1"># main title of figure</span><span class="w">
    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Continent"</span><span class="w">      </span><span class="c1"># title of legend</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="n">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"results/lifeExp.png"</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp_plot</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>There are two nice things about <code class="language-plaintext highlighter-rouge">ggsave</code>. First, it defaults to the last plot, so if you omit the <code class="language-plaintext highlighter-rouge">plot</code> argument it will automatically save the last plot you created with <code class="language-plaintext highlighter-rouge">ggplot</code>. Secondly, it tries to determine the format you want to save your plot in from the file extension you provide for the filename (for example <code class="language-plaintext highlighter-rouge">.png</code> or <code class="language-plaintext highlighter-rouge">.pdf</code>). If you need to, you can specify the format explicitly in the <code class="language-plaintext highlighter-rouge">device</code> argument.</p>

<p>This is a taste of what you can do with ggplot2. RStudio provides a
really useful <a href="https://www.rstudio.org/links/data_visualization_cheat_sheet">cheat sheet</a> of the different layers available, and more
extensive documentation is available on the <a href="https://ggplot2.tidyverse.org/reference/">ggplot2 website</a>.
Finally, if you have no idea how to change something, a quick Google search will
usually send you to a relevant question and answer on Stack Overflow with reusable
code to modify!</p>

<blockquote class="challenge">
  <h2 id="challenge-5">Challenge 5</h2>

  <p>Generate boxplots to compare life expectancy between the different continents during the available years.</p>

  <p>Advanced:</p>
  <ul>
    <li>Rename y axis as Life Expectancy.</li>
    <li>Remove x axis labels.</li>
  </ul>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-5">Solution to Challenge 5</h2>

    <p>Here a possible solution:
<code class="language-plaintext highlighter-rouge">xlab()</code> and <code class="language-plaintext highlighter-rouge">ylab()</code> set labels for the x and y axes, respectively
The axis title, text and ticks are attributes of the theme and must be modified within a <code class="language-plaintext highlighter-rouge">theme()</code> call.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Life Expectancy"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.title.x</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
       </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
       </span><span class="n">axis.ticks.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-08-ch5-sol-1.png" title="plot of chunk ch5-sol" alt="plot of chunk ch5-sol" width="612" style="display: block; margin: auto;" /></p>

  </blockquote>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">ggplot2</code> to create plots.</p>
</li>
    
    <li><p>Think about graphics in layers: aesthetics, geometry, statistics, scale transformation, and grouping.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="vectorization" class="maintitle">Vectorization</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 10 min
      <br />
      <strong>Exercises:</strong> 15 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I operate on all the elements of a vector at once?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>To understand vectorized operations in R.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>Most of R’s functions are vectorized, meaning that the function will
operate on all elements of a vector without needing to loop through
and act on each element one at a time. This makes writing code more
concise, easy to read, and less error prone.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2 4 6 8
</code></pre></div></div>

<p>The multiplication happened to each element of the vector.</p>

<p>We can also add two vectors together:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">6</span><span class="o">:</span><span class="m">9</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  7  9 11 13
</code></pre></div></div>

<p>Each element of <code class="language-plaintext highlighter-rouge">x</code> was added to its corresponding element of <code class="language-plaintext highlighter-rouge">y</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="o">:</span><span class="w">  </span><span class="m">1</span><span class="w">  </span><span class="m">2</span><span class="w">  </span><span class="m">3</span><span class="w">  </span><span class="m">4</span><span class="w">
    </span><span class="o">+</span><span class="w">  </span><span class="o">+</span><span class="w">  </span><span class="o">+</span><span class="w">  </span><span class="o">+</span><span class="w">
</span><span class="n">y</span><span class="o">:</span><span class="w">  </span><span class="m">6</span><span class="w">  </span><span class="m">7</span><span class="w">  </span><span class="m">8</span><span class="w">  </span><span class="m">9</span><span class="w">
</span><span class="o">---------------</span><span class="w">
    </span><span class="m">7</span><span class="w">  </span><span class="m">9</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span><span class="w">
</span></code></pre></div></div>

<p>Here is how we would add two vectors together using a for loop:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output_vector</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">output_vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">output_vector</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  7  9 11 13
</code></pre></div></div>

<p>Compare this to the output using vectorised operations.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sum_xy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w">
</span><span class="n">sum_xy</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  7  9 11 13
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Let’s try this on the <code class="language-plaintext highlighter-rouge">pop</code> column of the <code class="language-plaintext highlighter-rouge">gapminder</code> dataset.</p>

  <p>Make a new column in the <code class="language-plaintext highlighter-rouge">gapminder</code> data frame that
contains population in units of millions of people.
Check the head or tail of the data frame to make sure
it worked.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to challenge 1</h2>

    <p>Let’s try this on the <code class="language-plaintext highlighter-rouge">pop</code> column of the <code class="language-plaintext highlighter-rouge">gapminder</code> dataset.</p>

    <p>Make a new column in the <code class="language-plaintext highlighter-rouge">gapminder</code> data frame that
contains population in units of millions of people.
Check the head or tail of the data frame to make sure
it worked.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="o">$</span><span class="n">pop_millions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="o">$</span><span class="n">pop</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1e6</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      country year      pop continent lifeExp gdpPercap pop_millions
1 Afghanistan 1952  8425333      Asia  28.801  779.4453     8.425333
2 Afghanistan 1957  9240934      Asia  30.332  820.8530     9.240934
3 Afghanistan 1962 10267083      Asia  31.997  853.1007    10.267083
4 Afghanistan 1967 11537966      Asia  34.020  836.1971    11.537966
5 Afghanistan 1972 13079460      Asia  36.088  739.9811    13.079460
6 Afghanistan 1977 14880372      Asia  38.438  786.1134    14.880372
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>On a single graph, plot population, in
millions, against year, for all countries. Do not worry about
identifying which country is which.</p>

  <p>Repeat the exercise, graphing only for China, India, and
Indonesia. Again, do not worry about which is which.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to challenge 2</h2>

    <p>Refresh your plotting skills by plotting population in millions against year.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pop_millions</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
 </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-09-ch2-sol-1.png" title="plot of chunk ch2-sol" alt="plot of chunk ch2-sol" width="612" style="display: block; margin: auto;" /></p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">countryset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"China"</span><span class="p">,</span><span class="s2">"India"</span><span class="p">,</span><span class="s2">"Indonesia"</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">countryset</span><span class="p">,],</span><span class="w">
       </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pop_millions</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-09-ch2-sol-2.png" title="plot of chunk ch2-sol" alt="plot of chunk ch2-sol" width="612" style="display: block; margin: auto;" /></p>
  </blockquote>
</blockquote>

<p>Comparison operators, logical operators, and many functions are also
vectorized:</p>

<p><strong>Comparison operators</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] FALSE FALSE  TRUE  TRUE
</code></pre></div></div>

<p><strong>Logical operators</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="c1"># or, for clarity, a &lt;- (x &gt; 3)</span><span class="w">
</span><span class="n">a</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] FALSE FALSE FALSE  TRUE
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-some-useful-functions-for-logical-vectors">Tip: some useful functions for logical vectors</h2>

  <p><code class="language-plaintext highlighter-rouge">any()</code> will return <code class="language-plaintext highlighter-rouge">TRUE</code> if <em>any</em> element of a vector is <code class="language-plaintext highlighter-rouge">TRUE</code>.<br />
<code class="language-plaintext highlighter-rouge">all()</code> will return <code class="language-plaintext highlighter-rouge">TRUE</code> if <em>all</em> elements of a vector are <code class="language-plaintext highlighter-rouge">TRUE</code>.</p>
</blockquote>

<p>Most functions also operate element-wise on vectors:</p>

<p><strong>Functions</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="w">
</span><span class="nf">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0.0000000 0.6931472 1.0986123 1.3862944
</code></pre></div></div>

<p>Vectorized operations work element-wise on matrices:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">-1</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1] [,2] [,3] [,4]
[1,]   -1   -4   -7  -10
[2,]   -2   -5   -8  -11
[3,]   -3   -6   -9  -12
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-element-wise-vs-matrix-multiplication">Tip: element-wise vs. matrix multiplication</h2>

  <p>Very important: the operator <code class="language-plaintext highlighter-rouge">*</code> gives you element-wise multiplication!
To do matrix multiplication, we need to use the <code class="language-plaintext highlighter-rouge">%*%</code> operator:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1]
[1,]   22
[2,]   26
[3,]   30
</code></pre></div>  </div>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1]
[1,]   30
</code></pre></div>  </div>

  <p>For more on matrix algebra, see the <a href="http://www.statmethods.net/advstats/matrix.html">Quick-R reference
guide</a></p>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>

  <p>Given the following matrix:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">m</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1] [,2] [,3] [,4]
[1,]    1    4    7   10
[2,]    2    5    8   11
[3,]    3    6    9   12
</code></pre></div>  </div>

  <p>Write down what you think will happen when you run:</p>

  <ol>
    <li><code class="language-plaintext highlighter-rouge">m ^ -1</code></li>
    <li><code class="language-plaintext highlighter-rouge">m * c(1, 0, -1)</code></li>
    <li><code class="language-plaintext highlighter-rouge">m &gt; c(0, 20)</code></li>
    <li><code class="language-plaintext highlighter-rouge">m * c(1, 0, -1, 2)</code></li>
  </ol>

  <p>Did you get the output you expected? If not, ask a helper!</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to challenge 3</h2>

    <p>Given the following matrix:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">m</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1] [,2] [,3] [,4]
[1,]    1    4    7   10
[2,]    2    5    8   11
[3,]    3    6    9   12
</code></pre></div>    </div>

    <p>Write down what you think will happen when you run:</p>

    <ol>
      <li><code class="language-plaintext highlighter-rouge">m ^ -1</code></li>
    </ol>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>          [,1]      [,2]      [,3]       [,4]
[1,] 1.0000000 0.2500000 0.1428571 0.10000000
[2,] 0.5000000 0.2000000 0.1250000 0.09090909
[3,] 0.3333333 0.1666667 0.1111111 0.08333333
</code></pre></div>    </div>

    <ol>
      <li><code class="language-plaintext highlighter-rouge">m * c(1, 0, -1)</code></li>
    </ol>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     [,1] [,2] [,3] [,4]
[1,]    1    4    7   10
[2,]    0    0    0    0
[3,]   -3   -6   -9  -12
</code></pre></div>    </div>

    <ol>
      <li><code class="language-plaintext highlighter-rouge">m &gt; c(0, 20)</code></li>
    </ol>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      [,1]  [,2]  [,3]  [,4]
[1,]  TRUE FALSE  TRUE FALSE
[2,] FALSE  TRUE FALSE  TRUE
[3,]  TRUE FALSE  TRUE FALSE
</code></pre></div>    </div>

  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-4">Challenge 4</h2>

  <p>We’re interested in looking at the sum of the
following sequence of fractions:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">2</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">3</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">...</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <p>This would be tedious to type out, and impossible for high values of
n.  Use vectorisation to compute x when n=100. What is the sum when
n=10,000?</p>

  <blockquote class="solution">
    <h2 id="challenge-4-1">Challenge 4</h2>

    <p>We’re interested in looking at the sum of the
following sequence of fractions:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">2</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">3</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">...</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p>This would be tedious to type out, and impossible for
high values of n.
Can you use vectorisation to compute x, when n=100?
How about when n=10,000?</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">sum</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1.634984
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">sum</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">1e04</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1.644834
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1.644834
</code></pre></div>    </div>

    <p>We can also obtain the same results using a function:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">inverse_sum_of_squares</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nf">sum</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">inverse_sum_of_squares</span><span class="p">(</span><span class="m">100</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1.634984
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">inverse_sum_of_squares</span><span class="p">(</span><span class="m">10000</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1.644834
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span><span class="n">inverse_sum_of_squares</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1.644834
</code></pre></div>    </div>

  </blockquote>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use vectorized operations instead of loops.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="functions-explained" class="maintitle">Functions Explained</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 45 min
      <br />
      <strong>Exercises:</strong> 15 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I write a new function in R?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Define a function that takes arguments.</p>
</li>
	
	<li><p>Return a value from a function.</p>
</li>
	
	<li><p>Check argument conditions with <code class="language-plaintext highlighter-rouge">stopifnot()</code> in functions.</p>
</li>
	
	<li><p>Test a function.</p>
</li>
	
	<li><p>Set default values for function arguments.</p>
</li>
	
	<li><p>Explain why we should divide programs into small, single-purpose functions.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>If we only had one data set to analyze, it would probably be faster to load the
file into a spreadsheet and use that to plot simple statistics. However, the
gapminder data is updated periodically, and we may want to pull in that new
information later and re-run our analysis again. We may also obtain similar data
from a different source in the future.</p>

<p>In this lesson, we’ll learn how to write a function so that we can repeat
several operations with a single command.</p>

<blockquote class="callout">
  <h2 id="what-is-a-function">What is a function?</h2>

  <p>Functions gather a sequence of operations into a whole, preserving it for
ongoing use. Functions provide:</p>

  <ul>
    <li>a name we can remember and invoke it by</li>
    <li>relief from the need to remember the individual operations</li>
    <li>a defined set of inputs and expected outputs</li>
    <li>rich connections to the larger programming environment</li>
  </ul>

  <p>As the basic building block of most programming languages, user-defined
functions constitute “programming” as much as any single abstraction can. If
you have written a function, you are a computer programmer.</p>
</blockquote>

<h2 id="defining-a-function">Defining a function</h2>

<p>Let’s open a new R script file in the <code class="language-plaintext highlighter-rouge">functions/</code> directory and call it
functions-lesson.R.</p>

<p>The general structure of a function is:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">my_function</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># perform action</span><span class="w">
  </span><span class="c1"># return value</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Let’s define a function <code class="language-plaintext highlighter-rouge">fahr_to_kelvin()</code> that converts temperatures from
Fahrenheit to Kelvin:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fahr_to_kelvin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">kelvin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">((</span><span class="n">temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">32</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">5</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">9</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">273.15</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">kelvin</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>We define <code class="language-plaintext highlighter-rouge">fahr_to_kelvin()</code> by assigning it to the output of <code class="language-plaintext highlighter-rouge">function</code>. The
list of argument names are contained within parentheses.   Next, the
<a href="../reference.html#body">body</a> of the function–the
statements that are executed when it runs–is contained within curly braces
(<code class="language-plaintext highlighter-rouge">{}</code>). The statements in the body are indented by two spaces. This makes the
code easier to read but does not affect how the code operates.</p>

<p>It is useful to think of creating functions like writing a cookbook. First you define the “ingredients” that your function needs. In this case, we only need one ingredient to use our function: “temp”. After we list our ingredients, we then say what we will do with them, in this case, we are taking our ingredient and applying a set of mathematical operators to it.</p>

<p>When we call the function, the values we pass to it as arguments are assigned to
those variables so that we can use them inside the function. Inside the
function, we use a <a href="../reference.html#return-statement">return
statement</a> to send a result back to
whoever asked for it.</p>

<blockquote class="callout">
  <h2 id="tip">Tip</h2>

  <p>One feature unique to R is that the return statement is not required.
R automatically returns whichever variable is on the last line of the body
of the function. But for clarity, we will explicitly define the
return statement.</p>
</blockquote>

<p>Let’s try running our function.
Calling our own function is no different from calling any other function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># freezing point of water</span><span class="w">
</span><span class="n">fahr_to_kelvin</span><span class="p">(</span><span class="m">32</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 273.15
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># boiling point of water</span><span class="w">
</span><span class="n">fahr_to_kelvin</span><span class="p">(</span><span class="m">212</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 373.15
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Write a function called <code class="language-plaintext highlighter-rouge">kelvin_to_celsius()</code> that takes a temperature in
Kelvin and returns that temperature in Celsius.</p>

  <p>Hint: To convert from Kelvin to Celsius you subtract 273.15</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to challenge 1</h2>

    <p>Write a function called <code class="language-plaintext highlighter-rouge">kelvin_to_celsius</code> that takes a temperature in Kelvin
and returns that temperature in Celsius</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kelvin_to_celsius</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="n">celsius</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">273.15</span><span class="w">
 </span><span class="nf">return</span><span class="p">(</span><span class="n">celsius</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="combining-functions">Combining functions</h2>

<p>The real power of functions comes from mixing, matching and combining them
into ever-larger chunks to get the effect we want.</p>

<p>Let’s define two functions that will convert temperature from Fahrenheit to
Kelvin, and Kelvin to Celsius:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fahr_to_kelvin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">kelvin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">((</span><span class="n">temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">32</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">5</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">9</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">273.15</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">kelvin</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">kelvin_to_celsius</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">celsius</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">273.15</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">celsius</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>Define the function to convert directly from Fahrenheit to Celsius,
by reusing the two functions above (or using your own functions if you
prefer).</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to challenge 2</h2>

    <p>Define the function to convert directly from Fahrenheit to Celsius,
by reusing these two functions above</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fahr_to_celsius</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">temp_k</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fahr_to_kelvin</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w">
  </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">kelvin_to_celsius</span><span class="p">(</span><span class="n">temp_k</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="interlude-defensive-programming">Interlude: Defensive Programming</h2>

<p>Now that we’ve begun to appreciate how writing functions provides an efficient
way to make R code re-usable and modular, we should note that it is important
to ensure that functions only work in their intended use-cases. Checking
function parameters is related to the concept of <em>defensive programming</em>.
Defensive programming encourages us to frequently check conditions and throw an
error if something is wrong. These checks are referred to as assertion
statements because we want to assert some condition is <code class="language-plaintext highlighter-rouge">TRUE</code> before proceeding.
They make it easier to debug because they give us a better idea of where the
errors originate.</p>

<h3 id="checking-conditions-with-stopifnot">Checking conditions with <code class="language-plaintext highlighter-rouge">stopifnot()</code></h3>

<p>Let’s start by re-examining <code class="language-plaintext highlighter-rouge">fahr_to_kelvin()</code>, our function for converting
temperatures from Fahrenheit to Kelvin. It was defined like so:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fahr_to_kelvin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">kelvin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">((</span><span class="n">temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">32</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">5</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">9</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">273.15</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">kelvin</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>For this function to work as intended, the argument <code class="language-plaintext highlighter-rouge">temp</code> must be a <code class="language-plaintext highlighter-rouge">numeric</code>
value; otherwise, the mathematical procedure for converting between the two
temperature scales will not work. To create an error, we can use the function
<code class="language-plaintext highlighter-rouge">stop()</code>. For example, since the argument <code class="language-plaintext highlighter-rouge">temp</code> must be a <code class="language-plaintext highlighter-rouge">numeric</code> vector, we
could check for this condition with an <code class="language-plaintext highlighter-rouge">if</code> statement and throw an error if the
condition was violated. We could augment our function above like so:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fahr_to_kelvin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">stop</span><span class="p">(</span><span class="s2">"temp must be a numeric vector."</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">kelvin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">((</span><span class="n">temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">32</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">5</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">9</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">273.15</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">kelvin</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>If we had multiple conditions or arguments to check, it would take many lines
of code to check all of them. Luckily R provides the convenience function
<code class="language-plaintext highlighter-rouge">stopifnot()</code>. We can list as many requirements that should evaluate to <code class="language-plaintext highlighter-rouge">TRUE</code>;
<code class="language-plaintext highlighter-rouge">stopifnot()</code> throws an error if it finds one that is <code class="language-plaintext highlighter-rouge">FALSE</code>. Listing these
conditions also serves a secondary purpose as extra documentation for the
function.</p>

<p>Let’s try out defensive programming with <code class="language-plaintext highlighter-rouge">stopifnot()</code> by adding assertions to
check the input to our function <code class="language-plaintext highlighter-rouge">fahr_to_kelvin()</code>.</p>

<p>We want to assert the following: <code class="language-plaintext highlighter-rouge">temp</code> is a numeric vector. We may do that like
so:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fahr_to_kelvin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">stopifnot</span><span class="p">(</span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span><span class="w">
  </span><span class="n">kelvin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">((</span><span class="n">temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">32</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">5</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">9</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">273.15</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">kelvin</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>It still works when given proper input.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># freezing point of water</span><span class="w">
</span><span class="n">fahr_to_kelvin</span><span class="p">(</span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">32</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 273.15
</code></pre></div></div>

<p>But fails instantly if given improper input.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Metric is a factor instead of numeric</span><span class="w">
</span><span class="n">fahr_to_kelvin</span><span class="p">(</span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="m">32</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext error highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in fahr_to_kelvin(temp = as.factor(32)): is.numeric(temp) is not TRUE
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>

  <p>Use defensive programming to ensure that our <code class="language-plaintext highlighter-rouge">fahr_to_celsius()</code> function
throws an error immediately if the argument <code class="language-plaintext highlighter-rouge">temp</code> is specified
inappropriately.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to challenge 3</h2>

    <p>Extend our previous definition of the function by adding in an explicit call
to <code class="language-plaintext highlighter-rouge">stopifnot()</code>. Since <code class="language-plaintext highlighter-rouge">fahr_to_celsius()</code> is a composition of two other
functions, checking inside here makes adding checks to the two component
functions redundant.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fahr_to_celsius</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">stopifnot</span><span class="p">(</span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span><span class="w">
  </span><span class="n">temp_k</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fahr_to_kelvin</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="w">
  </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">kelvin_to_celsius</span><span class="p">(</span><span class="n">temp_k</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="more-on-combining-functions">More on combining functions</h2>

<p>Now, we’re going to define a function that calculates the Gross Domestic Product
of a nation from the data available in our dataset:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Takes a dataset and multiplies the population column</span><span class="w">
</span><span class="c1"># with the GDP per capita column.</span><span class="w">
</span><span class="n">calcGDP</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">gdp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">pop</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">gdpPercap</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">gdp</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>We define <code class="language-plaintext highlighter-rouge">calcGDP()</code> by assigning it to the output of <code class="language-plaintext highlighter-rouge">function</code>. The list of
argument names are contained within parentheses. Next, the body of the function
– the statements executed when you call the function – is contained within
curly braces (<code class="language-plaintext highlighter-rouge">{}</code>).</p>

<p>We’ve indented the statements in the body by two spaces. This makes the code
easier to read but does not affect how it operates.</p>

<p>When we call the function, the values we pass to it are assigned to the
arguments, which become variables inside the body of the function.</p>

<p>Inside the function, we use the <code class="language-plaintext highlighter-rouge">return()</code> function to send back the result.
This <code class="language-plaintext highlighter-rouge">return()</code> function is optional: R will automatically return the results of
whatever command is executed on the last line of the function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calcGDP</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">gapminder</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1]  6567086330  7585448670  8758855797  9648014150  9678553274 11697659231
</code></pre></div></div>

<p>That’s not very informative. Let’s add some more arguments so we can extract
that per year and country.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Takes a dataset and multiplies the population column</span><span class="w">
</span><span class="c1"># with the GDP per capita column.</span><span class="w">
</span><span class="n">calcGDP</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">year</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="p">[</span><span class="n">dat</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="p">[</span><span class="n">dat</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">country</span><span class="p">,]</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">gdp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">pop</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">gdpPercap</span><span class="w">

  </span><span class="n">new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">gdp</span><span class="o">=</span><span class="n">gdp</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">new</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>If you’ve been writing these functions down into a separate R script
(a good idea!), you can load in the functions into our R session by using the
<code class="language-plaintext highlighter-rouge">source()</code> function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span><span class="p">(</span><span class="s2">"functions/functions-lesson.R"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Ok, so there’s a lot going on in this function now. In plain English, the
function now subsets the provided data by year if the year argument isn’t empty,
then subsets the result by country if the country argument isn’t empty. Then it
calculates the GDP for whatever subset emerges from the previous two steps. The
function then adds the GDP as a new column to the subsetted data and returns
this as the final result. You can see that the output is much more informative
than a vector of numbers.</p>

<p>Let’s take a look at what happens when we specify the year:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">calcGDP</span><span class="p">(</span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="o">=</span><span class="m">2007</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       country year      pop continent lifeExp  gdpPercap          gdp
12 Afghanistan 2007 31889923      Asia  43.828   974.5803  31079291949
24     Albania 2007  3600523    Europe  76.423  5937.0295  21376411360
36     Algeria 2007 33333216    Africa  72.301  6223.3675 207444851958
48      Angola 2007 12420476    Africa  42.731  4797.2313  59583895818
60   Argentina 2007 40301927  Americas  75.320 12779.3796 515033625357
72   Australia 2007 20434176   Oceania  81.235 34435.3674 703658358894
</code></pre></div></div>

<p>Or for a specific country:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calcGDP</span><span class="p">(</span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="o">=</span><span class="s2">"Australia"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     country year      pop continent lifeExp gdpPercap          gdp
61 Australia 1952  8691212   Oceania  69.120  10039.60  87256254102
62 Australia 1957  9712569   Oceania  70.330  10949.65 106349227169
63 Australia 1962 10794968   Oceania  70.930  12217.23 131884573002
64 Australia 1967 11872264   Oceania  71.100  14526.12 172457986742
65 Australia 1972 13177000   Oceania  71.930  16788.63 221223770658
66 Australia 1977 14074100   Oceania  73.490  18334.20 258037329175
67 Australia 1982 15184200   Oceania  74.740  19477.01 295742804309
68 Australia 1987 16257249   Oceania  76.320  21888.89 355853119294
69 Australia 1992 17481977   Oceania  77.560  23424.77 409511234952
70 Australia 1997 18565243   Oceania  78.830  26997.94 501223252921
71 Australia 2002 19546792   Oceania  80.370  30687.75 599847158654
72 Australia 2007 20434176   Oceania  81.235  34435.37 703658358894
</code></pre></div></div>

<p>Or both:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calcGDP</span><span class="p">(</span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="o">=</span><span class="m">2007</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="o">=</span><span class="s2">"Australia"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     country year      pop continent lifeExp gdpPercap          gdp
72 Australia 2007 20434176   Oceania  81.235  34435.37 703658358894
</code></pre></div></div>

<p>Let’s walk through the body of the function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calcGDP</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></code></pre></div></div>

<p>Here we’ve added two arguments, <code class="language-plaintext highlighter-rouge">year</code>, and <code class="language-plaintext highlighter-rouge">country</code>. We’ve set
<em>default arguments</em> for both as <code class="language-plaintext highlighter-rouge">NULL</code> using the <code class="language-plaintext highlighter-rouge">=</code> operator
in the function definition. This means that those arguments will
take on those values unless the user specifies otherwise.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">year</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="p">[</span><span class="n">dat</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="p">[</span><span class="n">dat</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">country</span><span class="p">,]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Here, we check whether each additional argument is set to <code class="language-plaintext highlighter-rouge">null</code>, and whenever
they’re not <code class="language-plaintext highlighter-rouge">null</code> overwrite the dataset stored in <code class="language-plaintext highlighter-rouge">dat</code> with a subset given by
the non-<code class="language-plaintext highlighter-rouge">null</code> argument.</p>

<p>Building these conditionals into the function makes it more flexible for later.
Now, we can use it to calculate the GDP for:</p>

<ul>
  <li>The whole dataset;</li>
  <li>A single year;</li>
  <li>A single country;</li>
  <li>A single combination of year and country.</li>
</ul>

<p>By using <code class="language-plaintext highlighter-rouge">%in%</code> instead, we can also give multiple years or countries to those
arguments.</p>

<blockquote class="callout">
  <h2 id="tip-pass-by-value">Tip: Pass by value</h2>

  <p>Functions in R almost always make copies of the data to operate on
inside of a function body. When we modify <code class="language-plaintext highlighter-rouge">dat</code> inside the function
we are modifying the copy of the gapminder dataset stored in <code class="language-plaintext highlighter-rouge">dat</code>,
not the original variable we gave as the first argument.</p>

  <p>This is called “pass-by-value” and it makes writing code much safer:
you can always be sure that whatever changes you make within the
body of the function, stay inside the body of the function.</p>
</blockquote>

<blockquote class="callout">
  <h2 id="tip-function-scope">Tip: Function scope</h2>

  <p>Another important concept is scoping: any variables (or functions!) you
create or modify inside the body of a function only exist for the lifetime
of the function’s execution. When we call <code class="language-plaintext highlighter-rouge">calcGDP()</code>, the variables <code class="language-plaintext highlighter-rouge">dat</code>,
<code class="language-plaintext highlighter-rouge">gdp</code> and <code class="language-plaintext highlighter-rouge">new</code> only exist inside the body of the function. Even if we
have variables of the same name in our interactive R session, they are
not modified in any way when executing a function.</p>
</blockquote>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">gdp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">pop</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">gdpPercap</span><span class="w">
  </span><span class="n">new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">gdp</span><span class="o">=</span><span class="n">gdp</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">new</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Finally, we calculated the GDP on our new subset, and created a new data frame
with that column added. This means when we call the function later we can see
the context for the returned GDP values, which is much better than in our first
attempt where we got a vector of numbers.</p>

<blockquote class="challenge">
  <h2 id="challenge-4">Challenge 4</h2>

  <p>Test out your GDP function by calculating the GDP for New Zealand in 1987. How
does this differ from New Zealand’s GDP in 1952?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-4">Solution to challenge 4</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">calcGDP</span><span class="p">(</span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1952</span><span class="p">,</span><span class="w"> </span><span class="m">1987</span><span class="p">),</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"New Zealand"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>GDP for New Zealand in 1987: 65050008703</p>

    <p>GDP for New Zealand in 1952: 21058193787</p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-5">Challenge 5</h2>

  <p>The <code class="language-plaintext highlighter-rouge">paste()</code> function can be used to combine text together, e.g:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">best_practice</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Write"</span><span class="p">,</span><span class="w"> </span><span class="s2">"programs"</span><span class="p">,</span><span class="w"> </span><span class="s2">"for"</span><span class="p">,</span><span class="w"> </span><span class="s2">"people"</span><span class="p">,</span><span class="w"> </span><span class="s2">"not"</span><span class="p">,</span><span class="w"> </span><span class="s2">"computers"</span><span class="p">)</span><span class="w">
</span><span class="n">paste</span><span class="p">(</span><span class="n">best_practice</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s2">" "</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Write programs for people not computers"
</code></pre></div>  </div>

  <p>Write a function called <code class="language-plaintext highlighter-rouge">fence()</code> that takes two vectors as arguments, called
<code class="language-plaintext highlighter-rouge">text</code> and <code class="language-plaintext highlighter-rouge">wrapper</code>, and prints out the text wrapped with the <code class="language-plaintext highlighter-rouge">wrapper</code>:</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fence</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">best_practice</span><span class="p">,</span><span class="w"> </span><span class="n">wrapper</span><span class="o">=</span><span class="s2">"***"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <p><em>Note:</em> the <code class="language-plaintext highlighter-rouge">paste()</code> function has an argument called <code class="language-plaintext highlighter-rouge">sep</code>, which specifies
the separator between text. The default is a space: “ “. The default for
<code class="language-plaintext highlighter-rouge">paste0()</code> is no space “”.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-5">Solution to challenge 5</h2>

    <p>Write a function called <code class="language-plaintext highlighter-rouge">fence()</code> that takes two vectors as arguments,
called <code class="language-plaintext highlighter-rouge">text</code> and <code class="language-plaintext highlighter-rouge">wrapper</code>, and prints out the text wrapped with the
<code class="language-plaintext highlighter-rouge">wrapper</code>:</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fence</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">wrapper</span><span class="p">){</span><span class="w">
  </span><span class="n">text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">wrapper</span><span class="p">)</span><span class="w">
  </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" "</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">best_practice</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Write"</span><span class="p">,</span><span class="w"> </span><span class="s2">"programs"</span><span class="p">,</span><span class="w"> </span><span class="s2">"for"</span><span class="p">,</span><span class="w"> </span><span class="s2">"people"</span><span class="p">,</span><span class="w"> </span><span class="s2">"not"</span><span class="p">,</span><span class="w"> </span><span class="s2">"computers"</span><span class="p">)</span><span class="w">
</span><span class="n">fence</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">best_practice</span><span class="p">,</span><span class="w"> </span><span class="n">wrapper</span><span class="o">=</span><span class="s2">"***"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "*** Write programs for people not computers ***"
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="callout">
  <h2 id="tip-1">Tip</h2>

  <p>R has some unique aspects that can be exploited when performing more
complicated operations. We will not be writing anything that requires
knowledge of these more advanced concepts. In the future when you are
comfortable writing functions in R, you can learn more by reading the
<a href="http://cran.r-project.org/doc/manuals/r-release/R-lang.html#Environment-objects">R Language Manual</a> or this <a href="http://adv-r.had.co.nz/Environments.html">chapter</a> from
<a href="http://adv-r.had.co.nz/">Advanced R Programming</a> by Hadley Wickham.</p>
</blockquote>

<blockquote class="callout">
  <h2 id="tip-testing-and-documenting">Tip: Testing and documenting</h2>

  <p>It’s important to both test functions and document them:
Documentation helps you, and others, understand what the
purpose of your function is, and how to use it, and its
important to make sure that your function actually does
what you think.</p>

  <p>When you first start out, your workflow will probably look a lot
like this:</p>

  <ol>
    <li>Write a function</li>
    <li>Comment parts of the function to document its behaviour</li>
    <li>Load in the source file</li>
    <li>Experiment with it in the console to make sure it behaves
as you expect</li>
    <li>Make any necessary bug fixes</li>
    <li>Rinse and repeat.</li>
  </ol>

  <p>Formal documentation for functions, written in separate <code class="language-plaintext highlighter-rouge">.Rd</code>
files, gets turned into the documentation you see in help
files. The <a href="http://cran.r-project.org/web/packages/roxygen2/vignettes/rd.html">roxygen2</a> package allows R coders to write documentation
alongside the function code and then process it into the appropriate <code class="language-plaintext highlighter-rouge">.Rd</code>
files. You will want to switch to this more formal method of writing
documentation when you start writing more complicated R projects.</p>

  <p>Formal automated tests can be written using the <a href="http://r-pkgs.had.co.nz/tests.html">testthat</a> package.</p>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">function</code> to define a new function in R.</p>
</li>
    
    <li><p>Use parameters to pass values into functions.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">stopifnot()</code> to flexibly check function arguments in R.</p>
</li>
    
    <li><p>Load functions into programs using <code class="language-plaintext highlighter-rouge">source()</code>.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="writing-data" class="maintitle">Writing Data</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 10 min
      <br />
      <strong>Exercises:</strong> 10 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I save plots and data created in R?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>To be able to write out plots and data from R.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="saving-plots">Saving plots</h2>

<p>You have already seen how to save the most recent plot you create in <code class="language-plaintext highlighter-rouge">ggplot2</code>,
using the command <code class="language-plaintext highlighter-rouge">ggsave</code>. As a refresher:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggsave</span><span class="p">(</span><span class="s2">"My_most_recent_plot.pdf"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>You can save a plot from within RStudio using the ‘Export’ button
in the ‘Plot’ window. This will give you the option of saving as a
.pdf or as .png, .jpg or other image formats.</p>

<p>Sometimes you will want to save plots without creating them in the
‘Plot’ window first. Perhaps you want to make a pdf document with
multiple pages: each one a different plot, for example. Or perhaps
you’re looping through multiple subsets of a file, plotting data from
each subset, and you want to save each plot, but obviously can’t stop
the loop to click ‘Export’ for each one.</p>

<p>In this case you can use a more flexible approach. The function
<code class="language-plaintext highlighter-rouge">pdf</code> creates a new pdf device. You can control the size and resolution
using the arguments to this function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pdf</span><span class="p">(</span><span class="s2">"Life_Exp_vs_time.pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">

</span><span class="c1"># You then have to make sure to turn off the pdf device!</span><span class="w">

</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p>Open up this document and have a look.</p>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Rewrite your ‘pdf’ command to print a second
page in the pdf, showing a facet plot (hint: use <code class="language-plaintext highlighter-rouge">facet_grid</code>)
of the same data with one panel per continent.</p>
  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to challenge 1</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pdf</span><span class="p">(</span><span class="s2">"Life_Exp_vs_time.pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_grid</span><span class="p">(</span><span class="o">~</span><span class="n">continent</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<p>The commands <code class="language-plaintext highlighter-rouge">jpeg</code>, <code class="language-plaintext highlighter-rouge">png</code> etc. are used similarly to produce
documents in different formats.</p>

<h2 id="writing-data">Writing data</h2>

<p>At some point, you’ll also want to write out data from R.</p>

<p>We can use the <code class="language-plaintext highlighter-rouge">write.table</code> function for this, which is
very similar to <code class="language-plaintext highlighter-rouge">read.table</code> from before.</p>

<p>Let’s create a data-cleaning script, for this analysis, we
only want to focus on the gapminder data for Australia:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">aust_subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Australia"</span><span class="p">,]</span><span class="w">

</span><span class="n">write.table</span><span class="p">(</span><span class="n">aust_subset</span><span class="p">,</span><span class="w">
  </span><span class="n">file</span><span class="o">=</span><span class="s2">"cleaned-data/gapminder-aus.csv"</span><span class="p">,</span><span class="w">
  </span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Let’s switch back to the shell to take a look at the data to make sure it looks
OK:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">head </span>cleaned-data/gapminder-aus.csv
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"country","year","pop","continent","lifeExp","gdpPercap"
"61","Australia",1952,8691212,"Oceania",69.12,10039.59564
"62","Australia",1957,9712569,"Oceania",70.33,10949.64959
"63","Australia",1962,10794968,"Oceania",70.93,12217.22686
"64","Australia",1967,11872264,"Oceania",71.1,14526.12465
"65","Australia",1972,13177000,"Oceania",71.93,16788.62948
"66","Australia",1977,14074100,"Oceania",73.49,18334.19751
"67","Australia",1982,15184200,"Oceania",74.74,19477.00928
"68","Australia",1987,16257249,"Oceania",76.32,21888.88903
"69","Australia",1992,17481977,"Oceania",77.56,23424.76683
</code></pre></div></div>

<p>Hmm, that’s not quite what we wanted. Where did all these
quotation marks come from? Also the row numbers are
meaningless.</p>

<p>Let’s look at the help file to work out how to change this
behaviour.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">write.table</span><span class="w">
</span></code></pre></div></div>

<p>By default R will wrap character vectors with quotation marks
when writing out to file. It will also write out the row and
column names.</p>

<p>Let’s fix this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write.table</span><span class="p">(</span><span class="w">
  </span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Australia"</span><span class="p">,],</span><span class="w">
  </span><span class="n">file</span><span class="o">=</span><span class="s2">"cleaned-data/gapminder-aus.csv"</span><span class="p">,</span><span class="w">
  </span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="p">,</span><span class="w"> </span><span class="n">quote</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now lets look at the data again using our shell skills:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">head </span>cleaned-data/gapminder-aus.csv
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>country,year,pop,continent,lifeExp,gdpPercap
Australia,1952,8691212,Oceania,69.12,10039.59564
Australia,1957,9712569,Oceania,70.33,10949.64959
Australia,1962,10794968,Oceania,70.93,12217.22686
Australia,1967,11872264,Oceania,71.1,14526.12465
Australia,1972,13177000,Oceania,71.93,16788.62948
Australia,1977,14074100,Oceania,73.49,18334.19751
Australia,1982,15184200,Oceania,74.74,19477.00928
Australia,1987,16257249,Oceania,76.32,21888.88903
Australia,1992,17481977,Oceania,77.56,23424.76683
</code></pre></div></div>

<p>That looks better!</p>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>Write a data-cleaning script file that subsets the gapminder
data to include only data points collected since 1990.</p>

  <p>Use this script to write out the new subset to a file
in the <code class="language-plaintext highlighter-rouge">cleaned-data/</code> directory.</p>
  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to challenge 2</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write.table</span><span class="p">(</span><span class="w">
  </span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1990</span><span class="p">,</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cleaned-data/gapminder-after1990.csv"</span><span class="p">,</span><span class="w">
  </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">","</span><span class="p">,</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Save plots from RStudio using the ‘Export’ button.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">write.table</code> to save tabular data.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="splitting-and-combining-data-frames-with-plyr" class="maintitle">Splitting and Combining Data Frames with plyr</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 30 min
      <br />
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I do different calculations on different sets of data?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>To be able to use the split-apply-combine strategy for data analysis.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>Previously we looked at how you can use functions to simplify your code.
We defined the <code class="language-plaintext highlighter-rouge">calcGDP</code> function, which takes the gapminder dataset,
and multiplies the population and GDP per capita column. We also defined
additional arguments so we could filter by <code class="language-plaintext highlighter-rouge">year</code> and <code class="language-plaintext highlighter-rouge">country</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Takes a dataset and multiplies the population column</span><span class="w">
</span><span class="c1"># with the GDP per capita column.</span><span class="w">
</span><span class="n">calcGDP</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">year</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="p">[</span><span class="n">dat</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="p">[</span><span class="n">dat</span><span class="o">$</span><span class="n">country</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">country</span><span class="p">,]</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">gdp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">pop</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dat</span><span class="o">$</span><span class="n">gdpPercap</span><span class="w">

  </span><span class="n">new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="w"> </span><span class="n">gdp</span><span class="o">=</span><span class="n">gdp</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">new</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A common task you’ll encounter when working with data, is that you’ll want to
run calculations on different groups within the data. In the above, we were
calculating the GDP by multiplying two columns together. But what if we wanted
to calculated the mean GDP per continent?</p>

<p>We could run <code class="language-plaintext highlighter-rouge">calcGDP</code> and then take the mean of each continent:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">withGDP</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">calcGDP</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span><span class="n">mean</span><span class="p">(</span><span class="n">withGDP</span><span class="p">[</span><span class="n">withGDP</span><span class="o">$</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gdp"</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 20904782844
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean</span><span class="p">(</span><span class="n">withGDP</span><span class="p">[</span><span class="n">withGDP</span><span class="o">$</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Americas"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gdp"</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 379262350210
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean</span><span class="p">(</span><span class="n">withGDP</span><span class="p">[</span><span class="n">withGDP</span><span class="o">$</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gdp"</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 227233738153
</code></pre></div></div>

<p>But this isn’t very <em>nice</em>. Yes, by using a function, you have reduced a
substantial amount of repetition. That <strong>is</strong> nice. But there is still
repetition. Repeating yourself will cost you time, both now and later, and
potentially introduce some nasty bugs.</p>

<p>We could write a new function that is flexible like <code class="language-plaintext highlighter-rouge">calcGDP</code>, but this
also takes a substantial amount of effort and testing to get right.</p>

<p>The abstract problem we’re encountering here is know as “split-apply-combine”:</p>

<p><img src="../fig/12-plyr-fig1.png" alt="Split apply combine" /></p>

<p>We want to <em>split</em> our data into groups, in this case continents, <em>apply</em>
some calculations on that group, then optionally <em>combine</em> the results
together afterwards.</p>

<h2 id="the-plyr-package">The <code class="language-plaintext highlighter-rouge">plyr</code> package</h2>

<p>For those of you who have used R before, you might be familiar with the
<code class="language-plaintext highlighter-rouge">apply</code> family of functions. While R’s built in functions do work, we’re
going to introduce you to another method for solving the “split-apply-combine”
problem. The <a href="http://had.co.nz/plyr/">plyr</a> package provides a set of
functions that we find more user friendly for solving this problem.</p>

<p>We installed this package in an earlier challenge. Let us load it now:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"plyr"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Plyr has functions for operating on <code class="language-plaintext highlighter-rouge">lists</code>, <code class="language-plaintext highlighter-rouge">data.frames</code> and <code class="language-plaintext highlighter-rouge">arrays</code>
(matrices, or n-dimensional vectors). Each function performs:</p>

<ol>
  <li>A <strong>split</strong>ting operation</li>
  <li><strong>Apply</strong> a function on each split in turn.</li>
  <li>Re<strong>combine</strong> output data as a single data object.</li>
</ol>

<p>The functions are named based on the data structure they expect as input,
and the data structure you want returned as output: [a]rray, [l]ist, or
[d]ata.frame. The first letter corresponds to the input data structure,
the second letter to the output data structure, and then the rest of the
function is named “ply”.</p>

<p>This gives us 9 core functions **ply.  There are an additional three functions
which will only perform the split and apply steps, and not any combine step.
They’re named by their input data type and represent null output by a <code class="language-plaintext highlighter-rouge">_</code> (see
table)</p>

<p>Note here that plyr’s use of “array” is different to R’s,
an array in ply can include a vector or matrix.</p>

<p><img src="../fig/12-plyr-fig2.png" alt="Full apply suite" /></p>

<p>Each of the xxply functions (<code class="language-plaintext highlighter-rouge">daply</code>, <code class="language-plaintext highlighter-rouge">ddply</code>, <code class="language-plaintext highlighter-rouge">llply</code>, <code class="language-plaintext highlighter-rouge">laply</code>, …) has the
same structure and has 4 key features and structure:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xxply</span><span class="p">(</span><span class="n">.data</span><span class="p">,</span><span class="w"> </span><span class="n">.variables</span><span class="p">,</span><span class="w"> </span><span class="n">.fun</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>The first letter of the function name gives the input type and the second gives the output type.</li>
  <li>.data - gives the data object to be processed</li>
  <li>.variables - identifies the splitting variables</li>
  <li>.fun - gives the function to be called on each piece</li>
</ul>

<p>Now we can quickly calculate the mean GDP per continent:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ddply</span><span class="p">(</span><span class="w">
 </span><span class="n">.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calcGDP</span><span class="p">(</span><span class="n">gapminder</span><span class="p">),</span><span class="w">
 </span><span class="n">.variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"continent"</span><span class="p">,</span><span class="w">
 </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">gdp</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  continent           V1
1    Africa  20904782844
2  Americas 379262350210
3      Asia 227233738153
4    Europe 269442085301
5   Oceania 188187105354
</code></pre></div></div>

<p>Let us walk through the previous code:</p>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">ddply</code> function feeds in a <code class="language-plaintext highlighter-rouge">data.frame</code> (function starts with <strong>d</strong>) and
returns another <code class="language-plaintext highlighter-rouge">data.frame</code> (2nd letter is a <strong>d</strong>)</li>
  <li>the first argument we gave was the data.frame we wanted to operate on: in this
case the gapminder data. We called <code class="language-plaintext highlighter-rouge">calcGDP</code> on it first so that it would have
the additional <code class="language-plaintext highlighter-rouge">gdp</code> column added to it.</li>
  <li>The second argument indicated our split criteria: in this case the “continent”
column. Note that we gave the name of the column, not the values of the column like we had done previously with subsetting. Plyr takes care of these
implementation details for you.</li>
  <li>The third argument is the function we want to apply to each grouping of the
data. We had to define our own short function here: each subset of the data
gets stored in <code class="language-plaintext highlighter-rouge">x</code>, the first argument of our function. This is an anonymous
function: we haven’t defined it elsewhere, and it has no name. It only exists
in the scope of our call to <code class="language-plaintext highlighter-rouge">ddply</code>.</li>
</ul>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Calculate the average life expectancy per continent. Which has the longest?
Which had the shortest?</p>
  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to Challenge 1</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ddply</span><span class="p">(</span><span class="w">
 </span><span class="n">.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w">
 </span><span class="n">.variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"continent"</span><span class="p">,</span><span class="w">
 </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">lifeExp</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
    <p>Oceania has the longest and Africa the shortest.</p>
  </blockquote>
</blockquote>

<p>What if we want a different type of output data structure?:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dlply</span><span class="p">(</span><span class="w">
 </span><span class="n">.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calcGDP</span><span class="p">(</span><span class="n">gapminder</span><span class="p">),</span><span class="w">
 </span><span class="n">.variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"continent"</span><span class="p">,</span><span class="w">
 </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">gdp</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$Africa
[1] 20904782844

$Americas
[1] 379262350210

$Asia
[1] 227233738153

$Europe
[1] 269442085301

$Oceania
[1] 188187105354

attr(,"split_type")
[1] "data.frame"
attr(,"split_labels")
  continent
1    Africa
2  Americas
3      Asia
4    Europe
5   Oceania
</code></pre></div></div>

<p>We called the same function again, but changed the second letter to an <code class="language-plaintext highlighter-rouge">l</code>, so
the output was returned as a list.</p>

<p>We can specify multiple columns to group by:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ddply</span><span class="p">(</span><span class="w">
 </span><span class="n">.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calcGDP</span><span class="p">(</span><span class="n">gapminder</span><span class="p">),</span><span class="w">
 </span><span class="n">.variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"continent"</span><span class="p">,</span><span class="w"> </span><span class="s2">"year"</span><span class="p">),</span><span class="w">
 </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">gdp</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   continent year           V1
1     Africa 1952   5992294608
2     Africa 1957   7359188796
3     Africa 1962   8784876958
4     Africa 1967  11443994101
5     Africa 1972  15072241974
6     Africa 1977  18694898732
7     Africa 1982  22040401045
8     Africa 1987  24107264108
9     Africa 1992  26256977719
10    Africa 1997  30023173824
11    Africa 2002  35303511424
12    Africa 2007  45778570846
13  Americas 1952 117738997171
14  Americas 1957 140817061264
15  Americas 1962 169153069442
16  Americas 1967 217867530844
17  Americas 1972 268159178814
18  Americas 1977 324085389022
19  Americas 1982 363314008350
20  Americas 1987 439447790357
21  Americas 1992 489899820623
22  Americas 1997 582693307146
23  Americas 2002 661248623419
24  Americas 2007 776723426068
25      Asia 1952  34095762661
26      Asia 1957  47267432088
27      Asia 1962  60136869012
28      Asia 1967  84648519224
29      Asia 1972 124385747313
30      Asia 1977 159802590186
31      Asia 1982 194429049919
32      Asia 1987 241784763369
33      Asia 1992 307100497486
34      Asia 1997 387597655323
35      Asia 2002 458042336179
36      Asia 2007 627513635079
37    Europe 1952  84971341466
38    Europe 1957 109989505140
39    Europe 1962 138984693095
40    Europe 1967 173366641137
41    Europe 1972 218691462733
42    Europe 1977 255367522034
43    Europe 1982 279484077072
44    Europe 1987 316507473546
45    Europe 1992 342703247405
46    Europe 1997 383606933833
47    Europe 2002 436448815097
48    Europe 2007 493183311052
49   Oceania 1952  54157223944
50   Oceania 1957  66826828013
51   Oceania 1962  82336453245
52   Oceania 1967 105958863585
53   Oceania 1972 134112109227
54   Oceania 1977 154707711162
55   Oceania 1982 176177151380
56   Oceania 1987 209451563998
57   Oceania 1992 236319179826
58   Oceania 1997 289304255183
59   Oceania 2002 345236880176
60   Oceania 2007 403657044512
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">daply</span><span class="p">(</span><span class="w">
 </span><span class="n">.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calcGDP</span><span class="p">(</span><span class="n">gapminder</span><span class="p">),</span><span class="w">
 </span><span class="n">.variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"continent"</span><span class="p">,</span><span class="w"> </span><span class="s2">"year"</span><span class="p">),</span><span class="w">
 </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">gdp</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>          year
continent          1952         1957         1962         1967         1972
  Africa     5992294608   7359188796   8784876958  11443994101  15072241974
  Americas 117738997171 140817061264 169153069442 217867530844 268159178814
  Asia      34095762661  47267432088  60136869012  84648519224 124385747313
  Europe    84971341466 109989505140 138984693095 173366641137 218691462733
  Oceania   54157223944  66826828013  82336453245 105958863585 134112109227
          year
continent          1977         1982         1987         1992         1997
  Africa    18694898732  22040401045  24107264108  26256977719  30023173824
  Americas 324085389022 363314008350 439447790357 489899820623 582693307146
  Asia     159802590186 194429049919 241784763369 307100497486 387597655323
  Europe   255367522034 279484077072 316507473546 342703247405 383606933833
  Oceania  154707711162 176177151380 209451563998 236319179826 289304255183
          year
continent          2002         2007
  Africa    35303511424  45778570846
  Americas 661248623419 776723426068
  Asia     458042336179 627513635079
  Europe   436448815097 493183311052
  Oceania  345236880176 403657044512
</code></pre></div></div>

<p>You can use these functions in place of <code class="language-plaintext highlighter-rouge">for</code> loops (and it is usually faster to
do so).
To replace a for loop, put the code that was in the body of the <code class="language-plaintext highlighter-rouge">for</code> loop inside an anonymous function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d_ply</span><span class="p">(</span><span class="w">
  </span><span class="n">.data</span><span class="o">=</span><span class="n">gapminder</span><span class="p">,</span><span class="w">
  </span><span class="n">.variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"continent"</span><span class="p">,</span><span class="w">
  </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">meanGDPperCap</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">gdpPercap</span><span class="p">)</span><span class="w">
    </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="w">
      </span><span class="s2">"The mean GDP per capita for"</span><span class="p">,</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">continent</span><span class="p">),</span><span class="w">
      </span><span class="s2">"is"</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">(</span><span class="n">meanGDPperCap</span><span class="p">,</span><span class="w"> </span><span class="n">big.mark</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span><span class="w">
   </span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "The mean GDP per capita for Africa is 2,193.755"
[1] "The mean GDP per capita for Americas is 7,136.11"
[1] "The mean GDP per capita for Asia is 7,902.15"
[1] "The mean GDP per capita for Europe is 14,469.48"
[1] "The mean GDP per capita for Oceania is 18,621.61"
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="tip-printing-numbers">Tip: printing numbers</h2>

  <p>The <code class="language-plaintext highlighter-rouge">format</code> function can be used to make numeric
values “pretty” for printing out in messages.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>Calculate the average life expectancy per continent and year. Which had the
longest and shortest in 2007? Which had the greatest change in between 1952
and 2007?</p>
  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to Challenge 2</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">solution</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="w">
 </span><span class="n">.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w">
 </span><span class="n">.variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"continent"</span><span class="p">,</span><span class="w"> </span><span class="s2">"year"</span><span class="p">),</span><span class="w">
 </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">lifeExp</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">solution_2007</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">solution</span><span class="p">[</span><span class="n">solution</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2007</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">solution_2007</span><span class="w">
</span></code></pre></div>    </div>

    <p>Oceania had the longest average life expectancy in 2007 and Africa the lowest.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">solution_1952_2007</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="n">solution</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1952</span><span class="p">,</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">solution_2007</span><span class="p">)</span><span class="w">
</span><span class="n">difference_1952_2007</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">continent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solution_1952_2007</span><span class="o">$</span><span class="n">continent</span><span class="p">,</span><span class="w">
                                   </span><span class="n">year_1957</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solution_1952_2007</span><span class="p">[[</span><span class="m">3</span><span class="p">]],</span><span class="w">
                                   </span><span class="n">year_2007</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solution_1952_2007</span><span class="p">[[</span><span class="m">6</span><span class="p">]],</span><span class="w">
                                   </span><span class="n">difference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solution_1952_2007</span><span class="p">[[</span><span class="m">6</span><span class="p">]]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">solution_1952_2007</span><span class="p">[[</span><span class="m">3</span><span class="p">]])</span><span class="w">
</span><span class="n">difference_1952_2007</span><span class="w">
</span></code></pre></div>    </div>
    <p>Asia had the greatest difference, and Oceania the least.</p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="alternate-challenge">Alternate Challenge</h2>

  <p>Without running them, which of the following will calculate the average
life expectancy per continent:</p>

  <p>1.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ddply</span><span class="p">(</span><span class="w">
  </span><span class="n">.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w">
  </span><span class="n">.variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="o">$</span><span class="n">continent</span><span class="p">,</span><span class="w">
  </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dataGroup</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="n">mean</span><span class="p">(</span><span class="n">dataGroup</span><span class="o">$</span><span class="n">lifeExp</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <p>2.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ddply</span><span class="p">(</span><span class="w">
  </span><span class="n">.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w">
  </span><span class="n">.variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"continent"</span><span class="p">,</span><span class="w">
  </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">dataGroup</span><span class="o">$</span><span class="n">lifeExp</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <p>3.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ddply</span><span class="p">(</span><span class="w">
  </span><span class="n">.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w">
  </span><span class="n">.variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"continent"</span><span class="p">,</span><span class="w">
  </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dataGroup</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="n">mean</span><span class="p">(</span><span class="n">dataGroup</span><span class="o">$</span><span class="n">lifeExp</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <p>4.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">adply</span><span class="p">(</span><span class="w">
  </span><span class="n">.data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gapminder</span><span class="p">,</span><span class="w">
  </span><span class="n">.variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"continent"</span><span class="p">,</span><span class="w">
  </span><span class="n">.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dataGroup</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="n">mean</span><span class="p">(</span><span class="n">dataGroup</span><span class="o">$</span><span class="n">lifeExp</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>
  <blockquote class="solution">
    <h2 id="solution-to-alternative-challenge">Solution to Alternative Challenge</h2>

    <p>Answer 3 will calculate the average life expectancy per continent.</p>
  </blockquote>
</blockquote>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use the <code class="language-plaintext highlighter-rouge">plyr</code> package to split data, apply functions to subsets, and combine the results.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="data-frame-manipulation-with-dplyr" class="maintitle">Data frame Manipulation with dplyr</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 40 min
      <br />
      <strong>Exercises:</strong> 15 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I manipulate data frames without repeating myself?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>To be able to use the six main data frame manipulation ‘verbs’ with pipes in  <code class="language-plaintext highlighter-rouge">dplyr</code>.</p>
</li>
	
	<li><p>To understand how <code class="language-plaintext highlighter-rouge">group_by()</code> and <code class="language-plaintext highlighter-rouge">summarize()</code> can be combined to summarize datasets.</p>
</li>
	
	<li><p>Be able to analyze a subset of data using logical filtering.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>Manipulation of data frames means many things to many researchers, we often
select certain observations (rows) or variables (columns), we often group the
data by a certain variable(s), or we even calculate summary statistics. We can
do these operations using the normal base R operations:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean</span><span class="p">(</span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Africa"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gdpPercap"</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 2193.755
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean</span><span class="p">(</span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Americas"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gdpPercap"</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 7136.11
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean</span><span class="p">(</span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Asia"</span><span class="p">,</span><span class="w"> </span><span class="s2">"gdpPercap"</span><span class="p">])</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 7902.15
</code></pre></div></div>

<p>But this isn’t very <em>nice</em> because there is a fair bit of repetition. Repeating
yourself will cost you time, both now and later, and potentially introduce some
nasty bugs.</p>

<h2 id="the-dplyr-package">The <code class="language-plaintext highlighter-rouge">dplyr</code> package</h2>

<p>Luckily, the <a href="https://cran.r-project.org/package=dplyr"><code class="language-plaintext highlighter-rouge">dplyr</code></a>
package provides a number of very useful functions for manipulating data frames
in a way that will reduce the above repetition, reduce the probability of making
errors, and probably even save you some typing. As an added bonus, you might
even find the <code class="language-plaintext highlighter-rouge">dplyr</code> grammar easier to read.</p>

<p>Here we’re going to cover 5 of the most commonly used functions as well as using
pipes (<code class="language-plaintext highlighter-rouge">%&gt;%</code>) to combine them.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">select()</code></li>
  <li><code class="language-plaintext highlighter-rouge">filter()</code></li>
  <li><code class="language-plaintext highlighter-rouge">group_by()</code></li>
  <li><code class="language-plaintext highlighter-rouge">summarize()</code></li>
  <li><code class="language-plaintext highlighter-rouge">mutate()</code></li>
</ol>

<p>If you have have not installed this package earlier, please do so:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s1">'dplyr'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now let’s load the package:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="using-select">Using select()</h2>

<p>If, for example, we wanted to move forward with only a few of the variables in
our data frame we could use the <code class="language-plaintext highlighter-rouge">select()</code> function. This will keep only the
variables you select.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">year_country_gdp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/13-dplyr-fig1.png" alt="Diagram illustrating use of select function to select two columns of a data frame" />
If we want to remove one column only from the <code class="language-plaintext highlighter-rouge">gapminder</code> data, for example,
removing the <code class="language-plaintext highlighter-rouge">continent</code> column.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">smaller_gapminder_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">gapminder</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">continent</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>If we open up <code class="language-plaintext highlighter-rouge">year_country_gdp</code> we’ll see that it only contains the year,
country and gdpPercap. Above we used ‘normal’ grammar, but the strengths of
<code class="language-plaintext highlighter-rouge">dplyr</code> lie in combining several functions using pipes. Since the pipes grammar
is unlike anything we’ve seen in R before, let’s repeat what we’ve done above
using pipes.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">year_country_gdp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>To help you understand why we wrote that in that way, let’s walk through it step
by step. First we summon the gapminder data frame and pass it on, using the pipe
symbol <code class="language-plaintext highlighter-rouge">%&gt;%</code>, to the next step, which is the <code class="language-plaintext highlighter-rouge">select()</code> function. In this case
we don’t specify which data object we use in the <code class="language-plaintext highlighter-rouge">select()</code> function since in
gets that from the previous pipe. <strong>Fun Fact</strong>: There is a good chance you have
encountered pipes before in the shell. In R, a pipe symbol is <code class="language-plaintext highlighter-rouge">%&gt;%</code> while in the
shell it is <code class="language-plaintext highlighter-rouge">|</code> but the concept is the same!</p>

<blockquote class="callout">
  <h2 id="tip-renaming-data-frame-columns-in-dplyr">Tip: Renaming data frame columns in dplyr</h2>

  <p>In Chapter 4 we covered how you can rename columns with base R by assigning a value to the output of the <code class="language-plaintext highlighter-rouge">names()</code> function.
Just like select, this is a bit cumbersome, but thankfully dplyr has a <code class="language-plaintext highlighter-rouge">rename()</code> function.</p>

  <p>Within a pipeline, the syntax is <code class="language-plaintext highlighter-rouge">rename(new_name = old_name)</code>.
For example, we may want to rename the gdpPercap column name from our <code class="language-plaintext highlighter-rouge">select()</code> statement above.</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tidy_gdp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">year_country_gdp</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">rename</span><span class="p">(</span><span class="n">gdp_per_capita</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">)</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">tidy_gdp</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  year     country gdp_per_capita
1 1952 Afghanistan       779.4453
2 1957 Afghanistan       820.8530
3 1962 Afghanistan       853.1007
4 1967 Afghanistan       836.1971
5 1972 Afghanistan       739.9811
6 1977 Afghanistan       786.1134
</code></pre></div>  </div>
</blockquote>

<h2 id="using-filter">Using filter()</h2>

<p>If we now want to move forward with the above, but only with European
countries, we can combine <code class="language-plaintext highlighter-rouge">select</code> and <code class="language-plaintext highlighter-rouge">filter</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">year_country_gdp_euro</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Europe"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>If we now want to show life expectancy of European countries but only
for a specific year (e.g., 2007), we can do as below.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">europe_lifeExp_2007</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Europe"</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2007</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Write a single command (which can span multiple lines and includes pipes) that
will produce a data frame that has the African values for <code class="language-plaintext highlighter-rouge">lifeExp</code>, <code class="language-plaintext highlighter-rouge">country</code>
and <code class="language-plaintext highlighter-rouge">year</code>, but not for other Continents.  How many rows does your data frame
have and why?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to Challenge 1</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">year_country_lifeExp_Africa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
                           </span><span class="n">filter</span><span class="p">(</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Africa"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
                           </span><span class="n">select</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<p>As with last time, first we pass the gapminder data frame to the <code class="language-plaintext highlighter-rouge">filter()</code>
function, then we pass the filtered version of the gapminder data frame to the
<code class="language-plaintext highlighter-rouge">select()</code> function. <strong>Note:</strong> The order of operations is very important in this
case. If we used ‘select’ first, filter would not be able to find the variable
continent since we would have removed it in the previous step.</p>

<h2 id="using-group_by">Using group_by()</h2>

<p>Now, we were supposed to be reducing the error prone repetitiveness of what can
be done with base R, but up to now we haven’t done that since we would have to
repeat the above for each continent. Instead of <code class="language-plaintext highlighter-rouge">filter()</code>, which will only pass
observations that meet your criteria (in the above: <code class="language-plaintext highlighter-rouge">continent=="Europe"</code>), we
can use <code class="language-plaintext highlighter-rouge">group_by()</code>, which will essentially use every unique criteria that you
could have used in filter.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>grouped_df [1,704 × 6] (S3: grouped_df/tbl_df/tbl/data.frame)
 $ country  : chr [1:1704] "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num [1:1704] 8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr [1:1704] "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num [1:1704] 779 821 853 836 740 ...
 - attr(*, "groups")= tibble [5 × 2] (S3: tbl_df/tbl/data.frame)
  ..$ continent: chr [1:5] "Africa" "Americas" "Asia" "Europe" ...
  ..$ .rows    : list&lt;int&gt; [1:5] 
  .. ..$ : int [1:624] 25 26 27 28 29 30 31 32 33 34 ...
  .. ..$ : int [1:300] 49 50 51 52 53 54 55 56 57 58 ...
  .. ..$ : int [1:396] 1 2 3 4 5 6 7 8 9 10 ...
  .. ..$ : int [1:360] 13 14 15 16 17 18 19 20 21 22 ...
  .. ..$ : int [1:24] 61 62 63 64 65 66 67 68 69 70 ...
  .. ..@ ptype: int(0) 
  ..- attr(*, ".drop")= logi TRUE
</code></pre></div></div>
<p>You will notice that the structure of the data frame where we used <code class="language-plaintext highlighter-rouge">group_by()</code>
(<code class="language-plaintext highlighter-rouge">grouped_df</code>) is not the same as the original <code class="language-plaintext highlighter-rouge">gapminder</code> (<code class="language-plaintext highlighter-rouge">data.frame</code>). A
<code class="language-plaintext highlighter-rouge">grouped_df</code> can be thought of as a <code class="language-plaintext highlighter-rouge">list</code> where each item in the <code class="language-plaintext highlighter-rouge">list</code>is a
<code class="language-plaintext highlighter-rouge">data.frame</code> which contains only the rows that correspond to the a particular
value <code class="language-plaintext highlighter-rouge">continent</code> (at least in the example above).</p>

<p><img src="../fig/13-dplyr-fig2.png" alt="Diagram illustrating how the group by function oraganizes a data frame into groups" /></p>

<h2 id="using-summarize">Using summarize()</h2>

<p>The above was a bit on the uneventful side but <code class="language-plaintext highlighter-rouge">group_by()</code> is much more
exciting in conjunction with <code class="language-plaintext highlighter-rouge">summarize()</code>. This will allow us to create new
variable(s) by using functions that repeat for each of the continent-specific
data frames. That is to say, using the <code class="language-plaintext highlighter-rouge">group_by()</code> function, we split our
original data frame into multiple pieces, then we can run functions
(e.g. <code class="language-plaintext highlighter-rouge">mean()</code> or <code class="language-plaintext highlighter-rouge">sd()</code>) within <code class="language-plaintext highlighter-rouge">summarize()</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdp_bycontinents</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_gdpPercap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gdpPercap</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/13-dplyr-fig3.png" alt="Diagram illustrating the use of group by and summarize together to create a new variable" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">continent</span><span class="w"> </span><span class="n">mean_gdpPercap</span><span class="w">
     </span><span class="o">&lt;</span><span class="n">fctr</span><span class="o">&gt;</span><span class="w">          </span><span class="o">&lt;</span><span class="n">dbl</span><span class="o">&gt;</span><span class="w">
</span><span class="m">1</span><span class="w">    </span><span class="n">Africa</span><span class="w">       </span><span class="m">2193.755</span><span class="w">
</span><span class="m">2</span><span class="w">  </span><span class="n">Americas</span><span class="w">       </span><span class="m">7136.110</span><span class="w">
</span><span class="m">3</span><span class="w">      </span><span class="n">Asia</span><span class="w">       </span><span class="m">7902.150</span><span class="w">
</span><span class="m">4</span><span class="w">    </span><span class="n">Europe</span><span class="w">      </span><span class="m">14469.476</span><span class="w">
</span><span class="m">5</span><span class="w">   </span><span class="n">Oceania</span><span class="w">      </span><span class="m">18621.609</span><span class="w">
</span></code></pre></div></div>

<p>That allowed us to calculate the mean gdpPercap for each continent, but it gets
even better.</p>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>Calculate the average life expectancy per country. Which has the longest average life
expectancy and which has the shortest average life expectancy?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to Challenge 2</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lifeExp_bycountry</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_lifeExp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">))</span><span class="w">
</span><span class="n">lifeExp_bycountry</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">filter</span><span class="p">(</span><span class="n">mean_lifeExp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">mean_lifeExp</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mean_lifeExp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">mean_lifeExp</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 2 × 2
 country      mean_lifeExp
 &lt;chr&gt;               &lt;dbl&gt;
1 Iceland              76.5
2 Sierra Leone         36.8
</code></pre></div>    </div>
    <p>Another way to do this is to use the <code class="language-plaintext highlighter-rouge">dplyr</code> function <code class="language-plaintext highlighter-rouge">arrange()</code>, which
arranges the rows in a data frame according to the order of one or more
variables from the data frame.  It has similar syntax to other functions from
the <code class="language-plaintext highlighter-rouge">dplyr</code> package. You can use <code class="language-plaintext highlighter-rouge">desc()</code> inside <code class="language-plaintext highlighter-rouge">arrange()</code> to sort in
descending order.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lifeExp_bycountry</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">arrange</span><span class="p">(</span><span class="n">mean_lifeExp</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">head</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 1 × 2
 country      mean_lifeExp
 &lt;chr&gt;               &lt;dbl&gt;
1 Sierra Leone         36.8
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lifeExp_bycountry</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">mean_lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">head</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 1 × 2
 country mean_lifeExp
 &lt;chr&gt;          &lt;dbl&gt;
1 Iceland         76.5
</code></pre></div>    </div>
    <p>Alphabetical order works too</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lifeExp_bycountry</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">head</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 1 × 2
 country  mean_lifeExp
 &lt;chr&gt;           &lt;dbl&gt;
1 Zimbabwe         52.7
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<p>The function <code class="language-plaintext highlighter-rouge">group_by()</code> allows us to group by multiple variables. Let’s group by <code class="language-plaintext highlighter-rouge">year</code> and <code class="language-plaintext highlighter-rouge">continent</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdp_bycontinents_byyear</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_gdpPercap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gdpPercap</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` has grouped output by 'continent'. You can override using the `.groups` argument.
</code></pre></div></div>

<p>That is already quite powerful, but it gets even better! You’re not limited to defining 1 new variable in <code class="language-plaintext highlighter-rouge">summarize()</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdp_pop_bycontinents_byyear</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_gdpPercap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gdpPercap</span><span class="p">),</span><span class="w">
              </span><span class="n">sd_gdpPercap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">gdpPercap</span><span class="p">),</span><span class="w">
              </span><span class="n">mean_pop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">pop</span><span class="p">),</span><span class="w">
              </span><span class="n">sd_pop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">pop</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` has grouped output by 'continent'. You can override using the `.groups` argument.
</code></pre></div></div>

<h2 id="count-and-n">count() and n()</h2>

<p>A very common operation is to count the number of observations for each
group. The <code class="language-plaintext highlighter-rouge">dplyr</code> package comes with two related functions that help with this.</p>

<p>For instance, if we wanted to check the number of countries included in the
dataset for the year 2002, we can use the <code class="language-plaintext highlighter-rouge">count()</code> function. It takes the name
of one or more columns that contain the groups we are interested in, and we can
optionally sort the results in descending order by adding <code class="language-plaintext highlighter-rouge">sort=TRUE</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2002</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  continent  n
1    Africa 52
2      Asia 33
3    Europe 30
4  Americas 25
5   Oceania  2
</code></pre></div></div>

<p>If we need to use the number of observations in calculations, the <code class="language-plaintext highlighter-rouge">n()</code> function
is useful. It will return the total number of observations in the current group rather than counting the number of observations in each group within a specific column. For instance, if we wanted to get the standard error of the life expectency per continent:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">se_le</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">)</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">()))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 5 × 2
  continent se_le
  &lt;chr&gt;     &lt;dbl&gt;
1 Africa    0.366
2 Americas  0.540
3 Asia      0.596
4 Europe    0.286
5 Oceania   0.775
</code></pre></div></div>

<p>You can also chain together several summary operations; in this case calculating the <code class="language-plaintext highlighter-rouge">minimum</code>, <code class="language-plaintext highlighter-rouge">maximum</code>, <code class="language-plaintext highlighter-rouge">mean</code> and <code class="language-plaintext highlighter-rouge">se</code> of each continent’s per-country life-expectancy:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="w">
      </span><span class="n">mean_le</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">),</span><span class="w">
      </span><span class="n">min_le</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">),</span><span class="w">
      </span><span class="n">max_le</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">),</span><span class="w">
      </span><span class="n">se_le</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">)</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">()))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 5 × 5
  continent mean_le min_le max_le se_le
  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Africa       48.9   23.6   76.4 0.366
2 Americas     64.7   37.6   80.7 0.540
3 Asia         60.1   28.8   82.6 0.596
4 Europe       71.9   43.6   81.8 0.286
5 Oceania      74.3   69.1   81.2 0.775
</code></pre></div></div>

<h2 id="using-mutate">Using mutate()</h2>

<p>We can also create new variables prior to (or even after) summarizing information using <code class="language-plaintext highlighter-rouge">mutate()</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdp_pop_bycontinents_byyear</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">gdp_billion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gdpPercap</span><span class="o">*</span><span class="n">pop</span><span class="o">/</span><span class="m">10</span><span class="o">^</span><span class="m">9</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_gdpPercap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gdpPercap</span><span class="p">),</span><span class="w">
              </span><span class="n">sd_gdpPercap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">gdpPercap</span><span class="p">),</span><span class="w">
              </span><span class="n">mean_pop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">pop</span><span class="p">),</span><span class="w">
              </span><span class="n">sd_pop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">pop</span><span class="p">),</span><span class="w">
              </span><span class="n">mean_gdp_billion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gdp_billion</span><span class="p">),</span><span class="w">
              </span><span class="n">sd_gdp_billion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">gdp_billion</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` has grouped output by 'continent'. You can override using the `.groups` argument.
</code></pre></div></div>

<h2 id="connect-mutate-with-logical-filtering-ifelse">Connect mutate with logical filtering: ifelse</h2>

<p>When creating new variables, we can hook this with a logical condition. A simple combination of
<code class="language-plaintext highlighter-rouge">mutate()</code> and <code class="language-plaintext highlighter-rouge">ifelse()</code> facilitates filtering right where it is needed: in the moment of creating something new.
This easy-to-read statement is a fast and powerful way of discarding certain data (even though the overall dimension
of the data frame will not change) or for updating values depending on this given condition.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## keeping all data but "filtering" after a certain condition</span><span class="w">
</span><span class="c1"># calculate GDP only for people with a life expectation above 25</span><span class="w">
</span><span class="n">gdp_pop_bycontinents_byyear_above25</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">gdp_billion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">lifeExp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="n">gdpPercap</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">10</span><span class="o">^</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_gdpPercap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gdpPercap</span><span class="p">),</span><span class="w">
              </span><span class="n">sd_gdpPercap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">gdpPercap</span><span class="p">),</span><span class="w">
              </span><span class="n">mean_pop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">pop</span><span class="p">),</span><span class="w">
              </span><span class="n">sd_pop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">pop</span><span class="p">),</span><span class="w">
              </span><span class="n">mean_gdp_billion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gdp_billion</span><span class="p">),</span><span class="w">
              </span><span class="n">sd_gdp_billion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">gdp_billion</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` has grouped output by 'continent'. You can override using the `.groups` argument.
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## updating only if certain condition is fullfilled</span><span class="w">
</span><span class="c1"># for life expectations above 40 years, the gpd to be expected in the future is scaled</span><span class="w">
</span><span class="n">gdp_future_bycontinents_byyear_high_lifeExp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">gdp_futureExpectation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">lifeExp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="n">gdpPercap</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">gdpPercap</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_gdpPercap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gdpPercap</span><span class="p">),</span><span class="w">
              </span><span class="n">mean_gdpPercap_expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">gdp_futureExpectation</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` has grouped output by 'continent'. You can override using the `.groups` argument.
</code></pre></div></div>

<h2 id="combining-dplyr-and-ggplot2">Combining <code class="language-plaintext highlighter-rouge">dplyr</code> and <code class="language-plaintext highlighter-rouge">ggplot2</code></h2>

<p>First install and load ggplot2:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s1">'ggplot2'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>In the plotting lesson we looked at how to make a multi-panel figure by adding
a layer of facet panels using <code class="language-plaintext highlighter-rouge">ggplot2</code>. Here is the code we used (with some
extra comments):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Filter countries located in the Americas</span><span class="w">
</span><span class="n">americas</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="p">[</span><span class="n">gapminder</span><span class="o">$</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Americas"</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="c1"># Make the plot</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">americas</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-13-unnamed-chunk-27-1.png" title="plot of chunk unnamed-chunk-27" alt="plot of chunk unnamed-chunk-27" width="612" style="display: block; margin: auto;" /></p>

<p>This code makes the right plot but it also creates an intermediate variable
(<code class="language-plaintext highlighter-rouge">americas</code>) that we might not have any other uses for. Just as we used
<code class="language-plaintext highlighter-rouge">%&gt;%</code> to pipe data along a chain of <code class="language-plaintext highlighter-rouge">dplyr</code> functions we can use it to pass data
to <code class="language-plaintext highlighter-rouge">ggplot()</code>. Because <code class="language-plaintext highlighter-rouge">%&gt;%</code> replaces the first argument in a function we don’t
need to specify the <code class="language-plaintext highlighter-rouge">data =</code> argument in the <code class="language-plaintext highlighter-rouge">ggplot()</code> function. By combining
<code class="language-plaintext highlighter-rouge">dplyr</code> and <code class="language-plaintext highlighter-rouge">ggplot2</code> functions we can make the same figure without creating any
new variables or modifying the data.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Filter countries located in the Americas</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">continent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Americas"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># Make the plot</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-13-unnamed-chunk-28-1.png" title="plot of chunk unnamed-chunk-28" alt="plot of chunk unnamed-chunk-28" width="612" style="display: block; margin: auto;" /></p>

<p>More examples of using the function <code class="language-plaintext highlighter-rouge">mutate()</code> and the <code class="language-plaintext highlighter-rouge">ggplot2</code> package.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># extract first letter of country name into new column</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">startsWith</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">substr</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># only keep countries starting with A or Z</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">startsWith</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Z"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># plot lifeExp into facets</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">continent</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">vars</span><span class="p">(</span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-13-unnamed-chunk-29-1.png" title="plot of chunk unnamed-chunk-29" alt="plot of chunk unnamed-chunk-29" width="612" style="display: block; margin: auto;" /></p>

<blockquote class="challenge">
  <h2 id="advanced-challenge">Advanced Challenge</h2>

  <p>Calculate the average life expectancy in 2002 of 2 randomly selected countries
for each continent. Then arrange the continent names in reverse order.
<strong>Hint:</strong> Use the <code class="language-plaintext highlighter-rouge">dplyr</code> functions <code class="language-plaintext highlighter-rouge">arrange()</code> and <code class="language-plaintext highlighter-rouge">sample_n()</code>, they have
similar syntax to other dplyr functions.</p>

  <blockquote class="solution">
    <h2 id="solution-to-advanced-challenge">Solution to Advanced Challenge</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lifeExp_2countries_bycontinents</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">filter</span><span class="p">(</span><span class="n">year</span><span class="o">==</span><span class="m">2002</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">sample_n</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean_lifeExp</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">lifeExp</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">mean_lifeExp</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="other-great-resources">Other great resources</h2>

<ul>
  <li><a href="http://r4ds.had.co.nz/">R for Data Science</a></li>
  <li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling Cheat sheet</a></li>
  <li><a href="https://dplyr.tidyverse.org/">Introduction to dplyr</a></li>
  <li><a href="https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/">Data wrangling with R and RStudio</a></li>
</ul>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use the <code class="language-plaintext highlighter-rouge">dplyr</code> package to manipulate data frames.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">select()</code> to choose variables from a data frame.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">filter()</code> to choose data based on values.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">group_by()</code> and <code class="language-plaintext highlighter-rouge">summarize()</code> to work with subsets of data.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">mutate()</code> to create new variables.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="data-frame-manipulation-with-tidyr" class="maintitle">Data frame Manipulation with tidyr</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 30 min
      <br />
      <strong>Exercises:</strong> 15 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I change the layout of a data frame?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>To understand the concepts of ‘longer’ and ‘wider’ data frame formats and be able to convert between them with <code class="language-plaintext highlighter-rouge">tidyr</code>.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>Researchers often want to reshape their data frames from ‘wide’ to ‘longer’
layouts, or vice-versa. The ‘long’ layout or format is where:</p>

<ul>
  <li>each column is a variable</li>
  <li>each row is an observation</li>
</ul>

<p>In the purely ‘long’ (or ‘longest’) format, you usually have 1 column for the observed variable and the other columns are ID variables.</p>

<p>For the ‘wide’ format each row is often a site/subject/patient and you have
multiple observation variables containing the same type of data. These can be
either repeated observations over time, or observation of multiple variables (or
a mix of both). You may find data input may be simpler or some other
applications may prefer the ‘wide’ format. However, many of <code class="language-plaintext highlighter-rouge">R</code>’s functions have
been designed assuming you have ‘longer’ formatted data. This tutorial will help you
efficiently transform your data shape regardless of original format.</p>

<p><img src="../fig/14-tidyr-fig1.png" alt="Diagram illustrating the difference between a wide versus long layout of a data frame" /></p>

<p>Long and wide data frame layouts mainly affect readability. For humans, the wide format is often more intuitive since we can often see more of the data on the screen due
to its shape. However, the long format is more machine readable and is closer
to the formatting of databases. The ID variables in our data frames are similar to
the fields in a database and observed variables are like the database values.</p>

<h2 id="getting-started">Getting started</h2>

<p>First install the packages if you haven’t already done so (you probably
installed dplyr in the previous lesson):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#install.packages("tidyr")</span><span class="w">
</span><span class="c1">#install.packages("dplyr")</span><span class="w">
</span></code></pre></div></div>

<p>Load the packages</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"tidyr"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>First, lets look at the structure of our original gapminder data frame:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	1704 obs. of  6 variables:
 $ country  : chr  "Afghanistan" "Afghanistan" "Afghanistan" "Afghanistan" ...
 $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ pop      : num  8425333 9240934 10267083 11537966 13079460 ...
 $ continent: chr  "Asia" "Asia" "Asia" "Asia" ...
 $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
 $ gdpPercap: num  779 821 853 836 740 ...
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Is gapminder a purely long, purely wide, or some intermediate format?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to Challenge 1</h2>

    <p>The original gapminder data.frame is in an intermediate format. It is not
purely long since it had multiple observation variables
(<code class="language-plaintext highlighter-rouge">pop</code>,<code class="language-plaintext highlighter-rouge">lifeExp</code>,<code class="language-plaintext highlighter-rouge">gdpPercap</code>).</p>
  </blockquote>
</blockquote>

<p>Sometimes, as with the gapminder dataset, we have multiple types of observed
data. It is somewhere in between the purely ‘long’ and ‘wide’ data formats. We
have 3 “ID variables” (<code class="language-plaintext highlighter-rouge">continent</code>, <code class="language-plaintext highlighter-rouge">country</code>, <code class="language-plaintext highlighter-rouge">year</code>) and 3 “Observation
variables” (<code class="language-plaintext highlighter-rouge">pop</code>,<code class="language-plaintext highlighter-rouge">lifeExp</code>,<code class="language-plaintext highlighter-rouge">gdpPercap</code>). This intermediate format can be
preferred despite not having ALL observations in 1 column given that all 3
observation variables have different units. There are few operations that would
need us to make this data frame any longer (i.e. 4 ID variables and 1
Observation variable).</p>

<p>While using many of the functions in R, which are often vector based, you
usually do not want to do mathematical operations on values with different
units. For example, using the purely long format, a single mean for all of the
values of population, life expectancy, and GDP would not be meaningful since it
would return the mean of values with 3 incompatible units. The solution is that
we first manipulate the data either by grouping (see the lesson on <code class="language-plaintext highlighter-rouge">dplyr</code>), or
we change the structure of the data frame.  <strong>Note:</strong> Some plotting functions in
R actually work better in the wide format data.</p>

<h2 id="from-wide-to-long-format-with-pivot_longer">From wide to long format with pivot_longer()</h2>

<p>Until now, we’ve been using the nicely formatted original gapminder dataset, but
‘real’ data (i.e. our own research data) will never be so well organized. Here
let’s start with the wide formatted version of the gapminder dataset.</p>

<blockquote>
  <p>Download the wide version of the gapminder data from <a href="https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/_episodes_rmd/data/gapminder_wide.csv">here</a>
and save it in your data folder.</p>
</blockquote>

<p>We’ll load the data file and look at it. Note: we don’t want our continent and
country columns to be factors, so we use the stringsAsFactors argument for
<code class="language-plaintext highlighter-rouge">read.csv()</code> to disable that.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/gapminder_wide.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">gap_wide</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	142 obs. of  38 variables:
 $ continent     : chr  "Africa" "Africa" "Africa" "Africa" ...
 $ country       : chr  "Algeria" "Angola" "Benin" "Botswana" ...
 $ gdpPercap_1952: num  2449 3521 1063 851 543 ...
 $ gdpPercap_1957: num  3014 3828 960 918 617 ...
 $ gdpPercap_1962: num  2551 4269 949 984 723 ...
 $ gdpPercap_1967: num  3247 5523 1036 1215 795 ...
 $ gdpPercap_1972: num  4183 5473 1086 2264 855 ...
 $ gdpPercap_1977: num  4910 3009 1029 3215 743 ...
 $ gdpPercap_1982: num  5745 2757 1278 4551 807 ...
 $ gdpPercap_1987: num  5681 2430 1226 6206 912 ...
 $ gdpPercap_1992: num  5023 2628 1191 7954 932 ...
 $ gdpPercap_1997: num  4797 2277 1233 8647 946 ...
 $ gdpPercap_2002: num  5288 2773 1373 11004 1038 ...
 $ gdpPercap_2007: num  6223 4797 1441 12570 1217 ...
 $ lifeExp_1952  : num  43.1 30 38.2 47.6 32 ...
 $ lifeExp_1957  : num  45.7 32 40.4 49.6 34.9 ...
 $ lifeExp_1962  : num  48.3 34 42.6 51.5 37.8 ...
 $ lifeExp_1967  : num  51.4 36 44.9 53.3 40.7 ...
 $ lifeExp_1972  : num  54.5 37.9 47 56 43.6 ...
 $ lifeExp_1977  : num  58 39.5 49.2 59.3 46.1 ...
 $ lifeExp_1982  : num  61.4 39.9 50.9 61.5 48.1 ...
 $ lifeExp_1987  : num  65.8 39.9 52.3 63.6 49.6 ...
 $ lifeExp_1992  : num  67.7 40.6 53.9 62.7 50.3 ...
 $ lifeExp_1997  : num  69.2 41 54.8 52.6 50.3 ...
 $ lifeExp_2002  : num  71 41 54.4 46.6 50.6 ...
 $ lifeExp_2007  : num  72.3 42.7 56.7 50.7 52.3 ...
 $ pop_1952      : num  9279525 4232095 1738315 442308 4469979 ...
 $ pop_1957      : num  10270856 4561361 1925173 474639 4713416 ...
 $ pop_1962      : num  11000948 4826015 2151895 512764 4919632 ...
 $ pop_1967      : num  12760499 5247469 2427334 553541 5127935 ...
 $ pop_1972      : num  14760787 5894858 2761407 619351 5433886 ...
 $ pop_1977      : num  17152804 6162675 3168267 781472 5889574 ...
 $ pop_1982      : num  20033753 7016384 3641603 970347 6634596 ...
 $ pop_1987      : num  23254956 7874230 4243788 1151184 7586551 ...
 $ pop_1992      : num  26298373 8735988 4981671 1342614 8878303 ...
 $ pop_1997      : num  29072015 9875024 6066080 1536536 10352843 ...
 $ pop_2002      : int  31287142 10866106 7026113 1630347 12251209 7021078 15929988 4048013 8835739 614382 ...
 $ pop_2007      : int  33333216 12420476 8078314 1639131 14326203 8390505 17696293 4369038 10238807 710960 ...
</code></pre></div></div>

<p><img src="../fig/14-tidyr-fig2.png" alt="Diagram illustrating the wide format of the gapminder data frame" /></p>

<p>To change this very wide data frame layout back to our nice, intermediate (or longer) layout, we will use one of the two available <code class="language-plaintext highlighter-rouge">pivot</code>  functions from the <code class="language-plaintext highlighter-rouge">tidyr</code> package. To convert from wide to a longer format, we will use the <code class="language-plaintext highlighter-rouge">pivot_longer()</code> function. <code class="language-plaintext highlighter-rouge">pivot_longer()</code> makes datasets longer by increasing the number of rows and decreasing the number of columns, or ‘lengthening’ your observation variables into a single variable.</p>

<p><img src="../fig/14-tidyr-fig3.png" alt="Diagram illustrating how pivot longer reorganizes a data frame from a wide to long format" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap_wide</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_longer</span><span class="p">(</span><span class="w">
    </span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">starts_with</span><span class="p">(</span><span class="s1">'pop'</span><span class="p">),</span><span class="w"> </span><span class="n">starts_with</span><span class="p">(</span><span class="s1">'lifeExp'</span><span class="p">),</span><span class="w"> </span><span class="n">starts_with</span><span class="p">(</span><span class="s1">'gdpPercap'</span><span class="p">)),</span><span class="w">
    </span><span class="n">names_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"obstype_year"</span><span class="p">,</span><span class="w"> </span><span class="n">values_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"obs_values"</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">gap_long</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tibble [5,112 × 4] (S3: tbl_df/tbl/data.frame)
 $ continent   : chr [1:5112] "Africa" "Africa" "Africa" "Africa" ...
 $ country     : chr [1:5112] "Algeria" "Algeria" "Algeria" "Algeria" ...
 $ obstype_year: chr [1:5112] "pop_1952" "pop_1957" "pop_1962" "pop_1967" ...
 $ obs_values  : num [1:5112] 9279525 10270856 11000948 12760499 14760787 ...
</code></pre></div></div>

<p>Here we have used piping syntax which is similar to what we were doing in the
previous lesson with dplyr. In fact, these are compatible and you can use a mix
of tidyr and dplyr functions by piping them together.</p>

<p>We first provide to <code class="language-plaintext highlighter-rouge">pivot_longer()</code> a vector of column names that will be
pivoted into longer format. We could type out all the observation variables, but
as in the <code class="language-plaintext highlighter-rouge">select()</code> function (see <code class="language-plaintext highlighter-rouge">dplyr</code> lesson), we can use the <code class="language-plaintext highlighter-rouge">starts_with()</code>
argument to select all variables that start with the desired character string.
<code class="language-plaintext highlighter-rouge">pivot_longer()</code> also allows the alternative syntax of using the <code class="language-plaintext highlighter-rouge">-</code> symbol to
identify which variables are not to be pivoted (i.e. ID variables).</p>

<p>The next arguments to <code class="language-plaintext highlighter-rouge">pivot_longer()</code> are <code class="language-plaintext highlighter-rouge">names_to</code> for naming the column that
will contain the new ID variable (<code class="language-plaintext highlighter-rouge">obstype_year</code>) and <code class="language-plaintext highlighter-rouge">values_to</code> for naming the
new amalgamated observation variable (<code class="language-plaintext highlighter-rouge">obs_value</code>). We supply these new column
names as strings.</p>

<p><img src="../fig/14-tidyr-fig4.png" alt="Diagram illustrating the long format of the gapminder data" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap_wide</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_longer</span><span class="p">(</span><span class="w">
    </span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="o">-</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">country</span><span class="p">),</span><span class="w">
    </span><span class="n">names_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"obstype_year"</span><span class="p">,</span><span class="w"> </span><span class="n">values_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"obs_values"</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">gap_long</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tibble [5,112 × 4] (S3: tbl_df/tbl/data.frame)
 $ continent   : chr [1:5112] "Africa" "Africa" "Africa" "Africa" ...
 $ country     : chr [1:5112] "Algeria" "Algeria" "Algeria" "Algeria" ...
 $ obstype_year: chr [1:5112] "gdpPercap_1952" "gdpPercap_1957" "gdpPercap_1962" "gdpPercap_1967" ...
 $ obs_values  : num [1:5112] 2449 3014 2551 3247 4183 ...
</code></pre></div></div>

<p>That may seem trivial with this particular data frame, but sometimes you have 1
ID variable and 40 observation variables with irregular variable names. The
flexibility is a huge time saver!</p>

<p>Now <code class="language-plaintext highlighter-rouge">obstype_year</code> actually contains 2 pieces of information, the observation
type (<code class="language-plaintext highlighter-rouge">pop</code>,<code class="language-plaintext highlighter-rouge">lifeExp</code>, or <code class="language-plaintext highlighter-rouge">gdpPercap</code>) and the <code class="language-plaintext highlighter-rouge">year</code>. We can use the
<code class="language-plaintext highlighter-rouge">separate()</code> function to split the character strings into multiple variables</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">separate</span><span class="p">(</span><span class="n">obstype_year</span><span class="p">,</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'obs_type'</span><span class="p">,</span><span class="w"> </span><span class="s1">'year'</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w">
</span><span class="n">gap_long</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">gap_long</span><span class="o">$</span><span class="n">year</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>Using <code class="language-plaintext highlighter-rouge">gap_long</code>, calculate the mean life expectancy, population, and gdpPercap for each continent.
<strong>Hint:</strong> use the <code class="language-plaintext highlighter-rouge">group_by()</code> and <code class="language-plaintext highlighter-rouge">summarize()</code> functions we learned in the <code class="language-plaintext highlighter-rouge">dplyr</code> lesson</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to Challenge 2</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">obs_type</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarize</span><span class="p">(</span><span class="n">means</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">obs_values</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`summarise()` has grouped output by 'continent'. You can override using the `.groups` argument.
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 15 × 3
# Groups:   continent [5]
  continent obs_type       means
  &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
1 Africa    gdpPercap     2194. 
2 Africa    lifeExp         48.9
3 Africa    pop        9916003. 
4 Americas  gdpPercap     7136. 
5 Americas  lifeExp         64.7
6 Americas  pop       24504795. 
7 Asia      gdpPercap     7902. 
8 Asia      lifeExp         60.1
9 Asia      pop       77038722. 
10 Europe    gdpPercap    14469. 
11 Europe    lifeExp         71.9
12 Europe    pop       17169765. 
13 Oceania   gdpPercap    18622. 
14 Oceania   lifeExp         74.3
15 Oceania   pop        8874672. 
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="from-long-to-intermediate-format-with-pivot_wider">From long to intermediate format with pivot_wider()</h2>

<p>It is always good to check work. So, let’s use the second <code class="language-plaintext highlighter-rouge">pivot</code> function, <code class="language-plaintext highlighter-rouge">pivot_wider()</code>, to ‘widen’ our observation variables back out.  <code class="language-plaintext highlighter-rouge">pivot_wider()</code> is the opposite of <code class="language-plaintext highlighter-rouge">pivot_longer()</code>, making a dataset wider by increasing the number of columns and decreasing the number of rows. We can use <code class="language-plaintext highlighter-rouge">pivot_wider()</code> to pivot or reshape our <code class="language-plaintext highlighter-rouge">gap_long</code> to the original intermediate format or the widest format. Let’s start with the intermediate format.</p>

<p>The <code class="language-plaintext highlighter-rouge">pivot_wider()</code> function takes <code class="language-plaintext highlighter-rouge">names_from</code> and <code class="language-plaintext highlighter-rouge">values_from</code> arguments.</p>

<p>To <code class="language-plaintext highlighter-rouge">names_from</code> we supply the column name whose contents will be pivoted into new
output columns in the widened data frame. The corresponding values will be added
from the column named in the <code class="language-plaintext highlighter-rouge">values_from</code> argument.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_normal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_type</span><span class="p">,</span><span class="w"> </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_values</span><span class="p">)</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">gap_normal</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1704    6
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">dim</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 1704    6
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">gap_normal</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "continent" "country"   "year"      "gdpPercap" "lifeExp"   "pop"      
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "country"   "year"      "pop"       "continent" "lifeExp"   "gdpPercap"
</code></pre></div></div>

<p>Now we’ve got an intermediate data frame <code class="language-plaintext highlighter-rouge">gap_normal</code> with the same dimensions as
the original <code class="language-plaintext highlighter-rouge">gapminder</code>, but the order of the variables is different. Let’s fix
that before checking if they are <code class="language-plaintext highlighter-rouge">all.equal()</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_normal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap_normal</span><span class="p">[,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)]</span><span class="w">
</span><span class="n">all.equal</span><span class="p">(</span><span class="n">gap_normal</span><span class="p">,</span><span class="w"> </span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                
[3] "Component \"country\": 1704 string mismatches"                                         
[4] "Component \"pop\": Mean relative difference: 1.634504"                                 
[5] "Component \"continent\": 1212 string mismatches"                                       
[6] "Component \"lifeExp\": Mean relative difference: 0.203822"                             
[7] "Component \"gdpPercap\": Mean relative difference: 1.162302"                           
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">gap_normal</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 6 × 6
  country  year      pop continent lifeExp gdpPercap
  &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 Algeria  1952  9279525 Africa       43.1     2449.
2 Algeria  1957 10270856 Africa       45.7     3014.
3 Algeria  1962 11000948 Africa       48.3     2551.
4 Algeria  1967 12760499 Africa       51.4     3247.
5 Algeria  1972 14760787 Africa       54.5     4183.
6 Algeria  1977 17152804 Africa       58.0     4910.
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      country year      pop continent lifeExp gdpPercap
1 Afghanistan 1952  8425333      Asia  28.801  779.4453
2 Afghanistan 1957  9240934      Asia  30.332  820.8530
3 Afghanistan 1962 10267083      Asia  31.997  853.1007
4 Afghanistan 1967 11537966      Asia  34.020  836.1971
5 Afghanistan 1972 13079460      Asia  36.088  739.9811
6 Afghanistan 1977 14880372      Asia  38.438  786.1134
</code></pre></div></div>

<p>We’re almost there, the original was sorted by <code class="language-plaintext highlighter-rouge">country</code>, then
<code class="language-plaintext highlighter-rouge">year</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_normal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap_normal</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">arrange</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">)</span><span class="w">
</span><span class="n">all.equal</span><span class="p">(</span><span class="n">gap_normal</span><span class="p">,</span><span class="w"> </span><span class="n">gapminder</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                
</code></pre></div></div>

<p>That’s great! We’ve gone from the longest format back to the intermediate and we
didn’t introduce any errors in our code.</p>

<p>Now let’s convert the long all the way back to the wide. In the wide format, we
will keep country and continent as ID variables and pivot the observations
across the 3 metrics (<code class="language-plaintext highlighter-rouge">pop</code>,<code class="language-plaintext highlighter-rouge">lifeExp</code>,<code class="language-plaintext highlighter-rouge">gdpPercap</code>) and time (<code class="language-plaintext highlighter-rouge">year</code>). First we
need to create appropriate labels for all our new variables (time*metric
combinations) and we also need to unify our ID variables to simplify the process
of defining <code class="language-plaintext highlighter-rouge">gap_wide</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">unite</span><span class="p">(</span><span class="n">var_ID</span><span class="p">,</span><span class="w"> </span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">gap_temp</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tibble [5,112 × 4] (S3: tbl_df/tbl/data.frame)
 $ var_ID    : chr [1:5112] "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" ...
 $ obs_type  : chr [1:5112] "gdpPercap" "gdpPercap" "gdpPercap" "gdpPercap" ...
 $ year      : int [1:5112] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ obs_values: num [1:5112] 2449 3014 2551 3247 4183 ...
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">unite</span><span class="p">(</span><span class="n">ID_var</span><span class="p">,</span><span class="w"> </span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">unite</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span><span class="w"> </span><span class="n">obs_type</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">gap_temp</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tibble [5,112 × 3] (S3: tbl_df/tbl/data.frame)
 $ ID_var    : chr [1:5112] "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" ...
 $ var_names : chr [1:5112] "gdpPercap_1952" "gdpPercap_1957" "gdpPercap_1962" "gdpPercap_1967" ...
 $ obs_values: num [1:5112] 2449 3014 2551 3247 4183 ...
</code></pre></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">unite()</code> we now have a single ID variable which is a combination of
<code class="language-plaintext highlighter-rouge">continent</code>,<code class="language-plaintext highlighter-rouge">country</code>,and we have defined variable names. We’re now ready to
pipe in <code class="language-plaintext highlighter-rouge">pivot_wider()</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_wide_new</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">unite</span><span class="p">(</span><span class="n">ID_var</span><span class="p">,</span><span class="w"> </span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">unite</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span><span class="w"> </span><span class="n">obs_type</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var_names</span><span class="p">,</span><span class="w"> </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_values</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">gap_wide_new</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tibble [142 × 37] (S3: tbl_df/tbl/data.frame)
 $ ID_var        : chr [1:142] "Africa_Algeria" "Africa_Angola" "Africa_Benin" "Africa_Botswana" ...
 $ gdpPercap_1952: num [1:142] 2449 3521 1063 851 543 ...
 $ gdpPercap_1957: num [1:142] 3014 3828 960 918 617 ...
 $ gdpPercap_1962: num [1:142] 2551 4269 949 984 723 ...
 $ gdpPercap_1967: num [1:142] 3247 5523 1036 1215 795 ...
 $ gdpPercap_1972: num [1:142] 4183 5473 1086 2264 855 ...
 $ gdpPercap_1977: num [1:142] 4910 3009 1029 3215 743 ...
 $ gdpPercap_1982: num [1:142] 5745 2757 1278 4551 807 ...
 $ gdpPercap_1987: num [1:142] 5681 2430 1226 6206 912 ...
 $ gdpPercap_1992: num [1:142] 5023 2628 1191 7954 932 ...
 $ gdpPercap_1997: num [1:142] 4797 2277 1233 8647 946 ...
 $ gdpPercap_2002: num [1:142] 5288 2773 1373 11004 1038 ...
 $ gdpPercap_2007: num [1:142] 6223 4797 1441 12570 1217 ...
 $ lifeExp_1952  : num [1:142] 43.1 30 38.2 47.6 32 ...
 $ lifeExp_1957  : num [1:142] 45.7 32 40.4 49.6 34.9 ...
 $ lifeExp_1962  : num [1:142] 48.3 34 42.6 51.5 37.8 ...
 $ lifeExp_1967  : num [1:142] 51.4 36 44.9 53.3 40.7 ...
 $ lifeExp_1972  : num [1:142] 54.5 37.9 47 56 43.6 ...
 $ lifeExp_1977  : num [1:142] 58 39.5 49.2 59.3 46.1 ...
 $ lifeExp_1982  : num [1:142] 61.4 39.9 50.9 61.5 48.1 ...
 $ lifeExp_1987  : num [1:142] 65.8 39.9 52.3 63.6 49.6 ...
 $ lifeExp_1992  : num [1:142] 67.7 40.6 53.9 62.7 50.3 ...
 $ lifeExp_1997  : num [1:142] 69.2 41 54.8 52.6 50.3 ...
 $ lifeExp_2002  : num [1:142] 71 41 54.4 46.6 50.6 ...
 $ lifeExp_2007  : num [1:142] 72.3 42.7 56.7 50.7 52.3 ...
 $ pop_1952      : num [1:142] 9279525 4232095 1738315 442308 4469979 ...
 $ pop_1957      : num [1:142] 10270856 4561361 1925173 474639 4713416 ...
 $ pop_1962      : num [1:142] 11000948 4826015 2151895 512764 4919632 ...
 $ pop_1967      : num [1:142] 12760499 5247469 2427334 553541 5127935 ...
 $ pop_1972      : num [1:142] 14760787 5894858 2761407 619351 5433886 ...
 $ pop_1977      : num [1:142] 17152804 6162675 3168267 781472 5889574 ...
 $ pop_1982      : num [1:142] 20033753 7016384 3641603 970347 6634596 ...
 $ pop_1987      : num [1:142] 23254956 7874230 4243788 1151184 7586551 ...
 $ pop_1992      : num [1:142] 26298373 8735988 4981671 1342614 8878303 ...
 $ pop_1997      : num [1:142] 29072015 9875024 6066080 1536536 10352843 ...
 $ pop_2002      : num [1:142] 31287142 10866106 7026113 1630347 12251209 ...
 $ pop_2007      : num [1:142] 33333216 12420476 8078314 1639131 14326203 ...
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>

  <p>Take this 1 step further and create a <code class="language-plaintext highlighter-rouge">gap_ludicrously_wide</code> format data by pivoting over countries, year and the 3 metrics?
<strong>Hint</strong> this new data frame should only have 5 rows.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to Challenge 3</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_ludicrously_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">unite</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span><span class="w"> </span><span class="n">obs_type</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var_names</span><span class="p">,</span><span class="w"> </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_values</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<p>Now we have a great ‘wide’ format data frame, but the <code class="language-plaintext highlighter-rouge">ID_var</code> could be more
usable, let’s separate it into 2 variables with <code class="language-plaintext highlighter-rouge">separate()</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gap_wide_betterID</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">separate</span><span class="p">(</span><span class="n">gap_wide_new</span><span class="p">,</span><span class="w"> </span><span class="n">ID_var</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"continent"</span><span class="p">,</span><span class="w"> </span><span class="s2">"country"</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"_"</span><span class="p">)</span><span class="w">
</span><span class="n">gap_wide_betterID</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gap_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">unite</span><span class="p">(</span><span class="n">ID_var</span><span class="p">,</span><span class="w"> </span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">unite</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span><span class="w"> </span><span class="n">obs_type</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var_names</span><span class="p">,</span><span class="w"> </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_values</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">separate</span><span class="p">(</span><span class="n">ID_var</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"continent"</span><span class="p">,</span><span class="s2">"country"</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">gap_wide_betterID</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tibble [142 × 38] (S3: tbl_df/tbl/data.frame)
 $ continent     : chr [1:142] "Africa" "Africa" "Africa" "Africa" ...
 $ country       : chr [1:142] "Algeria" "Angola" "Benin" "Botswana" ...
 $ gdpPercap_1952: num [1:142] 2449 3521 1063 851 543 ...
 $ gdpPercap_1957: num [1:142] 3014 3828 960 918 617 ...
 $ gdpPercap_1962: num [1:142] 2551 4269 949 984 723 ...
 $ gdpPercap_1967: num [1:142] 3247 5523 1036 1215 795 ...
 $ gdpPercap_1972: num [1:142] 4183 5473 1086 2264 855 ...
 $ gdpPercap_1977: num [1:142] 4910 3009 1029 3215 743 ...
 $ gdpPercap_1982: num [1:142] 5745 2757 1278 4551 807 ...
 $ gdpPercap_1987: num [1:142] 5681 2430 1226 6206 912 ...
 $ gdpPercap_1992: num [1:142] 5023 2628 1191 7954 932 ...
 $ gdpPercap_1997: num [1:142] 4797 2277 1233 8647 946 ...
 $ gdpPercap_2002: num [1:142] 5288 2773 1373 11004 1038 ...
 $ gdpPercap_2007: num [1:142] 6223 4797 1441 12570 1217 ...
 $ lifeExp_1952  : num [1:142] 43.1 30 38.2 47.6 32 ...
 $ lifeExp_1957  : num [1:142] 45.7 32 40.4 49.6 34.9 ...
 $ lifeExp_1962  : num [1:142] 48.3 34 42.6 51.5 37.8 ...
 $ lifeExp_1967  : num [1:142] 51.4 36 44.9 53.3 40.7 ...
 $ lifeExp_1972  : num [1:142] 54.5 37.9 47 56 43.6 ...
 $ lifeExp_1977  : num [1:142] 58 39.5 49.2 59.3 46.1 ...
 $ lifeExp_1982  : num [1:142] 61.4 39.9 50.9 61.5 48.1 ...
 $ lifeExp_1987  : num [1:142] 65.8 39.9 52.3 63.6 49.6 ...
 $ lifeExp_1992  : num [1:142] 67.7 40.6 53.9 62.7 50.3 ...
 $ lifeExp_1997  : num [1:142] 69.2 41 54.8 52.6 50.3 ...
 $ lifeExp_2002  : num [1:142] 71 41 54.4 46.6 50.6 ...
 $ lifeExp_2007  : num [1:142] 72.3 42.7 56.7 50.7 52.3 ...
 $ pop_1952      : num [1:142] 9279525 4232095 1738315 442308 4469979 ...
 $ pop_1957      : num [1:142] 10270856 4561361 1925173 474639 4713416 ...
 $ pop_1962      : num [1:142] 11000948 4826015 2151895 512764 4919632 ...
 $ pop_1967      : num [1:142] 12760499 5247469 2427334 553541 5127935 ...
 $ pop_1972      : num [1:142] 14760787 5894858 2761407 619351 5433886 ...
 $ pop_1977      : num [1:142] 17152804 6162675 3168267 781472 5889574 ...
 $ pop_1982      : num [1:142] 20033753 7016384 3641603 970347 6634596 ...
 $ pop_1987      : num [1:142] 23254956 7874230 4243788 1151184 7586551 ...
 $ pop_1992      : num [1:142] 26298373 8735988 4981671 1342614 8878303 ...
 $ pop_1997      : num [1:142] 29072015 9875024 6066080 1536536 10352843 ...
 $ pop_2002      : num [1:142] 31287142 10866106 7026113 1630347 12251209 ...
 $ pop_2007      : num [1:142] 33333216 12420476 8078314 1639131 14326203 ...
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">all.equal</span><span class="p">(</span><span class="n">gap_wide</span><span class="p">,</span><span class="w"> </span><span class="n">gap_wide_betterID</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Attributes: &lt; Component \"class\": Lengths (1, 3) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                
</code></pre></div></div>

<p>There and back again!</p>

<h2 id="other-great-resources">Other great resources</h2>

<ul>
  <li><a href="http://r4ds.had.co.nz/index.html">R for Data Science</a></li>
  <li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling Cheat sheet</a></li>
  <li><a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">Introduction to tidyr</a></li>
  <li><a href="https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/">Data wrangling with R and RStudio</a></li>
</ul>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use the <code class="language-plaintext highlighter-rouge">tidyr</code> package to change the layout of data frames.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">pivot_longer()</code> to go from wide to longer layout.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">pivot_wider()</code> to go from long to wider layout.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="producing-reports-with-knitr" class="maintitle">Producing Reports With knitr</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 60 min
      <br />
      <strong>Exercises:</strong> 15 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I integrate software and reports?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Understand the value of writing reproducible reports</p>
</li>
	
	<li><p>Learn how to recognise and compile the basic components of an R Markdown file</p>
</li>
	
	<li><p>Become familiar with R code chunks, and understand their purpose, structure and options</p>
</li>
	
	<li><p>Demonstrate the use of inline chunks for weaving R outputs into text blocks, for example when discussing the results of some calculations</p>
</li>
	
	<li><p>Be aware of alternative output formats to which an R Markdown file can be exported</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="data-analysis-reports">Data analysis reports</h2>

<p>Data analysts tend to write a lot of reports, describing their
analyses and results, for their collaborators or to document their
work for future reference.</p>

<p>Many new users begin by first writing a single R script containing all of their
work, and then share the analysis by emailing the script and various graphs
as attachments. But this can be cumbersome, requiring a lengthy discussion to
explain which attachment was which result.</p>

<p>Writing formal reports with Word or <a href="http://www.latex-project.org/">LaTeX</a>
can simplify this process by incorporating both the analysis report and output graphs 
into a single document. But tweaking formatting to make figures look correct
and fixing obnoxious page breaks can be tedious and lead to a lengthly “whack-a-mole”
game of fixing new mistakes resulting from a single formatting change.</p>

<p>Creating a web page (as an html file) using R Markdown makes things easier.
The report can be one long stream, so tall figures that wouldn’t ordinarily fit on
one page can be kept at full size and easier to read, since the reader can simply
keep scrolling. Additionally, the formatting of and R Markdown document is simple and easy to modify, allowing you to spend
more time on your analyses instead of writing reports.</p>

<h2 id="literate-programming">Literate programming</h2>

<p>Ideally, such analysis reports are <em>reproducible</em> documents: If an
error is discovered, or if some additional subjects are added to the
data, you can just re-compile the report and get the new or corrected
results rather than having to reconstruct figures, paste them into
a Word document, and hand-edit various detailed results.</p>

<p>The key R package here is <a href="http://yihui.name/knitr/"><code class="language-plaintext highlighter-rouge">knitr</code></a>. It allows you
to create a document that is a mixture of text and chunks of
code. When the document is processed by <code class="language-plaintext highlighter-rouge">knitr</code>, chunks of code will
be executed, and graphs or other results will be inserted into the final document.</p>

<p>This sort of idea has been called “literate programming”.</p>

<p><code class="language-plaintext highlighter-rouge">knitr</code> allows you to mix basically any type of text with code from different programming languages, but we recommend that you use <code class="language-plaintext highlighter-rouge">R Markdown</code>, which mixes Markdown
with R. <a href="https://www.markdownguide.org/">Markdown</a> is a light-weight mark-up language for creating web
pages.</p>

<h2 id="creating-an-r-markdown-file">Creating an R Markdown file</h2>

<p>Within RStudio, click File → New File → R Markdown and
you’ll get a dialog box like this:</p>

<p><img src="../fig/New_R_Markdown.png" alt="Screenshot of the New R Markdown file dialogue box in RStudio" /></p>

<p>You can stick with the default (HTML output), but give it a title.</p>

<h2 id="basic-components-of-r-markdown">Basic components of R Markdown</h2>

<p>The initial chunk of text (header) contains instructions for R to specify what kind of document will be created, and the options chosen. You can use the header to give your document a title, author, date, and tell it what type of output you want
to produce. In this case, we’re creating an html document.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
title: "Initial R Markdown document"
author: "Karl Broman"
date: "April 23, 2015"
output: html_document
---
</code></pre></div></div>

<p>You can delete any of those fields if you don’t want them
included. The double-quotes aren’t strictly <em>necessary</em> in this case.
They’re mostly needed if you want to include a colon in the title.</p>

<p>RStudio creates the document with some example text to get you
started. Note below that there are chunks like</p>

<pre>
&#96;&#96;&#96;{r}
summary(cars)
&#96;&#96;&#96;
</pre>

<p>These are chunks of R code that will be executed by <code class="language-plaintext highlighter-rouge">knitr</code> and replaced
by their results. More on this later.</p>

<h2 id="markdown">Markdown</h2>

<p>Markdown is a system for writing web pages by marking up the text much
as you would in an email rather than writing html code. The marked-up
text gets <em>converted</em> to html, replacing the marks with the proper
html code.</p>

<p>For now, let’s delete all of the stuff that’s there and write a bit of
markdown.</p>

<p>You make things <strong>bold</strong> using two asterisks, like this: <code class="language-plaintext highlighter-rouge">**bold**</code>,
and you make things <em>italics</em> by using underscores, like this:
<code class="language-plaintext highlighter-rouge">_italics_</code>.</p>

<p>You can make a bulleted list by writing a list with hyphens or
asterisks, like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* bold with double-asterisks
* italics with underscores
* code-type font with backticks
</code></pre></div></div>

<p>or like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- bold with double-asterisks
- italics with underscores
- code-type font with backticks
</code></pre></div></div>

<p>Each will appear as:</p>

<ul>
  <li>bold with double-asterisks</li>
  <li>italics with underscores</li>
  <li>code-type font with backticks</li>
</ul>

<p>You can use whatever method you prefer, but <em>be consistent</em>. This maintains the
readability of your code.</p>

<p>You can make a numbered list by just using numbers. You can even use the
same number over and over if you want:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. bold with double-asterisks
1. italics with underscores
1. code-type font with backticks
</code></pre></div></div>

<p>This will appear as:</p>

<ol>
  <li>bold with double-asterisks</li>
  <li>italics with underscores</li>
  <li>code-type font with backticks</li>
</ol>

<p>You can make section headers of different sizes by initiating a line
with some number of <code class="language-plaintext highlighter-rouge">#</code> symbols:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Title
## Main section
### Sub-section
#### Sub-sub section
</code></pre></div></div>

<p>You <em>compile</em> the R Markdown document to an html webpage by clicking
the “Knit” button in the upper-left.</p>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>

  <p>Create a new R Markdown document. Delete all of the R code chunks
and write a bit of Markdown (some sections, some italicized
text, and an itemized list).</p>

  <p>Convert the document to a webpage.</p>
  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to Challenge 1</h2>

    <p>In RStudio, select File &gt; New file &gt; R Markdown…</p>

    <p>Delete the placeholder text and add the following:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Introduction

## Background on Data

This report uses the *gapminder* dataset, which has columns that include:

* country
* continent
* year
* lifeExp
* pop
* gdpPercap

## Background on Methods

</code></pre></div>    </div>

    <p>Then click the ‘Knit’ button on the toolbar to generate an html document (webpage).</p>
  </blockquote>
</blockquote>

<h2 id="a-bit-more-markdown">A bit more Markdown</h2>

<p>You can make a hyperlink like this:
<code class="language-plaintext highlighter-rouge">[text to show](http://the-web-page.com)</code>.</p>

<p>You can include an image file like this: <code class="language-plaintext highlighter-rouge">![caption](http://url/for/file)</code></p>

<p>You can do subscripts (e.g., F~2~) with <code class="language-plaintext highlighter-rouge">F~2~</code> and superscripts (e.g.,
F^2^) with <code class="language-plaintext highlighter-rouge">F^2^</code>.</p>

<p>If you know how to write equations in
<a href="http://www.latex-project.org/">LaTeX</a>, you can use <code class="language-plaintext highlighter-rouge">$ $</code> and <code class="language-plaintext highlighter-rouge">$$ $$</code> to insert math equations, like
<code class="language-plaintext highlighter-rouge">$E = mc^2$</code> and</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$$y = \mu + \sum_{i=1}^p \beta_i x_i + \epsilon$$
</code></pre></div></div>

<p>You can review Markdown syntax by navigating to the
“Markdown Quick Reference” under the “Help” field in the 
toolbar at the top of RStudio.</p>

<h2 id="r-code-chunks">R code chunks</h2>

<p>The real power of Markdown comes from
mixing markdown with chunks of code. This is R Markdown. When
processed, the R code will be executed; if they produce figures, the
figures will be inserted in the final document.</p>

<p>The main code chunks look like this:</p>

<pre>
&#96;&#96;&#96;{r load_data}
gapminder &lt;- read.csv("gapminder.csv")
&#96;&#96;&#96;
</pre>

<p>That is, you place a chunk of R code between <code>&#96;&#96;&#96;{r chunk_name}</code>
and <code>&#96;&#96;&#96;</code>. You should give each chunk
a unique name, as they will help you to fix errors and, if any graphs are
produced, the file names are based on the name of the code chunk that
produced them. You can create code chunks quickly in RStudio using the shortcuts
<kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>I</kbd> on Windows and Linux, or <kbd>Cmd</kbd>+<kbd>Option</kbd>+<kbd>I</kbd> on Mac.</p>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>

  <p>Add code chunks to:</p>

  <ul>
    <li>Load the ggplot2 package</li>
    <li>Read the gapminder data</li>
    <li>Create a plot</li>
  </ul>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to Challenge 2</h2>

    <pre>
&#96;&#96;&#96;{r load-ggplot2}
library("ggplot2")
&#96;&#96;&#96;
</pre>

    <pre>
&#96;&#96;&#96;{r read-gapminder-data}
gapminder &lt;- read.csv("gapminder.csv")
&#96;&#96;&#96;
</pre>

    <pre>
&#96;&#96;&#96;{r make-plot}
plot(lifeExp ~ year, data = gapminder)
&#96;&#96;&#96;
</pre>

  </blockquote>
</blockquote>

<h2 id="how-things-get-compiled">How things get compiled</h2>

<p>When you press the “Knit” button, the R Markdown document is
processed by <a href="http://yihui.name/knitr"><code class="language-plaintext highlighter-rouge">knitr</code></a> and a plain Markdown
document is produced (as well as, potentially, a set of figure files): the R code is executed
and replaced by both the input and the output; if figures are
produced, links to those figures are included.</p>

<p>The Markdown and figure documents are then processed by the tool
<a href="http://pandoc.org/"><code class="language-plaintext highlighter-rouge">pandoc</code></a>, which converts the Markdown file into an
html file, with the figures embedded.</p>

<p><img src="../fig/rmd-15-rmd_to_html_fig-1.png" title="plot of chunk rmd_to_html_fig" alt="plot of chunk rmd_to_html_fig" width="576" style="display: block; margin: auto auto auto 0;" /></p>

<h2 id="chunk-options">Chunk options</h2>

<p>There are a variety of options to affect how the code chunks are
treated. Here are some examples:</p>

<ul>
  <li>Use <code class="language-plaintext highlighter-rouge">echo=FALSE</code> to avoid having the code itself shown.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">results="hide"</code> to avoid having any results printed.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">eval=FALSE</code> to have the code shown but not evaluated.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">warning=FALSE</code> and <code class="language-plaintext highlighter-rouge">message=FALSE</code> to hide any warnings or
messages produced.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">fig.height</code> and <code class="language-plaintext highlighter-rouge">fig.width</code> to control the size of the figures
produced (in inches).</li>
</ul>

<p>So you might write:</p>

<pre>
&#96;&#96;&#96;{r load_libraries, echo=FALSE, message=FALSE}
library("dplyr")
library("ggplot2")
&#96;&#96;&#96;
</pre>

<p>Often there will be particular options that you’ll want to use
repeatedly; for this, you can set <em>global</em> chunk options, like so:</p>

<pre>
&#96;&#96;&#96;{r global_options, echo=FALSE}
knitr::opts_chunk$set(fig.path="Figs/", message=FALSE, warning=FALSE,
                      echo=FALSE, results="hide", fig.width=11)
&#96;&#96;&#96;
</pre>

<p>The <code class="language-plaintext highlighter-rouge">fig.path</code> option defines where the figures will be saved. The <code class="language-plaintext highlighter-rouge">/</code>
here is really important; without it, the figures would be saved in
the standard place but just with names that begin with <code class="language-plaintext highlighter-rouge">Figs</code>.</p>

<p>If you have multiple R Markdown files in a common directory, you might
want to use <code class="language-plaintext highlighter-rouge">fig.path</code> to define separate prefixes for the figure file
names, like <code class="language-plaintext highlighter-rouge">fig.path="Figs/cleaning-"</code> and <code class="language-plaintext highlighter-rouge">fig.path="Figs/analysis-"</code>.</p>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>

  <p>Use chunk options to control the size of a figure and to hide the
code.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to Challenge 3</h2>

    <pre>
&#96;&#96;&#96;{r echo = FALSE, fig.width = 3}
plot(faithful)
&#96;&#96;&#96;
</pre>

  </blockquote>
</blockquote>

<p>You can review all of the <code class="language-plaintext highlighter-rouge">R</code> chunk options by navigating to
the “R Markdown Cheat Sheet” under the “Cheatsheets” section 
of the “Help” field in the toolbar at the top of RStudio.</p>

<h2 id="inline-r-code">Inline R code</h2>

<p>You can make <em>every</em> number in your report reproducible. Use
<code>&#96;r</code> and <code>&#96;</code> for an in-line code chunk,
like so: <code>&#96;r round(some_value, 2)&#96;</code>. The code will be
executed and replaced with the <em>value</em> of the result.</p>

<p>Don’t let these in-line chunks get split across lines.</p>

<p>Perhaps precede the paragraph with a larger code chunk that does
calculations and defines variables, with <code class="language-plaintext highlighter-rouge">include=FALSE</code> for that larger
chunk (which is the same as <code class="language-plaintext highlighter-rouge">echo=FALSE</code> and <code class="language-plaintext highlighter-rouge">results="hide"</code>).</p>

<p>Rounding can produce differences in output in such situations. You may want
<code class="language-plaintext highlighter-rouge">2.0</code>, but <code class="language-plaintext highlighter-rouge">round(2.03, 1)</code> will give just <code class="language-plaintext highlighter-rouge">2</code>.</p>

<p>The
<a href="https://github.com/kbroman/broman/blob/master/R/myround.R"><code class="language-plaintext highlighter-rouge">myround</code></a>
function in the <a href="https://github.com/kbroman/broman">R/broman</a> package handles
this.</p>

<blockquote class="challenge">
  <h2 id="challenge-4">Challenge 4</h2>

  <p>Try out a bit of in-line R code.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-4">Solution to Challenge 4</h2>

    <p>Here’s some inline code to determine that 2 + 2 = <code class="language-plaintext highlighter-rouge">`r
2+2`</code>.</p>

  </blockquote>
</blockquote>

<h2 id="other-output-options">Other output options</h2>

<p>You can also convert R Markdown to a PDF or a Word document. Click the
little triangle next to the “Knit” button to get a drop-down
menu. Or you could put <code class="language-plaintext highlighter-rouge">pdf_document</code> or <code class="language-plaintext highlighter-rouge">word_document</code> in the initial header
of the file.</p>

<blockquote class="callout">
  <h2 id="tip-creating-pdf-documents">Tip: Creating PDF documents</h2>

  <p>Creating .pdf documents may require installation of some extra software. The R 
package <code class="language-plaintext highlighter-rouge">tinytex</code> provides some tools to help make this process easier for R users.
With <code class="language-plaintext highlighter-rouge">tinytex</code> installed, run <code class="language-plaintext highlighter-rouge">tinytex::install_tinytex()</code> to install the required
software (you’ll only need to do this once) and then when you knit to pdf <code class="language-plaintext highlighter-rouge">tinytex</code>
will automatically detect and install any additional LaTeX packages that are needed to 
produce the pdf document. Visit the <a href="https://yihui.org/tinytex/">tinytex website</a> 
for more information.</p>

</blockquote>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="http://kbroman.org/knitr_knutshell">Knitr in a knutshell tutorial</a></li>
  <li><a href="http://www.amazon.com/exec/obidos/ASIN/1482203537/7210-20">Dynamic Documents with R and knitr</a> (book)</li>
  <li><a href="http://rmarkdown.rstudio.com">R Markdown documentation</a></li>
  <li><a href="https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf">R Markdown cheat sheet</a></li>
  <li><a href="https://www.rstudio.com/resources/webinars/getting-started-with-r-markdown/">Getting started with R Markdown</a></li>
  <li><a href="https://bookdown.org/yihui/rmarkdown/">R Markdown: The Definitive Guide</a> (book by Rstudio team)</li>
  <li><a href="https://www.rstudio.com/resources/webinars/reproducible-reporting/">Reproducible Reporting</a></li>
  <li><a href="https://www.rstudio.com/resources/webinars/the-ecosystem-of-r-markdown/">The Ecosystem of R Markdown</a></li>
  <li><a href="https://www.rstudio.com/resources/webinars/introducing-bookdown/">Introducing Bookdown</a></li>
</ul>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Mix reporting written in R Markdown with software written in R.</p>
</li>
    
    <li><p>Specify chunk options to control formatting.</p>
</li>
    
    <li><p>Use <code class="language-plaintext highlighter-rouge">knitr</code> to convert these documents into PDF and other formats.</p>
</li>
    
  </ul>
</blockquote>

<hr />

<h1 id="writing-good-software" class="maintitle">Writing Good Software</h1>

<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 15 min
      <br />
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I write software that other people can use?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe best practices for writing R and explain the justification for each.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="structure-your-project-folder">Structure your project folder</h2>

<p>Keep your project folder structured, organized and tidy, by creating subfolders for your code files, manuals, data, binaries, output plots, etc. It can be done completely manually, or with the help of RStudio’s <code class="language-plaintext highlighter-rouge">New Project</code> functionality, or a designated package, such as <code class="language-plaintext highlighter-rouge">ProjectTemplate</code>.</p>

<blockquote class="callout">
  <h2 id="tip-projecttemplate---a-possible-solution">Tip: ProjectTemplate - a possible solution</h2>

  <p>One way to automate the management of projects is to install the third-party package, <code class="language-plaintext highlighter-rouge">ProjectTemplate</code>.
This package will set up an ideal directory structure for project management.
This is very useful as it enables you to have your analysis pipeline/workflow organised and structured.
Together with the default RStudio project functionality and Git you will be able to keep track of your
work as well as be able to share your work with collaborators.</p>

  <ol>
    <li>Install <code class="language-plaintext highlighter-rouge">ProjectTemplate</code>.</li>
    <li>Load the library</li>
    <li>Initialise the project:</li>
  </ol>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"ProjectTemplate"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"ProjectTemplate"</span><span class="p">)</span><span class="w">
</span><span class="n">create.project</span><span class="p">(</span><span class="s2">"../my_project_2"</span><span class="p">,</span><span class="w"> </span><span class="n">merge.strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"allow.non.conflict"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <p>For more information on ProjectTemplate and its functionality visit the
home page <a href="http://projecttemplate.net/index.html">ProjectTemplate</a></p>
</blockquote>

<h2 id="make-code-readable">Make code readable</h2>

<p>The most important part of writing code is making it readable and understandable.
You want someone else to be able to pick up your code and be able to understand
what it does: more often than not this someone will be you 6 months down the line,
who will otherwise be cursing past-self.</p>

<h2 id="documentation-tell-us-what-and-why-not-how">Documentation: tell us what and why, not how</h2>

<p>When you first start out, your comments will often describe what a command does,
since you’re still learning yourself and it can help to clarify concepts and
remind you later. However, these comments aren’t particularly useful later on
when you don’t remember what problem your code is trying to solve. Try to also
include comments that tell you <em>why</em> you’re solving a problem, and <em>what</em> problem
that is. The <em>how</em> can come after that: it’s an implementation detail you ideally
shouldn’t have to worry about.</p>

<h2 id="keep-your-code-modular">Keep your code modular</h2>

<p>Our recommendation is that you should separate your functions from your analysis
scripts, and store them in a separate file that you <code class="language-plaintext highlighter-rouge">source</code> when you open the R
session in your project. This approach is nice because it leaves you with an
uncluttered analysis script, and a repository of useful functions that can be
loaded into any analysis script in your project. It also lets you group related
functions together easily.</p>

<h2 id="break-down-problem-into-bite-size-pieces">Break down problem into bite size pieces</h2>

<p>When you first start out, problem solving and function writing can be daunting
tasks, and hard to separate from code inexperience. Try to break down your
problem into digestible chunks and worry about the implementation details later:
keep breaking down the problem into smaller and smaller functions until you
reach a point where you can code a solution, and build back up from there.</p>

<h2 id="know-that-your-code-is-doing-the-right-thing">Know that your code is doing the right thing</h2>

<p>Make sure to test your functions!</p>

<h2 id="dont-repeat-yourself">Don’t repeat yourself</h2>

<p>Functions enable easy reuse within a project. If you see blocks of similar
lines of code through your project, those are usually candidates for being
moved into functions.</p>

<p>If your calculations are performed through a series of functions, then the
project becomes more modular and easier to change. This is especially the case
for which a particular input always gives a particular output.</p>

<h2 id="remember-to-be-stylish">Remember to be stylish</h2>

<p>Apply consistent style to your code.</p>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Keep your project folder structured, organized and tidy.</p>
</li>
    
    <li><p>Document what and why, not how.</p>
</li>
    
    <li><p>Break programs into short single-purpose functions.</p>
</li>
    
    <li><p>Write re-runnable tests.</p>
</li>
    
    <li><p>Don’t repeat yourself.</p>
</li>
    
    <li><p>Be consistent in naming, indentation, and other aspects of style.</p>
</li>
    
  </ul>
</blockquote>

<hr />


</article>

      
      






<footer>
  <div class="row">
    <div class="col-md-6 license" id="license-info" align="left">
	
	Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2018–2021
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2016–2018
	by <a href="https://software-carpentry.org">Software Carpentry Foundation</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit//aio.md" data-checker-ignore>Edit on GitHub</a>
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:team@carpentries.org">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

<script src="../assets/js/anchor.min.js"></script>
<script>
    anchors.add();
</script>

  </body>
</html>
